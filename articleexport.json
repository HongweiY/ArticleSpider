[{"fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/liulun/p/7159705.html\">liulun</a>   </div><p>我们公司和大部分传统软件公司一样，随着业务的发展和新领域的开拓，公司的管理风格越来越像华为，这是不是最佳的演进路线，我觉得值得探讨，以下是我的思考，希望跟大家讨论。</p>\n<h2>一个问题</h2>\n<p>前段时间跟一个创业的朋友聊天，说起他们最近在做的一个项目，这是一个教育行业的管理系统，业务非常复杂，牵涉到的决策人，需要对接的系统也非常多，最后问到他们做了多久完成这个项目，朋友告诉我2个多月，6个人，其中还括一个美工，一个项目经理；剩下的都是开发人员，没有测试，没有前端开发；朋友问我，如果这个项目给你们做，你们需要做多久；我想了想说，这个项目如果交给我们做，顺利的话，至少要半年。</p>\n<p><strong>为什么差异这么大呢？</strong></p>\n<p>我们一个一个环节来分析一下，朋友的团队跟客户沟通需求的时候，功能性需求只用一个原型草图，非功能性需求就一个excel表格；如果我们公司做的话，至少要做需求调研报告，需求规格说明书；这个阶段的负责人甚至不会画原型，要到设计阶段才有人能画原型；</p>\n<p>到设计阶段，朋友的团队几乎没有什么技术设计，业务按模块给开发人员分一下，各人设计好自己的数据库模型，汇总起来给项目经理看一下，没问题就进入开发阶段了，界面设计花的时间比较久，跟客户反复确认了两三次；如果我们公司做的话，至少要产出原型设计（低保真描述功能的设计稿，高保真描述界面的设计稿），概要设计，详细设计（技术设计、架构设计、网络设计）等等，而且几乎每个设计都要经历评审环节，组织评审就要协调人员，要等大家都有时间的时候再做评审，这都是损耗；</p>\n<p>到开发测试阶段，朋友的团队几个开发人员从前端到后端，从开发到测试，都是这几个人做；如果我们公司来做的话，后台开发人员不做前端（不做复杂的前端页面，普通的前端工作还是要做的），质量保证要测试人员保证，测试把BUG提交到BUG管理工具，开发再去BUG管理工具查阅属于自己的BUG，修改完成之后，再关闭BUG，测试再做回归测试；这些流程看起来琐碎，但却损耗了大量的资源；</p>\n<p>验收上线阶段，朋友的团队所有人都铺在项目现场，有问题，当场解决；我们公司要收集问题，让测试工程师验证问题，再由开发解决，解决之后再验证，再发布版本给现场的实施工程师，实施工程师再更新上线，给客户验证。</p>\n<p>这个问题很明显：规模大的团队和规模小的团队工作方式的差异非常大，组织资源的方式也有明显的区别；我们抽象一下，把这两种模式称为：大军团模式和小编队模式，再看这两种模式的具体区别：</p>\n<h2>大军团模式</h2>\n<p>之前有一种理论，要完成一项超大规模的工程，往往需要成百上千人，有组织有纪律的协作才能完成；</p>\n<p>这样就需要制定一系列的规章、制度、流程、KPI来约束这些人，</p>\n<p>把这些人变成一个庞大机器的零部件，保证结果的达成，避免产生差错；</p>\n<p>这是一种非常常见的大组织的运作模式，</p>\n<p>不但在软件行业普遍存在（华为、惠普、IBM），</p>\n<p>在造桥、修路、航天、汽车等工业领域也十分常见，</p>\n<p>这种模式非常“稳”，他能保证目标的稳定达成，并且能使目标达成的过程清晰、可控。</p>\n<h2>小编队模式</h2>\n<p>第三次工业革命（信息技术革命）以来，小编队的运作模式发展越来越好，我司IPCC产品的核心：开源语音通信软件FreeSwitch，核心开发者也不过6个人；（说这个开源软件养活了半个呼叫中心行业的开发者都不足为过）； 这种例子在软件行业不胜枚举，比如：git源码管理系统、linux操作系统、JavaScript语言等等。</p>\n<p>甚至有些产品是一个人在短时间内完成的，这就是英雄；</p>\n<p>有很多大规模的公司，比如谷歌、Facebook、国内的百度也在内部推行小编队的运作模式；</p>\n<p>这种模式非常“快”，他能保证目标的快速达成，并且能使目标达成的效率非常高；</p>\n<h2>大军团的不足</h2>\n<h3>效率低下</h3>\n<p>大军团强调集体的智慧，</p>\n<p>个体想推动一项事务向正确的方向推进十分困难，</p>\n<p>个体的决策往往会受到质疑或排斥</p>\n<p>诸如：流程、规范、计划、考核、文档、评审、调研等词</p>\n<p>都是为了保证目标的稳定达成所衍生出来的东西，</p>\n<p>它们都是团队快速前进的束缚和绊脚石！</p>\n<h3>阻碍创新</h3>\n<p>大军团鼓励墨守成规、照章办事的氛围，</p>\n<p>大军团强调分工，把员工看作螺丝钉，希望员工各司其职，不是职责范围内的事务尽量不要碰，因为你不专业，你可能会出错，大军团最害怕出错；</p>\n<p>只有这样才能使目标达成的过程清晰可控；</p>\n<p>然而创新却需要不拘一格的思想，需要独立自主的工作空间，需要组织具备容错性，这和大军团的工作方式是格格不入的；</p>\n<h3>资源浪费</h3>\n<p>为了使目标的达成过程清晰可控；</p>\n<p>大军团制定了很多流程和制度来约束个体的行为；</p>\n<p>他把每一项事务都拆分成很多环节；</p>\n<p>又给每个环节制定了很多关卡；</p>\n<p>而且每个环节都要留下数据，使过程有迹可寻；</p>\n<p>因为大军团要做到每项事务都可以复盘，产生问题之后要可以追溯问题根源；</p>\n<p>这样确实保证了目标达成过程的清晰可控，但却浪费了大量的资源；</p>\n<h2>小编队的优势</h2>\n<h3>小编队也适合做大项目</h3>\n<p>有很多很庞大复杂的软件系统，都是以小编队的方式完成的；</p>\n<p>比如操作系统linux，大数据分析系统hadoop，我们这个行业的freeSwitch等；</p>\n<p>如果一个项目大到一定的规模，需要不同角色的人参与，那么也应该是有更多的小编队来做这一块事情；甚至更极端的做法，就是一个项目在建设之初，就考虑到会有很多小编队或个人参与到项目建设过程中，预留了多人、多团队协作的支撑工具，比如说nodejs的NPM，go语言和rust语言也有相应的规划；</p>\n<h3>小编队有很强的执行力</h3>\n<p>小编队不会说这个事情需要做个评审；</p>\n<p>小编队不会说这个事情安排的资源不够，需要协调更多的资源；</p>\n<p>小编队会把这个事情当成自己的事情，不会像大军团一样，把这个事情当成大家的事情来对待；</p>\n<p>我们来看个图：</p>\n<p>（图片遗失，暂不补充）</p>\n<h3>小编队有很强的创新力</h3>\n<p>软件行业不像建筑行业，90%以上的优秀软件一开始都是个人或者小编队创造出来的；很少见一个优秀软件是一个大规模的组织创造出来的。</p>\n<h2>一个案例</h2>\n<p>张小龙曾经说过一段话：</p>\n<p>好的工具就不应该黏人，应该帮助用户非常高效率完成任务，而不是说用完了还要拿到手里玩一会儿、多用一会儿，那不是一个很高效的表现。但是对这样的一些想法的话，我特别希望它能够根植到大家意识里，时刻想一下什么是我们做的对用户有价值的事情；</p>\n<p>假设你是马化腾，你会怎么给张小龙定KPI呢？考核微信的日活吗？……</p>\n<p>无论你制定什么KPI，都会导致团队去围绕着那个KPI去完成任务；</p>\n<p>KPI考核准则里有一项原则就是“可度量”，当你提出一项纯数据目标的时候，团队就会围绕着那个数字去工作。而偏离了做好产品的初心。</p>\n<p>一个团队工作的目的不应该是完成KPI，工作的目的应该是做好产品，完成KPI只不过是做好产品这件事情的副产物，就像一个人好好工作的目的不应该是为了赚钱，他好好工作的副产物是赚了很多钱；</p>\n<p>所以你制定了一系列的kpi考核制度，只能导致员工工作的动机更不纯粹。</p>\n<h2>最后</h2>\n<p>一个组织只要发展良好，总是会吸引更多的资源，所以组织规模的扩大是无可避免的，但如果一个组织规模已经超过500人了，那么你应该把他看作是50~100个小团队来对待，而不是把他当作一个500人的大团队来对待；</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111484\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111484votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111484\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "6d15dbaaf727b966d37bd068bb39aa2a", "com_num": 1, "title": "小团队管理与大团队管理", "url": "http://blog.jobbole.com/111484/", "praise_num": "1", "front_image_path": "full/ff4572cdd38455986d3d6be616ebc49296dd76d8.jpg", "create_date": "2017/07/17", "tags": "IT技术,团队,管理,职场", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/7062164f8b12cab9bb7cfd7920176dc7.jpg"]},{"fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7766508\">Laurence的技术博客</a>   </div><p>当团队对系统业务和数据库进行了细致的梳理，确定了切分方案后，接下来的问题就是如何去实现切分方案了，目前在sharding方面有不少的开源框架和产品可供参考，同时很多团队也会选择自主开发实现，而不管是选择框架还是自主开发，都会面临一个在哪一层上实现sharding逻辑的问题，本文会对这一系列的问题逐一进行分析和考量。<br>\n一、sharding逻辑的实现层面</p>\n<p>从一个系统的程序架构层面来看，sharding逻辑可以在DAO层、JDBC API层、介于DAO与JDBC之间的Spring数据访问封装层(各种spring的template)以及介于应用服务器与数据库之间的sharding代理服务器四个层面上实现。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/90c47aa9156611bbeb56a649c14a6337.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\">图1. Sharding实现层面与相关框架/产品</p>\n<div>\n<ul>\n<li>在DAO层实现</li>\n</ul>\n</div>\n<p>当团队决定自行实现sharding的时候，DAO层可能是嵌入sharding逻辑的首选位置，因为在这个层面上，每一个DAO的方法都明确地知道需要访问的数据表以及查询参数，借助这些信息可以直接定位到目标shard上，而不必像框架那样需要对SQL进行解析然后再依据配置的规则进行路由。另一个优势是不会受ORM框架的制约。由于现在的大多数应用在数据访问层上会依赖某种ORM框架，而多数的shrading框架往往无法支持或只能支持一种orm框架，这使得在选择和应用框架时受到了很大的制约，而自行实现sharding完全没有这方面的问题，甚至不同的shard使用不同的orm框架都可以在一起协调工作。比如现在的java应用大多使用hibernate，但是当下还没有非常令人满意的基于hibernate的sharding框架，（关于hibernate hards会在下文介绍），因此很多团队会选择自行实现sharding。</p>\n<p>简单总结一下，在DAO层自行实现sharding的优势在于：不受ORM框架的制约、实现起来较为简单、易于根据系统特点进行灵活的定制、无需SQL解析和路由规则匹配，性能上表现会稍好一些;劣势在于：有一定的技术门槛，工作量比依靠框架实现要大(反过来看，框架会有学习成本)、不通用，只能在特定系统里工作。当然，在DAO层同样可以通过XML配置或是注解将sharding逻辑抽离到“外部”，形成一套通用的框架. 不过目前还没有出现此类的框架。</p>\n<ul>\n<li>在ORM框架层实现</li>\n</ul>\n<p>在ORM框架层实现sharding有两个方向，一个是在实现O-R Mapping的前提下同时提供sharding支持，从而定位为一种分布式的数据访问框架，这一类类型的框架代表就是<a href=\"http://code.google.com/p/guzz/\" target=\"_blank\">guzz</a>另一个方向是通过对既有ORM框架进行修改增强来加入sharding机制。此类型的代表产品是<a href=\"http://www.hibernate.org/subprojects/shards.html\" target=\"_blank\">hibernate shard</a>. 应该说以hibernate这样主流的地位，行业对于一款面向hibernate的sharding框架的需求是非常迫切的，但是就目前的hibernate shards来看，表现还算不上令人满意，主要是它对使用hibernate的限制过多，比如它对HQL的支持就非常有限。在mybatis方面，目前还没有成熟的相关框架产生。有人提出利用mybatis的插件机制实现sharding,但是遗憾的是，mybatis的插件机制控制不到多数据源的连接层面，另一方面，离开插件层又失去了对sql进行集中解析和路由的机会，因此在mybatis框架上，目前还没有可供借鉴的框架，团队可能要在DAO层或Spring模板类上下功夫了。</p>\n<ul>\n<li>在JDBC API层实现</li>\n</ul>\n<p>JDBC API层是很多人都会想到的一个实现sharding的绝佳场所，如果我们能提供一个实现了sharding逻辑的JDBC API实现，那么sharding对于整个应用程序来说就是完全透明的，而这样的实现可以直接作为通用的sharding产品了。但是这种方案的技术门槛和工作量显然不是一般团队能做得来的，因此基本上没有团队会在这一层面上实现sharding,甚至也没有此类的开源产品。笔者知道的只有一款商业产品<a href=\"http://www.dbshards.com/\" target=\"_blank\">dbShards</a>采用的是这一方案。</p>\n<ul>\n<li>在介于DAO与JDBC之间的Spring数据访问封装层实现</li>\n</ul>\n<p>在springd大行其道的今天，几乎没有哪个java平台上构建的应用不使用spring，在DAO与JDBC之间，spring提供了各种template来管理资源的创建与释放以及与事务的同步，大多数基于spring的应用都会使用template类做为数据访问的入口，这给了我们另一个嵌入sharding逻辑的机会，就是通过提供一个嵌入了sharding逻辑的template类来完成sharding工作.这一方案在效果上与基于JDBC API实现的方案基本一致，同样是对上层代码透明，在进行sharding改造时可以平滑地过度，但它的实现却比基于JDBC API的方式简单，因此成为了不少框架的选择，阿里集团研究院开源的<a href=\"http://write.blog.csdn.net/postedit/code.alibabatech.com/wiki/display/CobarClient/Home\" target=\"_blank\">Cobar Client</a>就是这类方案的一种实现。</p>\n<ul>\n<li>在应用服务器与数据库之间通过代理实现</li>\n</ul>\n<p>在应用服务器与数据库之间加入一个代理，应用程序向数据发出的数据请求会先通过代理，代理会根据配置的路由规则，对SQL进行解析后路由到目标shard，因为这种方案对应用程序完全透明，通用性好，所以成为了很多sharding产品的选择。在这方面较为知名的产品是mysql官方的代理工具：<a href=\"http://dev.mysql.com/doc/refman/5.6/en/mysql-proxy.html\" target=\"_blank\">Mysql Proxy</a>和一款国人开发的产品:<a href=\"http://code.google.com/p/amoeba/\" target=\"_blank\">amoeba</a>。mysql proxy本身并没有实现任何sharding逻辑，它只是作为一种面向mysql数据库的代理，给开发人员提供了一个嵌入sharding逻辑的场所，它使用lua作为编程语言，这对很多团队来说是需要考虑的一个问题。amoeba则是专门实现读写分离与sharding的代理产品，它使用非常简单，不使用任何编程语言，只需要通过xml进行配置。不过amoeba不支持事务(从应用程序发出的包含事务信息的请求到达amoeba时，事务信息会被抹去，因此，即使是单点数据访问也不会有事务存在)一直是个硬伤。当然，这要看产品的定位和设计理念，我们只能说对于那些对事务要求非常高的系统，amoeba是不适合的。</p>\n<p>二、使用框架还是自主开发？</p>\n<p>前面的讨论中已经罗列了很多开源框架与产品，这里再整理一下：基于代理方式的有MySQL Proxy和Amoeba，基于Hibernate框架的是Hibernate Shards，通过重写spring的ibatis template类是Cobar Client，这些框架各有各的优势与短板，架构师可以在深入调研之后结合项目的实际情况进行选择，但是总的来说，我个人对于框架的选择是持谨慎态度的。一方面多数框架缺乏成功案例的验证，其成熟性与稳定性值得怀疑。另一方面，一些从成功商业产品开源出框架（如阿里和淘宝的一些开源项目）是否适合你的项目是需要架构师深入调研分析的。当然，最终的选择一定是基于项目特点、团队状况、技术门槛和学习成本等综合因素考量确定的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111869\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111869votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111869\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "268ed36a9d88d05b0a9312d6a01644d8", "com_num": 0, "title": "DB 分库分表（3）：关于使用框架还是自主开发以及 sharding 实现层面的考量", "url": "http://blog.jobbole.com/111869/", "praise_num": "1", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg", "create_date": "2017/07/17", "tags": "IT技术,分库分表,数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"]},{"fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7793172\">Laurence的技术博客</a>   </div><p>系统经sharding改造之后，原来单一的数据库会演变成多个数据库，如何确保多数据源同时操作的原子性和一致性是不得不考虑的一个问题。总体上看，目前对于一个分布式系统的事务处理有三种方式：分布式事务、基于Best Efforts 1PC模式的事务以及事务补偿机制。我们下面对这三种处理方式一一进行分析。</p>\n<p><strong>分布式事务</strong></p>\n<p>这是最为人们所熟知的多数据源事务处理机制。本文并不打算对分布式事务做过多介绍，读者可参考此文：<a href=\"http://blog.csdn.net/bluishglc/article/details/7612811\" target=\"_blank\">关于分布式事务、两阶段提交、一阶段提交、Best Efforts 1PC模式和事务补偿机制的研究 </a>。在这里只想对分布式事务的利弊作一下分析。</p>\n<p>优势：</p>\n<blockquote><p>1. 基于两阶段提交，最大限度地保证了跨数据库操作的“原子性”，是分布式系统下最严格的事务实现方式。<br>\n2. 实现简单，工作量小。由于多数应用服务器以及一些独立的分布式事务协调器做了大量的封装工作，使得项目中引入分布式事务的难度和工作量基本上可以忽略不计。</p></blockquote>\n<p>劣势：</p>\n<blockquote><p>系统“水平”伸缩的死敌。基于两阶段提交的分布式事务在提交事务时需要在多个节点之间进行协调,最大限度地推后了提交事务的时间点，客观上延长了事务的执行时间，这会导致事务在访问共享资源时发生冲突和死锁的概率增高，随着数据库节点的增多，这种趋势会越来越严重，从而成为系统在数据库层面上水平伸缩的”枷锁”， 这是很多Sharding系统不采用分布式事务的主要原因。</p></blockquote>\n<p><strong>基于Best Efforts 1PC模式的事务</strong></p>\n<p>与分布式事务采用的两阶段提交不同，Best Efforts 1PC模式采用的是一阶段端提交，牺牲了事务在某些特殊情况(当机、网络中断等)下的安全性，却获得了良好的性能，特别是消除了对水平伸缩的桎酷。<a href=\"http://www.javaworld.com/javaworld/jw-01-2009/jw-01-spring-transactions.html?page=5\" target=\"_blank\">Distributed transactions in Spring, with and without XA</a>一文对Best Efforts 1PC模式进行了详细的说明，该文提供的Demo代码更是直接给出了在Spring环境下实现一阶段提交的多数据源事务管理示例。不过需要注意的是，原示例是基于spring 3.0之前的版本，如果你使用spring 3.0+,会得到如下错误：<strong>java.lang.IllegalStateException: Cannot activate transaction synchronization – already active</strong>，如果使用spring 3.0+，你需要参考<a href=\"https://github.com/SpringSource/spring-data-graph/blob/master/spring-data-neo4j/src/main/java/org/springframework/data/neo4j/transaction/ChainedTransactionManager.java\" target=\"_blank\">spring-data-neo4j</a>的实现。鉴于Best Efforts 1PC模式的性能优势，以及相对简单的实现方式，它被大多数的sharding框架和项目采用。</p>\n<p><strong>事务补偿机制</strong></p>\n<p>对于那些对性能要求很高，但对一致性要求并不高的系统，往往并不苛求系统的实时一致性，只要在一个允许的时间周期内达到最终一致性即可，这使得事务补偿机制成为一种可行的方案。事务补偿机制最初被提出是在“长事务”的处理中，但是对于分布式系统确保一致性也有很好的参考意义。笼统地讲，与事务在执行中发生错误后立即回滚的方式不同，事务补偿是一种事后检查并补救的措施，它只期望在一个容许时间周期内得到最终一致的结果就可以了。事务补偿的实现与系统业务紧密相关，并没有一种标准的处理方式。一些常见的实现方式有：对数据进行对帐检查;基于日志进行比对;定期同标准数据来源进行同步，等等。</p>\n<p><strong>小结</strong></p>\n<p>分布式事务，最严格的事务实现，但性能是个大问题;Best Efforts 1PC模式，性能与事务可靠性的平衡，支持系统水平伸缩，大多数情况下是最合适的选择;事务补偿机制，只能适用于对事务性要求不高，允许数据“最终一致”即可的系统，牺牲实时一致性，获得最大的性能回报。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111880\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111880votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111880\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "99c1959be1169340bfefafd21c8b2fdd", "com_num": 0, "title": "DB 分库分表（4）：多数据源的事务处理", "url": "http://blog.jobbole.com/111880/", "praise_num": "1", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg", "create_date": "2017/07/18", "tags": "IT技术,分库分表,数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"]},{"fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/aoi\">伯小乐</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>问：代码写的好，出过畅销书，并且还拿过赛车冠军，这是一种什么体验？</p>\n<p>答：这事得问 DHH。什么？你不知道 DHH 是哪个程序员，那你更得看看这篇文章了。😀</p>\n<p>（ps：以前伯乐在线扩散《<a href=\"http://blog.jobbole.com/110811/\" target=\"_blank\">我是小有成就，但我过不了白板面试</a>》这篇文章时，曾有读者问 DHH 是何许人也。）</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhnu0fdsm9j20dw09bgos.jpg\"></p>\n<p>DHH 是一个丹麦程序员，全名是 David Heinemeier Hansson，DHH 是他的全名首字母缩写，也是他常用的网名。1979 年 10 月 15 日出生在哥本哈根。</p>\n<h3>Ruby On Rails 的诞生</h3>\n<p>1999 年，20 岁的 DHH 成立了一个丹麦语的游戏资讯和社区网站 Daily Rush，一直运营到 2001 年。</p>\n<p>后来因其 PHP 编程能力，吸引到 37signals 联合创始人 Jason Fried 的注意，后被 Jason 招入37signals 开发一个在线版的项目管理工具。该工具也就是后来 37signals 的 SasS 产品 Basecamp。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fhnuqwp1i0j21kw0w0ajk.jpg\" width=\"601\" height=\"338\"></p>\n<p style=\"text-align: center;\">（图：37signals 联合创始人 Jason Fried）</p>\n<p>为了加速 Basecamp 开发，DHH 用 Ruby 开发了一个框架，即 Ruby On Rails。2004 年 7 月，DHH 把 Rails 从 Basecamp 中剥离出来，并且开源。Rails 初期并没有开放 commit 权限，2005 年 2 月才向外开放。</p>\n<p>因其 Rails 的贡献，DHH 获得 Google 和 O’Reilly 联合颁发的「2005 年度最佳 Hacker」奖。</p>\n<p>2006 年 8 月，Rails 迎来一个重要里程碑，苹果公司宣布 Mac OS X v10.5 Leopard 预装 Rails 框架。</p>\n<p>2007 年，DHH 注册了 3 个商标：RUBY ON RAILS 短语、RAILS 以及 Rails 官方标志。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fhnw217rahj20go0gogm2.jpg\" width=\"300\" height=\"300\"></p>\n<p>Rails 的（企业）用户很多，包括 GitHub、Shopify、 Airbnb 和 Square 等。</p>\n<h3>移居美国</h3>\n<p>2005 年，DHH 从哥本哈根商学院毕业，拿到计算机科学和企业管理双学位。同年 11 月，从丹麦移居到美国芝加哥。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhns0wk3zrj20jb0avt9s.jpg\" width=\"601\" height=\"338\"></p>\n<p>DHH 后来成为了 37signals 的联合创始人兼 CTO。</p>\n<p>37signals 公司在 2014 年更名为 Basecamp。</p>\n<h3>写书</h3>\n<p>DHH 和 Jason 合著了 3 本畅销书：</p>\n<p>2006 年的《<a href=\"http://gettingreal.37signals.com/\" target=\"_blank\">Getting Real</a>》，2010 年的《Rework》，和 2013 年的《Remote》。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fho1d0td36j20im0cewg8.jpg\" width=\"601\" height=\"400\"></p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho1d0b23lj20ic0cqt9o.jpg\" width=\"601\" height=\"417\"></p>\n<h3>赛车</h3>\n<p>DHH 有两大业余爱好：赛车和摄影。</p>\n<p>从 2013 年到 2017 年，连续 5 年参加国际汽联世界耐力锦标赛（FIA WEC）。2014 年，在「勒芒 24 小时耐力赛」个人排名 82 位。他所在车队赢得 GTE-AM 组的冠军。</p>\n<p>补充介绍：</p>\n<blockquote><p>勒芒 24 小时耐力赛：3 位车手为一个车组，驾驶一台赛车，完成连续 24 个小时的竞赛。它和世界一级方程式锦标赛(F1)、世界汽车拉力锦标赛(WRC)，并称为世界最著名和最艰苦的三大汽车赛事。</p>\n<p>勒芒耐力赛分 4 个组别：LMP1、LMP2、GTE-PRO，GTE-AM。</p>\n<p>GTE-AM：允许封闭座舱以及开放式座舱，2车门，2或2+2坐席，所使用的赛车为市面上可以够买到的量产车改装而成，但赛车车龄必须大于 12 个月，每辆车内必须包含有业余车手。</p></blockquote>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9tpacyj20h30b4wg9.jpg\" width=\"600\" height=\"390\"></p>\n<blockquote><p>注意 DHH 的赛车服，前胸的 Basecamp.com、脖颈的 Basecamp.com 和 logo，还有左臂的 37signals logo，开车还不忘给自家公司做宣传。´</p></blockquote>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg\" width=\"600\" height=\"342\"></p>\n<p>五年来，DHH 参加 FIA WEC 36 场比赛，16 次上领奖台，赢过 6 次分站冠军，2 次锦标赛亚军，1 次锦标赛冠军。</p>\n<p>5 次参加勒芒耐力赛（无退赛），3 次上领奖台，获得 1 次冠军。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fho726yopzj21kw1kwqow.jpg\" width=\"640\" height=\"640\"></p>\n<p style=\"text-align: center;\">（DHH 参加比赛的车）</p>\n<h3>摄影</h3>\n<p>除了赛车，DHH 还有一大爱好 —— 摄影。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho3eotjxrj20hs0bvadi.jpg\" width=\"640\" height=\"427\"></p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho3es3f93j20hs0bwjv1.jpg\" width=\"640\" height=\"428\"></p>\n<p>DHH 已婚，妻子 Jamie。他们有 2 个儿子：Colt 和 Dash。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fho7266uh9j20m80m81i9.jpg\" width=\"690\" height=\"690\"></p>\n<p>DHH 一家四口的时间，主要在芝加哥、加州的马里布，西班牙的马贝拉之间切换度过。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111892\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111892votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111892\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">伯小乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/11/f2bb4f6f428a49476a2e91c355c8d150.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            伯乐在线小编一枚~~~~PS：我不是@小编辑，不要问我了        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/aoi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/aoi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/aoi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 245</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "a91e0b50334a75b7a782e2c16dff83d3", "com_num": 3, "title": "代码写的好，出过畅销书，还拿过赛车冠军，这是一种什么体验？", "url": "http://blog.jobbole.com/111892/", "praise_num": "1", "front_image_path": "full/0f76dcd24f8a5d0095b676d974e274b9e9914d81.jpg", "create_date": "2017/07/18", "tags": "职场,DHH", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9tpacyj20h30b4wg9.jpg"]},{"fav_num": 9, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/gide/p/6180251.html\">北京流浪儿</a>   </div><p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719f027a735981271090\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#定义Nginx运行的用户和用户组\r\nuser www www;\r\n\r\n#nginx进程数，建议设置为等于CPU总核心数。\r\nworker_processes 8;\r\n\r\n#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]\r\nerror_log /var/log/nginx/error.log info;\r\n\r\n#进程文件\r\npid /var/run/nginx.pid;\r\n\r\n#一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。\r\nworker_rlimit_nofile 65535;\r\n\r\n#工作模式与连接数上限\r\nevents\r\n{\r\n#参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。\r\nuse epoll;\r\n#单个进程最大连接数（最大连接数=连接数*进程数）\r\nworker_connections 65535;\r\n}\r\n\r\n#设定http服务器\r\nhttp\r\n{\r\ninclude mime.types; #文件扩展名与文件类型映射表\r\ndefault_type application/octet-stream; #默认文件类型\r\n#charset utf-8; #默认编码\r\nserver_names_hash_bucket_size 128; #服务器名字的hash表大小\r\nclient_header_buffer_size 32k; #上传文件大小限制\r\nlarge_client_header_buffers 4 64k; #设定请求缓\r\nclient_max_body_size 8m; #设定请求缓\r\nsendfile on; #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。\r\nautoindex on; #开启目录列表访问，合适下载服务器，默认关闭。\r\ntcp_nopush on; #防止网络阻塞\r\ntcp_nodelay on; #防止网络阻塞\r\nkeepalive_timeout 120; #长连接超时时间，单位是秒\r\n\r\n#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。\r\nfastcgi_connect_timeout 300;\r\nfastcgi_send_timeout 300;\r\nfastcgi_read_timeout 300;\r\nfastcgi_buffer_size 64k;\r\nfastcgi_buffers 4 64k;\r\nfastcgi_busy_buffers_size 128k;\r\nfastcgi_temp_file_write_size 128k;\r\n\r\n#gzip模块设置\r\ngzip on; #开启gzip压缩输出\r\ngzip_min_length 1k; #最小压缩文件大小\r\ngzip_buffers 4 16k; #压缩缓冲区\r\ngzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）\r\ngzip_comp_level 2; #压缩等级\r\ngzip_types text/plain application/x-javascript text/css application/xml;\r\n#压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。\r\ngzip_vary on;\r\n#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用\r\n\r\nupstream blog.ha97.com {\r\n#upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。\r\nserver 192.168.80.121:80 weight=3;\r\nserver 192.168.80.122:80 weight=2;\r\nserver 192.168.80.123:80 weight=3;\r\n}\r\n\r\n#虚拟主机的配置\r\nserver\r\n{\r\n    #监听端口\r\n    listen 80;\r\n    #域名可以有多个，用空格隔开\r\n    server_name www.ha97.com ha97.com;\r\n    index index.html index.htm index.php;\r\n    root /data/www/ha97;\r\n    location ~ .*\\.(php|php5)?$\r\n    {\r\n    fastcgi_pass 127.0.0.1:9000;\r\n    fastcgi_index index.php;\r\n    include fastcgi.conf;\r\n    }\r\n    #图片缓存时间设置\r\n    location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$\r\n    {\r\n    expires 10d;\r\n    }\r\n    #JS和CSS缓存时间设置\r\n    location ~ .*\\.(js|css)?$\r\n    {\r\n    expires 1h;\r\n    }\r\n    #日志格式设定\r\n    log_format access '$remote_addr - $remote_user [$time_local] \"$request\" '\r\n    '$status $body_bytes_sent \"$http_referer\" '\r\n    '\"$http_user_agent\" $http_x_forwarded_for';\r\n    #定义本虚拟主机的访问日志\r\n    access_log /var/log/nginx/ha97access.log access;\r\n\r\n    #对 \"/\" 启用反向代理\r\n    location / {\r\n    proxy_pass http://127.0.0.1:88;\r\n    proxy_redirect off;\r\n    proxy_set_header X-Real-IP $remote_addr;\r\n    #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP\r\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n    #以下是一些反向代理的配置，可选。\r\n    proxy_set_header Host $host;\r\n    client_max_body_size 10m; #允许客户端请求的最大单文件字节数\r\n    client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，\r\n    proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)\r\n    proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)\r\n    proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)\r\n    proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小\r\n    proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的设置\r\n    proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）\r\n    proxy_temp_file_write_size 64k;\r\n    #设定缓存文件夹大小，大于这个值，将从upstream服务器传\r\n    }\r\n\r\n    #设定查看Nginx状态的地址\r\n    location /NginxStatus {\r\n    stub_status on;\r\n    access_log on;\r\n    auth_basic \"NginxStatus\";\r\n    auth_basic_user_file conf/htpasswd;\r\n    #htpasswd文件的内容可以用apache提供的htpasswd工具来产生。\r\n    }\r\n\r\n    #本地动静分离反向代理配置\r\n    #所有jsp的页面均交由tomcat或resin处理\r\n    location ~ .(jsp|jspx|do)?$ {\r\n    proxy_set_header Host $host;\r\n    proxy_set_header X-Real-IP $remote_addr;\r\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n    proxy_pass http://127.0.0.1:8080;\r\n    }\r\n    #所有静态文件由nginx直接读取不经过tomcat或resin\r\n    location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$\r\n    { expires 15d; }\r\n    location ~ .*.(js|css)?$\r\n    { expires 1h; }\r\n}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59719f027a735981271090-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719f027a735981271090-144\">144</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-1\"><span class=\"crayon-p\">#定义Nginx运行的用户和用户组</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-2\"><span class=\"crayon-e\">user </span><span class=\"crayon-e\">www </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-4\"><span class=\"crayon-p\">#nginx进程数，建议设置为等于CPU总核心数。</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-5\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>processes<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-6\"> </div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-7\"><span class=\"crayon-p\">#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-8\"><span class=\"crayon-v\">error_log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">info</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-10\"><span class=\"crayon-p\">#进程文件</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-11\"><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pid</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-12\"> </div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-13\"><span class=\"crayon-p\">#一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-14\"><span class=\"crayon-v\">worker_rlimit</span><span class=\"crayon-sy\">_</span>nofile<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65535</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-16\"><span class=\"crayon-p\">#工作模式与连接数上限</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-17\"><span class=\"crayon-e\">events</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-19\"><span class=\"crayon-p\">#参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-20\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">epoll</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-21\"><span class=\"crayon-p\">#单个进程最大连接数（最大连接数=连接数*进程数）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-22\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>connections<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65535</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-23\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-24\"> </div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-25\"><span class=\"crayon-p\">#设定http服务器</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-26\"><span class=\"crayon-e\">http</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-27\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-28\"><span class=\"crayon-e\">include </span><span class=\"crayon-v\">mime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">types</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#文件扩展名与文件类型映射表</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-29\"><span class=\"crayon-e\">default_type </span><span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">octet</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#默认文件类型</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-30\"><span class=\"crayon-p\">#charset utf-8; #默认编码</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-31\"><span class=\"crayon-v\">server_names_hash_bucket</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#服务器名字的hash表大小</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-32\"><span class=\"crayon-v\">client_header_buffer</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#上传文件大小限制</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-33\"><span class=\"crayon-v\">large_client_header</span><span class=\"crayon-sy\">_</span>buffers<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#设定请求缓</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-34\"><span class=\"crayon-v\">client_max_body</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8m</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#设定请求缓</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-35\"><span class=\"crayon-e\">sendfile </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-36\"><span class=\"crayon-e\">autoindex </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#开启目录列表访问，合适下载服务器，默认关闭。</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-37\"><span class=\"crayon-e\">tcp_nopush </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#防止网络阻塞</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-38\"><span class=\"crayon-e\">tcp_nodelay </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#防止网络阻塞</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-39\"><span class=\"crayon-v\">keepalive</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">120</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#长连接超时时间，单位是秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-40\"> </div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-41\"><span class=\"crayon-p\">#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-42\"><span class=\"crayon-v\">fastcgi_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-43\"><span class=\"crayon-v\">fastcgi_send</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-44\"><span class=\"crayon-v\">fastcgi_read</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-45\"><span class=\"crayon-v\">fastcgi_buffer</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-46\"><span class=\"crayon-v\">fastcgi</span><span class=\"crayon-sy\">_</span>buffers<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-47\"><span class=\"crayon-v\">fastcgi_busy_buffers</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-48\"><span class=\"crayon-v\">fastcgi_temp_file_write</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-50\"><span class=\"crayon-p\">#gzip模块设置</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-51\"><span class=\"crayon-e\">gzip </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#开启gzip压缩输出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-52\"><span class=\"crayon-v\">gzip_min</span><span class=\"crayon-sy\">_</span>length<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#最小压缩文件大小</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-53\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>buffers<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#压缩缓冲区</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-54\"><span class=\"crayon-v\">gzip_http</span><span class=\"crayon-sy\">_</span>version<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-55\"><span class=\"crayon-v\">gzip_comp</span><span class=\"crayon-sy\">_</span>level<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#压缩等级</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-56\"><span class=\"crayon-e\">gzip_types </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">plain </span><span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">javascript </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">css </span><span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">xml</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-57\"><span class=\"crayon-p\">#压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-58\"><span class=\"crayon-e\">gzip_vary </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-59\"><span class=\"crayon-p\">#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-60\"> </div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-61\"><span class=\"crayon-e\">upstream </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ha97</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-62\"><span class=\"crayon-p\">#upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-63\"><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.80.121</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-64\"><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.80.122</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-65\"><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.80.123</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-66\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-68\"><span class=\"crayon-p\">#虚拟主机的配置</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-69\"><span class=\"crayon-e\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-70\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#监听端口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">listen</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#域名可以有多个，用空格隔开</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">server_name </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ha97</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com </span><span class=\"crayon-v\">ha97</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">index </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">html </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">htm </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ha97</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">php5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fastcgi</span><span class=\"crayon-sy\">_</span>pass<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">9000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">fastcgi_index </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">include </span><span class=\"crayon-v\">fastcgi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#图片缓存时间设置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-84\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gif</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpeg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">png</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">bmp</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">swf</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-85\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-86\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10d</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#JS和CSS缓存时间设置</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">js</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-91\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1h</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-92\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-93\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#日志格式设定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">log_format </span><span class=\"crayon-i\">access</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'$remote_addr - $remote_user [$time_local] \"$request\" '</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'$status $body_bytes_sent \"$http_referer\" '</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'\"$http_user_agent\" $http_x_forwarded_for'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-97\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#定义本虚拟主机的访问日志</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">access_log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ha97access</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">access</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-99\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-100\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#对 \"/\" 启用反向代理</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-102\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_pass </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//127.0.0.1:88;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-103\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_redirect </span><span class=\"crayon-v\">off</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-104\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header<span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Real</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">IP</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote_addr</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-105\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-106\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header<span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Forwarded</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">For</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">proxy_add_x_forwarded_for</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-107\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#以下是一些反向代理的配置，可选。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-108\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_set_header </span><span class=\"crayon-i\">Host</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-109\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client_max_body</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10m</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#允许客户端请求的最大单文件字节数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-110\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client_body_buffer</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#缓冲区代理缓冲用户端请求的最大字节数，</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-111\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#nginx跟后端服务器连接超时时间(代理连接超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-112\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_send</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#后端服务器数据回传时间(代理发送超时)</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-113\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_read</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#连接成功后，后端服务器响应时间(代理接收超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-114\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_buffer</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#设置代理服务器（nginx）保存用户头信息的缓冲区大小</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-115\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy</span><span class=\"crayon-sy\">_</span>buffers<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#proxy_buffers缓冲区，网页平均在32k以下的设置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-116\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_busy_buffers</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#高负荷下缓冲大小（proxy_buffers*2）</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-117\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_temp_file_write</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-118\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#设定缓存文件夹大小，大于这个值，将从upstream服务器传</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-119\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-120\"> </div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-121\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#设定查看Nginx状态的地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-122\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">NginxStatus</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-123\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">stub_status </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-124\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">access_log </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-125\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">auth</span><span class=\"crayon-sy\">_</span>basic<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NginxStatus\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-126\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">auth_basic_user_file </span><span class=\"crayon-v\">conf</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">htpasswd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-127\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#htpasswd文件的内容可以用apache提供的htpasswd工具来产生。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-128\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-129\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-130\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#本地动静分离反向代理配置</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-131\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#所有jsp的页面均交由tomcat或resin处理</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jsp</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jspx</span><span class=\"crayon-o\">|</span><span class=\"crayon-st\">do</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-133\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_set_header </span><span class=\"crayon-i\">Host</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-134\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header<span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Real</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">IP</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote_addr</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-135\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header<span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Forwarded</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">For</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">proxy_add_x_forwarded_for</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-136\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_pass </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//127.0.0.1:8080;</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-137\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-138\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#所有静态文件由nginx直接读取不经过tomcat或resin</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">htm</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">gif</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpeg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">png</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">bmp</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">swf</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">ioc</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">rar</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">zip</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">txt</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">flv</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">mid</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">doc</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">ppt</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">pdf</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">xls</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">mp3</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">wma</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-140\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15d</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-141\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">js</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-142\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1h</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719f027a735981271090-143\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719f027a735981271090-144\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0259 seconds] -->\r\n<p></p>\n<div></div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111765\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111765votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111765\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "4e2323f618189ba713417f1ffdd20900", "com_num": 0, "title": "Nginx 配置文件 nginx.conf 详解", "url": "http://blog.jobbole.com/111765/", "praise_num": "2", "front_image_path": "full/2d4fd40c8eaec8319c1de2f154b3275aecd23f9d.jpg", "create_date": "2017/07/18", "tags": "IT技术,Nginx", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"]},{"fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/zhenbianshu/p/7197349.html\">枕边书</a>   </div><div>\n<h2 id=\"toc_0\">问题由来</h2>\n<p>前些天工作中遇到一个问题：</p>\n<blockquote><p>有 60万 条短消息记录日志，每条约 50 字，5万 关键词，长度 2-8 字，绝大部分为中文。要求将这 60万 条记录中包含的关键词全部提取出来并统计各关键词的命中次数。</p></blockquote>\n<p>本文完整介绍了我的实现方式，看我如何将需要运行十小时的任务优化到十分钟以内。虽然实现语言是 PHP，但本文介绍的更多的思想，应该能给大家一些帮助。</p>\n<h2 id=\"toc_1\">原始 – grep</h2>\n<h3 id=\"toc_2\">设计</h3>\n<p>一开始接到任务的时候，我的小心思立刻转了起来，<strong>日志 + 关键词 + 统计</strong>，我没有想到自己写代码实现，而是首先想到了 linux 下常用的日志统计命令 <span style=\"color: #ff0000;\"><code>grep</code></span>。</p>\n<p><span style=\"color: #ff0000;\"><code>grep</code></span>命令的用法不再多提，使用 <span style=\"color: #ff0000;\"><code>grep 'keyword' | wc -l</code></span> 可以很方便地进行统计关键词命中的信息条数，而php的 <span style=\"color: #ff0000;\"><code>exec()</code></span> 函数允许我们直接调用 linux 的 shell 命令，虽然这样执行危险命令时会有安全隐患。</p>\n<h3 id=\"toc_3\">代码</h3>\n<p>上伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c00612090704\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nforeach ($word_list as $keyword) {\r\n    $count = intval(exec(\"grep '{$keyword}' file.log | wc -l\"));\r\n    record($keyword, $count);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c00612090704-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c00612090704-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c00612090704-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c00612090704-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c00612090704-1\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">word_list </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c00612090704-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">intval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"grep '{$keyword}' file.log | wc -l\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c00612090704-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">record</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c00612090704-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>在一台老机器上跑的，话说老机器效率真的差，跑了6小时。估计最新机器2-3小时吧，后面的优化都使用的新机器，而且需求又有变动，正文才刚刚开始。</p>\n<p><em>原始，原始在想法和方法</em>。</p>\n<h2 id=\"toc_4\">进化 – 正则</h2>\n<h3 id=\"toc_5\">设计</h3>\n<p>交了差之后，第二天产品又提出了新的想法，说以后想把某数据源接入进来，消息以数据流的形式传递，而不再是文件了。而且还要求了消息统计的实时性，一下把我想把数据写到文件再统计的想法也推翻了，为了方案的可扩展性，现在的统计对象不再是一个整体，而是要考虑拿n个单条的消息来匹配了。</p>\n<p>这时，略懵的我只好祭出了最传统的工具- 正则。正则的实现也不难，各个语言也都封装好了正则匹配函数，重点是模式(pattern)的构建。</p>\n<p>当然这里的模式构建也不难，<span style=\"color: #ff0000;\"><code>/keyword1|keword2|.../</code></span>，用<span style=\"color: #ff0000;\"><code>|</code></span>将关键词连接起来即可。</p>\n<h3 id=\"toc_6\">正则小坑</h3>\n<p>这里介绍两个使用中遇到的小坑：</p>\n<ul>\n<li>正则模式长度太长导致匹配失败：PHP 的正则有回溯限制，以防止消耗掉所有的进程可用堆栈, 最终导致 php 崩溃。太长的模式会导致 PHP 检测到回溯过多，中断匹配，经测试默认设置时最大模式长度为 32000 字节 左右。php.ini 内 <span style=\"color: #ff0000;\"><code>pcre.backtrack_limit</code></span> 参数为最大回溯次数限制，默认值为 1000000，修改或 <span style=\"color: #ff0000;\"><code>php.ini</code></span> 或在脚本开始时使用 <span style=\"color: #ff0000;\"><code>ini_set(‘pcre.backtrack_limit’, n);</code></span> 将其设置为一个较大的数可以提高单次匹配最大模式长度。当然也可以将关键词分批统计（我用了这个=_=）。</li>\n<li>模式中含有特殊字符导致大量warning：匹配过程中发现 PHP 报出大量 warning：<span style=\"color: #ff0000;\"><code>unknown modifier <strong>乱码</strong></code></span>，仔细检查发现关键词中有<span style=\"color: #ff0000;\"><code>/</code></span>字符，可以使用<span style=\"color: #ff0000;\"><code>preg_quote()</code></span>函数过滤一遍关键词即可。</li>\n</ul>\n<h3 id=\"toc_7\">代码</h3>\n<p>上伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c0c137414539\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$end = 0;\r\n$step = 1500;\r\n$pattern = array();\r\n// 先将pattern 拆成多个小块\r\nwhile ($end &lt; count($word_list)) {\r\n    $tmp_arr = array_slice($word_list, $end, $step);\r\n    $end += $step;\r\n    $item = implode('|', $tmp_arr);\r\n    $pattern[] = preg_quote($item);\r\n}\r\n\r\n$content = file_get_contents($log_file);\r\n$lines = explode(\"\\n\", $content);\r\nforeach ($lines as $line) {\r\n    // 使用各小块pattern分别匹配\r\n    for ($i = 0; $i &lt; count($pattern); $i++) {\r\n        preg_match_all(\"/{$pattern[$i]}/\", $line, $match);\r\n    }\r\n    $match = array_unique(array_filter($match));\r\n    dealResult($match);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-4\"><span class=\"crayon-c\">// 先将pattern 拆成多个小块</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-5\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_arr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_slice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'|'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_arr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preg_quote</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">log_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">explode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-14\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">lines </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 使用各小块pattern分别匹配</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">preg_match_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/{$pattern[$i]}/\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_unique</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">dealResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>为了完成任务，硬着头皮进程跑了一夜。当第二天我发现跑了近十个小时的时候内心是崩溃的。。。太慢了，完全达不到使用要求，这时，我已经开始考虑改换方法了。</p>\n<p>当产品又改换了关键词策略，替换了一些关键词，要求重新运行一遍，并表示还会继续优化关键词时，我完全否定了现有方案。绝对不能用关键词去匹配信息，这样一条一条用全部关键词去匹配，效率实在是不可忍受。</p>\n<p><em>进化，需求和实现的进化</em></p>\n<h2 id=\"toc_8\">觉醒 – 拆词</h2>\n<h3 id=\"toc_9\">设计</h3>\n<p>我终于开始意识到要拿信息去关键词里对比。如果我用关键词为键建立一个 hash 表，用信息里的词去 hash 表里查找，如果查到就认为匹配命中，这样不是能达到 O(1) 的效率了么？</p>\n<p>可是一条短消息，我如何把它拆分为刚好的词去匹配呢，分词？分词也是需要时间的，而且我的关键词都是些无语义的词，构建词库、使用分词工具又是很大的问题，最终我想到 <span style=\"color: #ff0000;\"><code>拆词</code></span>。</p>\n<p>为什么叫拆词呢，我考虑以蛮力将一句话拆分为<span style=\"color: #ff0000;\"><code><strong>所有可能</strong>的</code></span>词。如（<strong><span style=\"color: #ff0000;\"><code>我是好人）</code></span></strong>就可以拆成（<strong><span style=\"color: #ff0000;\"><code>我是、是好、好人、我是好、是好人、我是好人）</code></span></strong>等词，我的关键词长度为 2-8，所以可拆词个数会随着句子长度迅速增加。不过，可以用标点符号、空格、语气词（如<span style=\"color: #ff0000;\"><code>的、是</code></span>等）作为分隔将句子拆成小短语再进行拆词，会大大减少拆出的词量。</p>\n<p>其实分词并没有完整实现就被后一个方法替代了，只是一个极具实现可能的构想，写这篇文章时用伪代码实现了一下，供大家参考，即使不用在匹配关键词，用在其他地方也是有可能的。</p>\n<h3>代码</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c12755180361\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$str_list = getStrList($msg);\r\nforeach ($str_list as $str) {\r\n    $keywords = getKeywords($str);\r\n    foreach ($keywords as $keyword) {\r\n        // 直接通过PHP数组的哈希实现来进行快速查找\r\n        if (isset($word_list[$keyword])) {\r\n            record($keyword);\r\n        }\r\n    }\r\n}\r\n/**\r\n * 从消息中拆出短句子\r\n */\r\nfunction getStrList($msg) {\r\n    $str_list = array();\r\n    $seperators = array('，', '。', '的', ...);\r\n\r\n    $words = preg_split('/(?&lt;!^)(?!$)/u', $msg);\r\n    $str = array();\r\n    foreach ($words as $word) {\r\n        if (in_array($word, $seperators)) {\r\n            $str_list[] = $str;\r\n            $str = array();\r\n        } else {\r\n            $str[] = $word;\r\n        }\r\n    }\r\n\r\n    return array_filter($str_list);\r\n}\r\n\r\n/**\r\n * 从短句中取出各个词\r\n */\r\nfunction getKeywords($str) {\r\n    if (count($str) &lt; 2) {\r\n        return array();\r\n    }\r\n\r\n    $keywords = array();\r\n    for ($i = 0; $i &lt; count($str); $i++) {\r\n        for ($j = 2; $j &lt; 9; $j++) {\r\n            $keywords[] = array_slice($str, $i, $j); // todo 限制一下不要超过数组最大长度\r\n        }\r\n    }\r\n\r\n    return $keywords;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-48\">48</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStrList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-2\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">str_list </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getKeywords</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">keywords </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 直接通过PHP数组的哈希实现来进行快速查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">record</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-11\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-12\"><span class=\"crayon-c\"> * 从消息中拆出短句子</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-13\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-14\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStrList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">seperators</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'，'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'。'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'的'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preg_split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/(?&lt;!^)(?!$)/u'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">words </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">in_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">seperators</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-28\"> </div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-30\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-32\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-33\"><span class=\"crayon-c\"> * 从短句中取出各个词</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-34\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-35\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getKeywords</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_slice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// todo 限制一下不要超过数组最大长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-46\"> </div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-48\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0071 seconds] -->\r\n<p></p>\n<h3 id=\"toc_11\">结果</h3>\n<p>我们知道一个 <span style=\"color: #ff0000;\"><code>utf-8</code></span> 的中文字符要占用三个字节，为了拆分出包含中英文的每一个字符，使用简单的 <span style=\"color: #ff0000;\"><code>split()</code></span> 函数是做不到的。</p>\n<p>这里使用了 <span style=\"color: #ff0000;\"><span style=\"color: #ff0000;\"><code>preg_split('/(?&lt;!^)(?!$)/u', $msg)</code></span></span> 是通过正则匹配到两个字符之间的<span style=\"color: #ff0000;\"><code>''</code></span>来将两个字符拆散，而两个括号里的 <span style=\"color: #ff0000;\"><code>(?&lt;!^)(?!$)</code></span> 是分别用来限定捕获组不是第一个，也不是最后一个（不使用这两个捕获组限定符也是可以的，直接使用<span style=\"color: #ff0000;\"><code>//</code></span>作为模式会导致拆分结果在前后各多出一个空字符串项）。  捕获组的概念和用法可见我之前的博客 <a href=\"http://www.cnblogs.com/zhenbianshu/p/4941964.html\">PHP正则中的捕获组与非捕获组</a></p>\n<p>由于没有真正实现，也不知道效率如何。估算每个短句长度约为 10 字左右时，每条短消息约50字左右，会拆出 200 个词。虽然它会拆出很多无意义的词，但我相信效率绝不会低，由于其 hash 的高效率，甚至我觉得会可能比终极方法效率要高。</p>\n<p>最终没有使用此方案是因为它对句子要求较高，拆词时的分隔符也不好确定，最重要的是它不够优雅。。。这个方法我不太想去实现，统计标识和语气词等活显得略为笨重，而且感觉拆出很多无意义的词感觉效率浪费得厉害。</p>\n<p><em>觉醒，意识和思路的觉醒</em></p>\n<h2 id=\"toc_12\">终级 – Trie树</h2>\n<h3 id=\"toc_13\">trie树</h3>\n<p>于是我又来找谷哥帮忙了，搜索大量数据匹配，有人提出了 使用 trie 树的方式，没想到刚学习的 trie 树的就派上了用场。我上上篇文章刚介绍了 trie 树，在<a href=\"http://www.cnblogs.com/zhenbianshu/p/7061550.html\">空间索引 – 四叉树</a> 里<span style=\"color: #ff0000;\"><code>字典树</code></span>这一小节，大家可以查看一下。</p>\n<p>当然也为懒人复制了一遍我当时的解释(看过的可以跳过这一小节了)。</p>\n<blockquote><p>字典树，又称前缀树或 trie 树，是一种有序树，用于保存关联数组，其中的键通常是字符串。与二叉查找树不同，键不是直接保存在节点中，而是由节点在树中的位置决定。一个节点的所有子孙都有相同的前缀，也就是这个节点对应的字符串，而根节点对应空字符串。</p></blockquote>\n<p>我们可以类比字典的特性：我们在字典里通过拼音查找晃(<span style=\"color: #ff0000;\"><code>huang</code></span>)这个字的时候，我们会发现它的附近都是读音为<span style=\"color: #ff0000;\"><code>huang</code></span>的，可能是声调有区别，再往前翻，我们会看到读音前缀为<span style=\"color: #ff0000;\"><code>huan</code></span>的字，再往前，是读音前缀为<span style=\"color: #ff0000;\"><code>hua</code></span>的字… 取它们的读音前缀分别为 <span style=\"color: #ff0000;\"><code>h qu hua huan huang</code></span>。我们在查找时，根据 <span style=\"color: #ff0000;\"><code>abc...xyz</code></span> 的顺序找到<span style=\"color: #ff0000;\"><code>h</code></span>前缀的部分，再根据 <span style=\"color: #ff0000;\"><code>ha he hu</code></span>找到 <span style=\"color: #ff0000;\"><code>hu</code></span> 前缀的部分…最后找到 <span style=\"color: #ff0000;\"><code>huang</code></span>，我们会发现，越往后其读音前缀越长，查找也越精确，这种类似于字典的树结构就是字典树，也是前缀树。</p>\n<h2 id=\"toc_14\">设计</h2>\n<p>那么 trie 树怎么实现关键字的匹配呢? 这里以一幅图来讲解 trie 树匹配的过程。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png\"><img class=\"aligncenter wp-image-111935 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png\" alt=\"1\" width=\"396\" height=\"493\"></a></p>\n<p>其中要点：</p>\n<h4 id=\"toc_15\">构造trie树</h4>\n<ol>\n<li>将关键词用上面介绍的<span style=\"color: #ff0000;\"><code>preg_split()</code></span>函数拆分为单个字符。如<span style=\"color: #ff0000;\"><code>科学家</code></span>就拆分为<span style=\"color: #ff0000;\"><code>科、学、家</code></span>三个字符。</li>\n<li>在最后一个字符后添加一个特殊字符<span style=\"color: #ff0000;\"><code>`</code></span>，此字符作为一个关键词的结尾（图中的粉红三角），以此字符来标识查到了一个关键词（不然，我们不知道匹配到<span style=\"color: #ff0000;\"><code>科、学</code></span>两个字符时算不算匹配成功）。</li>\n<li>检查根部是否有第一个字符(<span style=\"font-family: Monaco, Consolas, 'Andale Mono', 'DejaVu Sans Mono', monospace;\">科</span>)节点，如果有了此节点，到<code style=\"font-weight: bold;\">步骤4</code>。 如果还没有，在根部添加值为<code style=\"font-weight: bold;\">科</code>的节点。</li>\n<li>依次检查并添加<span style=\"color: #ff0000;\"><code>学、家</code></span> 两个节点。</li>\n<li>在结尾添加 <span style=\"color: #ff0000;\"><code>`</code></span> 节点，并继续下一个关键词的插入。</li>\n</ol>\n<h4 id=\"toc_16\">匹配</h4>\n<p>然后我们以 <span style=\"color: #ff0000;\"><code><strong>这位科学家很了不起</strong>！</code></span>为例来发起匹配。</p>\n<ul>\n<li>首先我们将句子拆分为单个字符 <strong><span style=\"color: #ff0000;\"><code>这、位</code></span><span style=\"color: #ff0000;\"><code>、...</code></span>；</strong></li>\n<li>从根查询第一个字符<span style=\"color: #ff0000;\"><code>这</code></span>，并没有以这个字符开头的关键词，将字符“指针”向后移，直到找到根下有的字符节点<strong><span style=\"color: #ff0000;\"><code>科</code></span></strong>;</li>\n<li>接着在节点<span style=\"color: #ff0000;\"><code>科</code></span>下寻找值为 <strong><span style=\"color: #ff0000;\"><code>学</code></span></strong>节点，找到时，结果子树的深度已经到了2，关键词的最短长度是2，此时需要在<span style=\"color: #ff0000;\"><code>学</code></span>结点下查找是否有<span style=\"color: #ff0000;\"><span style=\"color: #ff0000;\"><code>`</code></span></span>，找到意味着匹配成功，返回关键词，并将字符“指针”后移，如果找不到则继续在此结点下寻找下一个字符。</li>\n<li>如此遍历，直到最后，返回所有匹配结果。</li>\n</ul>\n<h3 id=\"toc_17\">代码</h3>\n<p>完整代码我已经放到了GitHub上：<a href=\"https://github.com/zhenbianshu/DataStructureAndAlgorithm/blob/master/keyword_match_trie.php\">Trie-GitHub-zhenbianshu</a>，这里放上核心。</p>\n<p>首先是数据结构树结点的设计，当然它也是重中之重：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c1a702428477\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$node = array(\r\n    'depth' =&gt; $depth, // 深度，用以判断已命中的字数\r\n    'next' =&gt; array(\r\n        $val =&gt; $node, // 这里借用php数组的哈希底层实现，加速子结点的查找\r\n        ...\r\n    ),\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1a702428477-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1a702428477-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1a702428477-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1a702428477-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1a702428477-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1a702428477-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1a702428477-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c1a702428477-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1a702428477-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 深度，用以判断已命中的字数</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1a702428477-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'next'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1a702428477-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 这里借用php数组的哈希底层实现，加速子结点的查找</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1a702428477-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1a702428477-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1a702428477-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>然后是树构建时子结点的插入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c1e419325918\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 这里要往节点内插入子节点，所以将它以引用方式传入\r\nprivate function insert(&amp;$node, $words) {\r\n         if (empty($words)) {\r\n            return;\r\n        }\r\n        $word = array_shift($words);\r\n        // 如果子结点已存在，向子结点内继续插入\r\n        if (isset($node['next'][$word])) {\r\n            $this-&gt;insert($node['next'][$word], $words);\r\n        } else {\r\n            // 子结点不存在时，构造子结点插入结果\r\n            $tmp_node = array(\r\n                'depth' =&gt; $node['depth'] + 1,\r\n                'next' =&gt; array(),\r\n            );\r\n            $node['next'][$word] = $tmp_node;\r\n            $this-&gt;insert($node['next'][$word], $words);\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-1\"><span class=\"crayon-c\">// 这里要往节点内插入子节点，所以将它以引用方式传入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 如果子结点已存在，向子结点内继续插入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 子结点不存在时，构造子结点插入结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'next'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_node</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>最后是查询时的操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c22218446252\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 这里也可以使用一个全局变量来存储已匹配到的字符，以替换$matched\r\nprivate function query($node, $words, &amp;$matched) {\r\n        $word = array_shift($words);\r\n        if (isset($node['next'][$word])) {\r\n            // 如果存在对应子结点，将它放到结果集里\r\n            array_push($matched, $word);\r\n            // 深度到达最短关键词时，即可判断是否到词尾了\r\n            if ($node['next'] &gt; 1 &amp;&amp; isset($node['next'][$word]['next']['`'])) {\r\n                return true;\r\n            }\r\n            return $this-&gt;query($node['next'][$word], $words, $matched);\r\n        } else {\r\n            $matched = array();\r\n            return false;\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-1\"><span class=\"crayon-c\">// 这里也可以使用一个全局变量来存储已匹配到的字符，以替换$matched</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 如果存在对应子结点，将它放到结果集里</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">array_push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 深度到达最短关键词时，即可判断是否到词尾了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'`'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p></p>\n<h3 id=\"toc_18\">结果</h3>\n<p>结果当然是喜人的，如此匹配，处理一千条数据只需要3秒左右。找了 Java 的同事试了下，Java 处理一千条数据只需要1秒。</p>\n<p>这里来分析一下为什么这种方法这么快：</p>\n<ul>\n<li>正则匹配：要用所有的关键词去信息里匹配匹配次数是 <span style=\"color: #ff0000;\"><code>key_len * msg_len</code></span>，当然正则会进行优化，但基础这样，再优化效率可想而知。</li>\n<li>而 trie 树效率最差的时候是<strong> <span style=\"color: #ff0000;\"><code>msg_len * 9(最长关键词长度 + 1个特殊字符)</code></span>次 hash</strong> 查找，即最长关键词类似 <span style=\"color: #ff0000;\"><code>AAA</code></span>，信息内容为 <span style=\"color: #ff0000;\"><code>AAA...</code></span>时，而这种情况的概率可想而知。</li>\n</ul>\n<p>至此方法的优化到此结束，从每秒钟匹配 10 个，到 300 个，30 倍的性能提升还是巨大的。</p>\n<p><em>终级，却不一定是终极</em></p>\n<h2 id=\"toc_19\">他径 – 多进程</h2>\n<h3 id=\"toc_20\">设计</h3>\n<p>匹配方法的优化结束了，开头说的优化到十分钟以内的目标还没有实现，这时候就要考虑一些其他方法了。</p>\n<p>我们一提到高效，必然想到的是 <span style=\"color: #ff0000;\"><code>并发</code></span>，那么接下来的优化就要从并发说起。PHP 是单线程的（虽然也有不好用的多线程扩展），这没啥好的解决办法，并发方向只好从多进程进行了。</p>\n<p>那么一个日志文件，用多个进程怎么读呢？这里当然也提供几个方案：</p>\n<ul>\n<li>进程内添加日志行数计数器，各个进程支持传入参数 n，进程只处理第 行数<span style=\"color: #ff0000;\"><code> % n = n</code></span> 的日志，这种 hack 的反向分布式我已经用得很熟练了，哈哈。这种方法需要进程传参数，还需要每个进程都分配读取整个日志的的内存，而且也不够优雅。</li>\n<li>使用 linux 的 <span style=\"color: #ff0000;\"><code>split -l n file.log output_pre</code></span> 命令，将文件分割为每份为 n 行的文件，然后用多个进程去读取多个文件。此方法的缺点就是不灵活，想换一下进程数时需要重新切分文件。</li>\n<li>使用 Redis 的 list 队列临时存储日志，开启多个进程消费队列。此方法需要另外向 Redis 内写入数据，多了一个步骤，但它扩展灵活，而且代码简单优雅。</li>\n</ul>\n<p>最终使用了第三种方式来进行。</p>\n<h3 id=\"toc_21\">结果</h3>\n<p>这种方式虽然也会有瓶颈，最后应该会落在 Redis 的网络 IO 上。我也没有闲心开 n 个进程去挑战公司 Redis 的性能，运行 10 个进程三四分钟就完成了统计。即使再加上 Redis 写入的耗时，10分钟以内也妥妥的。</p>\n<p>一开始产品对匹配速度已经有了小时级的定位了，当我 10 分钟就拿出了新的日志匹配结果，看到产品惊讶的表情，心里也是略爽的，哈哈~</p>\n<p><em>他径，也能帮你走得更远</em></p>\n<h2 id=\"toc_22\">总结</h2>\n<p>解决问题的方法有很多种，我认为在解决各种问题之前，要了解很多种知识，即使只知道它的作用。就像一个工具架，你要先把工具尽量摆得多，才能在遇到问题时选取一个最合适的。接着当然要把这些工具用是纯熟了，这样才能使用它们去解决一些怪异问题。</p>\n<p>工欲善其事，必先利其器，要想解决性能问题，掌握系统级的方法还略显不够，有时候换一种数据结构或算法，效果可能会更好。感觉自己在这方面还略显薄弱，慢慢加强吧，各位也共勉。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111934\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111934votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111934\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "69121d473d20cb45ed412306e1883d3f", "com_num": 0, "title": "10小时到10分钟，一步步优化巨量关键词的匹配", "url": "http://blog.jobbole.com/111934/", "praise_num": "1", "front_image_path": "full/d91c8c6ea6d894ebf725cdccfda0bccf6f675e36.jpg", "create_date": "2017/07/19", "tags": "IT技术,php,正则表达式", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png"]},{"fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://m.signalvnoise.com/manufacturing-quality-time-fe043fa7b7a1#.7w18xpuzd\">DHH</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：《<a href=\"http://blog.jobbole.com/111892/\" target=\"_blank\">代码写的好，出过畅销书，还拿过赛车冠军，这是一种什么体验？</a>》这篇文章中已经介绍了 DHH。他既是 Ruby On Rails 之父，BaseCamp 的 CTO，又是一个家庭主男，业余还会参加赛车比赛，还爱好摄影，那他是如何兼顾着这一切的呢？</p>\n<p>的确也经常有人问他这个问题。不了解他的人，觉得他一定有些秘密或窍门。每晚只睡 5 小时？还是持续几个月每天工作 12 小时？还是其他什么的。</p>\n<p>2015 年 12 月 30 日，DHH 专门写了一篇文章，分享了他的答案。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg\" width=\"600\" height=\"342\"></p>\n<p style=\"text-align: left;\">“高效能人群”的共同点仅仅是他们更加努力地工作，通常像超人似的。对单一事物的关注/专注，是驱使他们工作到晚上 11 点的动力。而媒体喜欢报道他们这样那样的非凡毅力和决心。</p>\n<p>但我不吃这一套，我通常每晚的睡眠时间是 8.5 至 9 小时，并每周 40 小时。我不想在工作上花更多的时间。</p>\n<p><span style=\"color: #ff0000;\"><strong>如果一定要我说有什么技巧，那就是我追求每个小时的质量</strong></span>。不过这不代表着「<strong>时间管理</strong>」，该词出现于上世纪 90 年代，意思是将每个小时切分到最后一分钟，以压榨提高每秒的生产力峰值。但时间管理确实说明了一件事：<strong>每个小时的价值不尽相同</strong>。</p>\n<p>如果一小时充满了压力、中断、缺觉或者疲惫，在这种状态下工作，你对不起这一小时中的每一分钟。因为它是低质量的一小时。如果妄想通过这样低质时间能够做出好东西，明显非常愚蠢。因为你最终也只能「<strong>垃圾进来，垃圾出去</strong>」。</p>\n<p><strong>每周工作 40 小时，是一个王者的固守。</strong>在这样的前提下，我认为几乎可以完成所有的东西。当然了，前提是你没有把时间浪费在会议、一心多用或定义不清的问题上。这些都是吞噬时间的黑洞，深不见底。</p>\n<p>好吧，即便没有黑洞，但也有物理极限的（ 1 天只有 24 小时），我相信很多人都觉得自己是时间的穷人！如果花了时间但一事无成，你不能怪我，而我也不怪自己。<span style=\"color: #000000;\">怜悯是我们仅剩的借口了。</span></p>\n<p>自我保护或让别人帮你，也许能给你带来暂时的舒适，但从长久来看，它掩盖不了缺乏理想的窘境。面对失败，放弃是一种应对的机制。</p>\n<p>你需要的是一套精细的技术，需要积极努力地提高时间的纯度和质量。以下是我使用的几个小窍门：</p>\n<h3>1、我真的需要参与其中吗？</h3>\n<p>贪婪的好奇心会让你无休止地卷入各种讨论、决定和事件中，尽管是否有你，那些事可能区别都不大。</p>\n<p>你提出的想法或经验，“可能”对他人有用，但你也同样剥夺了他人自由思考的权利，这点可能让你难以接受。</p>\n<p>目前看来，略读邮件、拒绝会议邀请、不要在聊天中发表你的看法，这些举措可能还挺深奥的。但通过努力克制自己、避免插嘴和介入合作，能够让你集中时间花在少量的事上，以取得更重要的进展。</p>\n<h3>2、这个/这事还能等等吗？</h3>\n<p>有些问题需要今天处理掉，否则就是明天的麻烦。你最好马上处理掉那些问题，虽然它们通常只占少数。大多数的问题和机会值得从现在起，花上一天、一周甚至一月的时间来处理。</p>\n<p>将手上的事先搁置一边，可能等你回头再看的时候，它就不是事儿了。是不是很棒？！这些是不需要立刻做的工作，或者只是一开始认为非常重要，实则不然。</p>\n<p>花在解决问题上的时间越长，你会对这个问题有着更深入的了解。随着空闲时间的投入，解决问题的痛苦将大大减少。</p>\n<h3>3、我能放弃吗？</h3>\n<p>浪费了高质量时间的代价，往往最终浪费了一天的时间。而错误估计了问题的深度，也是工作和生活中的一个常见过失。</p>\n<p>当意识到现在的问题比当初预期的更难，却不承认解决问题需要花费比原计划更多的时间，结果通常是越陷越深，从而浪费更多的时间。</p>\n<p>学会放弃是一项关键的技能，能够让你专注于剩下的时间。只有失败者才会在<strong>沉没成本</strong>上下赌注。</p>\n<blockquote><p>伯乐在线补充：<strong>沉没成本</strong>是指由于过去的决策已经发生了的，而不能由现在或将来的任何决策改变的成本。人们在决定是否去做一件事情的时候，不仅是看这件事对自己有没有好处，而且也看过去是不是已经在这件事情上有过投入。我们把这些已经发生不可收回的支出，如时间、金钱、精力等称为“沉没成本”（Sunk Cost）。在经济学和商业决策制定过程中会用到“沉没成本”的概念，代指已经付出且不可收回的成本。沉没成本常用来和可变成本作比较，可变成本可以被改变，而沉没成本则不能被改变。</p></blockquote>\n<h3>4、我准备好了吗？</h3>\n<p>有时，问题需要更多的时间来发酵，你也需要更多的时间来成长。你我都做不到能够同时解决所有的问题。</p>\n<p>如果我本周适合写作，那完成新网站的拷贝工作会是一个好选择，但安排下个季度的工作情况则不是一个好的时机。如果我本周手指发痒想写代码，那正好可以尝试解决那个困扰了我一个月的 bug，但是却不适合做一对一面试。</p>\n<p>我们的情绪会如潮水般上下起伏，在激情和消沉之间摇摆不定。顺势而为要比逆势前行轻松得多。就像上文的例子一样，大多数事情都可以推延到合适的情绪下再做。</p>\n<p>即使你掌握了强大的技巧，让每一个小时都更有价值，失败仍然不可避免。原因也许只是本周所有要做的工作并不能激起你的激情。一旦激情消失，你会倍感失落。</p>\n<p>知道真相或许会给你巨大的心理安慰：每个人都会经历低潮，尽管大部分人都不承认这一点。即使有着经过打磨的高品质时间，我仍然经常生产出垃圾，比我预期得还要多。就是这么回事儿！</p>\n<p>长久来看，关键在于你要不断提高时间的质量，即使没有得到一个好的结果，也不要给自己过多的压力。</p>\n<p>一旦你建立了对高质量时间的正确认识和积极态度，我相信你就不会一味地追求更多的时间。高质量的四个连续小时和几天的垃圾（低质量）时间完全不可同日而语，两者相差悬殊。</p>\n<p>即便你对时间进行压缩以获取更多的时间，你可能也就多了 20% 到 50% 的时间；但对拥有的时间进行规划和打磨，你可能会得到 200% 到 500% 的额外价值。<span style=\"color: #ff0000;\"><strong>这才是真正的 10 倍效率！</strong></span></p>\n<p><strong>兼顾一切的窍门是停止兼顾。</strong></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111888\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111888votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111888\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 28</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "32fb6fb546aac0808415e5f45c8f324a", "com_num": 0, "title": "编程、出书、赛车……DHH 是如何兼顾这一切的？", "url": "http://blog.jobbole.com/111888/", "praise_num": "1", "front_image_path": "full/5d6df9368785d41523d2ae0a30beadd79fb92b3a.jpg", "create_date": "2017/07/19", "tags": "职场,DHH", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg"]},{"fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.iteye.com/news/32473\">首发《程序员》杂志</a>   </div><div>\n<blockquote>作者：雷鹏，Terark核心技术发明人。曾就职奇虎360，负责搜索引擎核心研发；曾就职Yahoo！北研所负责搜索广告、广告交易（AdExchange）等项目。在数据库、高性能计算、分布式、系统架构上都深有造诣。</blockquote>\n</div>\n<p>作为数据库，在系统资源（CPU、内存、SSD、磁盘等）一定的前提下，我们希望：</p>\n<ul>\n<li><strong>存储的数据更多：</strong>采用压缩，这个世界上有各种各样的压缩算法；</li>\n<li><strong>访问的速度更快：</strong>更快的压缩（写）/解压（读）算法、更大的缓存。</li>\n</ul>\n<p>几乎所有压缩算法都严重依赖上下文：</p>\n<ul>\n<li>位置相邻的数据，一般情况下相关性更高，内在冗余度更大；</li>\n<li>上下文越大，压缩率的上限越大（有极限值）。</li>\n</ul>\n<p><strong>块压缩</strong></p>\n<p><strong>传统数据库中的块压缩技术</strong></p>\n<p>对于普通的以数据块/文件为单位的压缩，传统的（流式）数据压缩算法工作得不错，时间长了，大家也都习惯了这种数据压缩的模式。基于这种模式的数据压缩算法层出不穷，不断有新的算法实现。包括使用最广泛的gzip、bzip2、Google的Snappy、新秀Zstd等。</p>\n<ul>\n<li>gzip几乎在在所有平台上都有支持，并且也已经成为一个行业标准，压缩率、压缩速度、解压速度都比较均衡；</li>\n<li>bzip2是基于BWT变换的一种压缩，本质是上对输入分块，每个块单独压缩，优点是压缩率很高，但压缩和解压速度都比较慢；</li>\n<li>Snappy是Google出品，优点是压缩和解压都很快，缺点是压缩率比较低，适用于对压缩率要求不高的实时压缩场景；</li>\n<li>LZ4是Snappy一个强有力的竞争对手，速度比Snappy更快，特别是解压速度；</li>\n<li>Zstd是一个压缩新秀，压缩率比LZ4和Snappy都高不少，压缩和解压速度略低；相比gzip，压缩率不相上下，但压缩/解压速度要高很多。</li>\n</ul>\n<p>对于数据库，在计算机世界的太古代，为I/O优化的Btree一直是不可撼动的，为磁盘优化的Btree block/page size比较大，正好让传统数据压缩算法能得到较大的上下文，于是，基于block/page的压缩也就自然而然地应用到了各种数据库中。在这个蛮荒时代，内存的性能、容量与磁盘的性能、容量泾渭分明，各种应用对性能的需求也比较小，大家都相安无事。</p>\n<p>现在，我们有了SSD、PCIe SSD、3D XPoint等，内存也越来越大，块压缩的缺点也日益突出：</p>\n<ul>\n<li>块选小了，压缩率不够；块选大了，性能没法忍；</li>\n<li>更致命的是，块压缩节省的只是更大更便宜的磁盘、SSD；</li>\n<li>更贵更小的内存不但没有节省，反而更浪费了（双缓存问题）。</li>\n</ul>\n<p>于是，对于很多实时性要求较高的应用，只能关闭压缩。</p>\n<p><strong>块压缩的原理</strong></p>\n<p>使用通用压缩技术（Snappy、LZ4、zip、bzip2、Zstd等），按块/页（block/page）进行压缩（块尺寸通常是4KB~32KB，以压缩率著称的TokuDB块尺寸是2MB~4MB），这个块是逻辑块，而不是内存分页、块设备概念中的那种物理块。</p>\n<p>启用压缩时，随之而来的是访问速度下降，这是因为：</p>\n<ul>\n<li>写入时，很多条记录被打包在一起压缩成一个个的块，增大块尺寸，压缩算法可以获得更大的上下文，从而提高压缩率；相反地，减小块尺寸，会降低压缩率。</li>\n<li>读取时，即便是读取很短的数据，也需要先把整个块解压，再去读取解压后的数据。这样，块尺寸越大，同一个块内包含的记录数目越多。为读取一条数据，所做的不必要解压就也就越多，性能也就越差。相反地，块尺寸越小，性能也就越好。</li>\n</ul>\n<p>一旦启用压缩，为了缓解以上问题，传统数据库一般都需要比较大的专用缓存，用来缓存解压后的数据，这样可以大幅提高热数据的访问性能，但又引起了双缓存的空间占用问题：一是操作系统缓存中的压缩数据；二是专用缓存（例如RocksDB中的DBCache）中解压后的数据。还有一个同样很严重的问题：专用缓存终归是缓存，当缓存未命中时，仍需要解压整个块，这就是慢Query问题的一个主要来源（慢Query的另一个主要来源是在操作系统缓存未命中时）。</p>\n<p>这些都导致现有传统数据库在访问速度和空间占用上是一个此消彼长、无法彻底解决的问题，只能采取一些折衷。</p>\n<p><strong>RocksDB 的块压缩</strong></p>\n<p>以RocksDB为例，RocksDB中的BlockBasedTable就是一个块压缩的SSTable，使用块压缩，索引只定位到块，块的尺寸在dboption里设定，一个块中包含多条（key，value）数据，例如M条，这样索引的尺寸就减小到了1/M：</p>\n<ul>\n<li>M越大，索引的尺寸越小；</li>\n<li>M越大，Block的尺寸越大，压缩算法（gzip、Snappy等）可以获得的上下文也越大，压缩率也就越高。</li>\n</ul>\n<p>创建BlockBasedTable时，Key Value被逐条填入buffer，当buffer尺寸达到预定大小（块尺寸，当然，一般buffer尺寸不会精确地刚好等于预设的块尺寸），就将buffer压缩并写入BlockBasedTable文件，并记录文件偏移和buffer中的第一个Key（创建index要用），如果单条数据太大，比预设的块尺寸还大，这条数据就单独占一个块（单条数据不管多大也不会分割成多个块）。所有Key Value写完以后，根据之前记录的每个块的起始Key和文件偏移，创建一个索引。所以在BlockBasedTable文件中，数据在前，索引在后，文件末尾包含元信息（作用相当于常用的FileHeader，只是位置在文件末尾，所以叫footer）。</p>\n<p>搜索时，先使用searchkey找到searchkey所在的block，然后到DB Cache中搜索这个块，找到后就进一步在块中搜索searchkey，如果找不到，就从磁盘/SSD读取这个块，解压后放入DB Cache。RocksDB中的DB Cache有多种实现，常用的包括LRU Cache，另外还有Clock Cache、Counting Cache（用来统计Cache命中率等），还有其他一些特殊的Cache。</p>\n<p>一般情况下，操作系统会有文件缓存，所以同一份数据可能既在DB Cache中（解压后的数据），又在操作系统Cache中（压缩的数据）。这样会造成内存浪费，所以RocksDB提供了一个折衷：在dboption中设置DIRECT_IO选项，绕过操作系统Cache，这样就只有DB Cache，可以节省一部分内存，但在一定程度上会降低性能。</p>\n<p><strong>传统非主流压缩：FM-Index</strong></p>\n<p>FM-Index的全名是Full Text Matching Index，属于Succinct Data Structure家族，对数据有一定的压缩能力，并且可以直接在压缩的数据上执行搜索和访问。</p>\n<p>FM-Index的功能非常丰富，历史也已经相当悠久，不算是一种新技术，在一些特殊场景下也已经得到了广泛应用，但是因为各种原因，一直不温不火。最近几年，FM-Index开始有些活跃，首先是GitHub上有个大牛实现了全套Succinct算法，其中包括FM-Index，其次Berkeley的Succinct项目也使用了FM-Index。</p>\n<p>FM-Index属于Offline算法（一次性压缩所有数据，压缩好之后不可修改），一般基于BWT变换（BWT变换基于后缀数组），压缩好的FM-Index支持以下两个最主要的操作：</p>\n<ul>\n<li>data = extract(offset, length)</li>\n<li>{offset} = search(string) ，返回多个匹配string的位置/偏移（offset）</li>\n</ul>\n<p>FM-Index还支持更多其他操作，感兴趣的朋友可以进一步调研。</p>\n<p>但是，在笔者看来，FM-Index有几个致命的缺点：</p>\n<ul>\n<li>实现太复杂（这一点可以被少数大牛们克服，不提也罢）；</li>\n<li>压缩率不高（比流式压缩例如gzip差太多）；</li>\n<li>搜索（search）和访问（extract）速度都很慢（在2016年最快的CPU i7-6700K上，单线程吞吐率不超过7MB/sec）；</li>\n<li>压缩过程又慢又耗内存（Berkeley的Succinct压缩过程内存消耗是源数据的50倍以上）；</li>\n<li>数据模型是Flat Text，不是数据库的KeyValue模型。</li>\n</ul>\n<p>可以用一种简单的方式把Flat Model转化成KeyValue Model：挑选一个在Key和Value中都不会出现的字符“#”（如果无法找出这样的字符，需要进行转义编码），每个Key前后都插入该字符，Key之后紧邻的就是Value。如此，search(#key#)返回了#key#出现的位置，我们就能很容易地拿到Value了。</p>\n<p>Berkeley的Succinc项目在FM-Index的Flat Text模型上实现了更丰富的行列（Row-Column）模型，付出了巨大的努力，达到了一定的效果，但离实用还相差太远。</p>\n<p>感兴趣的朋友可以仔细调研下FM-Index，以验证笔者的总结与判断。</p>\n<p><strong>Terark的可检索压缩（Searchable Compression）</strong></p>\n<p>Terark公司提出了“可检索压缩（Searchable Compression）”的概念，其核心也是直接在压缩的数据上执行搜索（search）和访问（extract），但数据模型本身就是KeyValue模型，根据其测试报告，速度要比FM-Index快得多（两个数量级），具体阐述：</p>\n<ul>\n<li>摒弃传统数据库的块压缩技术，采用全局压缩；</li>\n<li>对Key和Value使用不同的全局压缩技术；</li>\n<li>对Key使用有搜索功能的全局压缩技术COIndex（对应FM-Index的search）；</li>\n<li>对Value使用可定点访问的全局压缩技术PA-Zip（对应FM-Index的extract）。</li>\n</ul>\n<p><strong>对Key的压缩：CO-Index</strong></p>\n<p>我们需要对Key进行索引，才能有效地进行搜索，并访问需要的数据。</p>\n<p>普通的索引技术，索引的尺寸相对于索引中原始Key的尺寸要大很多，有些索引使用前缀压缩，能在一定程度上缓解索引的膨胀，但仍然无法解决索引占用内存过大的问题。</p>\n<p>我们提出了CO-Index（Compressed Ordered Index）的概念，并且通过一种叫做Nested Succinct Trie的数据结构实践了这一概念。</p>\n<p>较之传统实现索引的数据结构，Nested Succinct Trie的空间占用小十几倍甚至几十倍。而在保持该压缩率的同时，还支持丰富的搜索功能：</p>\n<ul>\n<li>精确搜索；</li>\n<li>范围搜索；</li>\n<li>顺序遍历；</li>\n<li>前缀搜索；</li>\n<li>正则表达式搜索（不是逐条遍历）。</li>\n</ul>\n<p>与FM-Index相比，CO-Index也有其优势（假定FM-Index中所有的数据都是Key）。</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0457b02458b4a0ba39b8c6364b7c78d4.png\"></div>\n<div style=\"text-align: center\">表1 FM-Index对比CO-Index</div>\n<p><strong>CO-Index的原理</strong></p>\n<p>实际上我们实现了很多种CO-Index，其中Nested Succinct Trie是适用性最广的一种，在这里对其原理做一个简单介绍：</p>\n<p><strong>Succinct Data Structure介绍</strong></p>\n<p>Succinct Data Structure是一种能够在接近于信息论下限的空间内来表达对象的技术，通常使用位图来表示，用位图上的rank和select来定位。</p>\n<p>虽然能够极大降低内存占用量，但实现起来较为复杂，并且性能低很多（时间复杂度的常数项很大）。目前开源的有SDSL-Lite，我们则使用自己实现的Rank-Select，性能也高于开源实现。</p>\n<p><strong>以二叉树为例</strong></p>\n<p>传统的表现形式是一个结点中包含两个指针：struct Node { Node *left, *right; };</p>\n<p>每个结点占用 2ptr，如果我们对传统方法进行优化，结点指针用最小的bits数来表达，N个结点就需要2*[log2(N)]个bits。</p>\n<ul>\n<li>对比传统基本版和传统优化版，假设共有216个结点（包括null结点），传统优化版需要2 bytes，传统基本版需要4/8 bytes。</li>\n<li>对比传统优化版和Succinct，假设共有10亿(~230)个结点。</li>\n<li>传统优化版每个指针占用[log2(230)]=30bits，总内存占用：($frac{2*30}{8}$)*230≈ 7.5GB。</li>\n<li>使用Succinct，占用：($frac{2.5}{8}$)*230≈ 312.5MB(每个结点2.5 bits，其中0.5bits是 rank-select 索引占用的空间）。</li>\n</ul>\n<p><strong>Succinct Tree</strong></p>\n<p>Succinct Tree有很多种表达方式，这里列出常见的两种：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/42bb4fdda5077930596850352a5d5ab8.png\"></div>\n<div style=\"text-align: center\">图1 Succinct Tree表达方式示例</div>\n<p><strong>Succinct Trie = Succinct Tree + Trie Label</strong></p>\n<p>Trie可以用来实现Index，图2这个Succinct Trie用的是LOUDS表达方式，其中保存了hat、is、it、a、四个Key。</p>\n<p><strong>Patricia Trie加嵌套</strong></p>\n<p>仅使用Succinct技术，压缩率远远不够，所以又应用了路径压缩和嵌套。这样一来，压缩率就上了一个新台阶。</p>\n<p>把上面这些技术综合到一起，就是我们的Nest Succinct Trie。</p>\n<p><strong>对Value的压缩: PA-Zip</strong></p>\n<p>我们研发了一种叫做PA-Zip (Point Accessible Zip)的压缩技术：每条数据关联一个ID，数据压缩好之后，就可以用相应的ID访问那条数据。这里，ID就是那个Point，所以叫做Point Accessible Zip。</p>\n<p>PA-Zip对整个数据库中的所有Value（KeyValue数据库中所有Value的集合）进行全局压缩，而不是按block/page进行压缩。这是针对数据库的需求（KeyValue 模型），专门设计的一个压缩算法，用来解决传统数据库压缩的问题：</p>\n<ul>\n<li>压缩率更高，没有双缓存的问题，只要把压缩后的数据装进内存，不需要专用缓存，可以按ID直接读取单条数据，如果把这种读取单条数据看作是一种解压，那么：</li>\n<li>按ID顺序解压时，解压速度（Throughput）一般在500MB每秒（单线程），最高达到约7GB/s，适合离线分析性需求，传统数据库压缩也能做到这一点；</li>\n<li>按ID随机解压时，解压速度一般在300MB每秒（单线程），最高达到约3GB/s，适合在线服务需求，这一点完胜传统数据库压缩：按随机解压300MB/s算，如果每条记录平均长度1K，相当于QPS = 30万；如果每条记录平均长度300个字节，相当于QPS = 100万；</li>\n<li>预热（warmup），在某些特殊场景下，数据库可能需要预热。因为去掉了专用缓存，TerarkDB的预热相对简单高效，只要把mmap的内存预热一下（避免Page Fault即可），数据库加载成功后就是预热好的，这个预热的Throughput就是SSD连续读的IO性能（较新的SSD读性能超过3GB/s）。</li>\n</ul>\n<p>与FM-Index相比，PA-Zip解决的是FM-Index的extract操作，但性能和压缩率都要好得多：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/899986dec4eb1f141407f572b05c511f.png\"></div>\n<div style=\"text-align: center\">表2 FM-Index对比PA-Zip</div>\n<p><strong>结合Key与Value</strong></p>\n<p>Key以全局压缩的形式保存在CO-Index中，Value以全局压缩的形式保存在 PA-Zip中。搜索一个Key，会得到一个内部ID，根据这个ID，去PA-Zip中定点访问该ID对应的Value，整个过程中只触碰需要的数据，不需要触碰其他数据。</p>\n<p>如此无需专用缓存（例如RocksDB中的DBCache），仅使用mmap，完美配合文件系统缓存，整个DB只有mmap的文件系统缓存这一层缓存，再加上超高的压缩率，大幅降低了内存用量，并且极大简化了系统的复杂性，最终完成数据库性能的大幅提升，从而同时实现了超高的压缩率和超高的随机读性能。</p>\n<p>从更高的哲学层面看，我们的存储引擎很像是用构造法推导出来的，因为CO-Index和PA-Zip紧密配合，完美匹配KeyValue模型，功能上“刚好够用”，性能上压榨硬件极限，压缩率逼近信息论的下限。相比其他方案：</p>\n<ul>\n<ul>\n<li>传统块压缩是从通用的流式压缩衍生而来，流式压缩的功能非常有限，只有压缩和解压两个操作，对太小的数据块没有压缩效果，也无法压缩数据块之间的冗余。把它用到数据库上，需要大量的工程努力，就像给汽车装上飞机机翼，然后要让它飞起来。</li>\n<li>相比FM-Index，情况则相反，FM-Index的功能非常丰富，它就必然要为此付出一些代价——压缩率和性能。而在KeyValue模型中，我们只需要它那些丰富功能的一个非常小的子集（还要经过适配和转化），其他更多的功能毫无用武之地，却仍然要付出那些代价，就像我们花了很高的代价造了一架飞机，却把它按在地上，只用轮子跑，当汽车用。</li>\n</ul>\n</ul>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0fadbdd0670c36a88f53a624790ad3bb.png\"></div>\n<div style=\"text-align: center\">图2 用LOUDS方式表达的Succinct Tree</div>\n<p> </p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7be742bb10ad455007a1e6e8ca885fe4.png\"></div>\n<div style=\"text-align: center\">图3 路径压缩与嵌套</div>\n<p><strong>附录</strong></p>\n<p><strong>压缩率&amp;性能测试比较</strong></p>\n<p><strong>数据集：Amazon movie data</strong></p>\n<p>Amazon movie data (~8 million reviews)，数据集的总大小约为9GB, 记录数大约为800万条，平均每条数据长度大约1K。</p>\n<p>Benchmark代码开源：参见<a href=\"https://github.com/Terark/terarkdb-benchmark/tree/master/doc/movies\" target=\"_blank\">Github仓库</a>。<br>\n压缩率（见图4）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/02b6b59e468b97bc09a4d6ce30dd5eb2.png\"></div>\n<div style=\"text-align: center\">图4 压缩率对比</div>\n<p>随机读（见图5）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/33436d4c3c3bdef34dcbd58741d80380.png\"></div>\n<div style=\"text-align: center\">图5 随机读性能对比</div>\n<p>这是在内存足够的情况下，各个存储引擎的性能。<br>\n延迟曲线（见图6）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/75f6ac41648016d57f8c64747e19c235.png\"></div>\n<div style=\"text-align: center\">图6 延迟曲线对比</div>\n<p><strong>数据集：Wikipedia英文版</strong></p>\n<p>Wikipedia英文版的所有文本数据，109G，压缩到23G。</p>\n<p><strong>数据集：TPC-H</strong></p>\n<p>在TPC-H的lineitem数据上，使用TerarkDB和原版RocksDB（BlockBasedTable）进行对比测试：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2ea750214ac1a02595cc67c794e35b20.png\"></div>\n<div style=\"text-align: center\">表3 TerarkDB与原版RocksDB对比测试</div>\n<p><strong>API 接口</strong></p>\n<p><strong>TerarkDB = Terark SSTable + RocksDB</strong></p>\n<p>RocksDB最初是Facebook对Google的LevelDB的一个fork，编程接口上兼容LevelDB，并增加了很多改进。</p>\n<p>RocksDB对我们有用的地方在于其SSTable可以plugin，所以我们实现了一个RocksDB的SSTable，将我们的技术优势通过RocksDB发挥出来。</p>\n<p>虽然RocksDB提供了一个相对完整的KeyValueDB框架，但要完全适配我们特有的技术，仍有一些欠缺，所以需要对RocksDB本身也做一些修改。将来可能有一天我们会将自己的修改提交到RocksDB官方版。</p>\n<p>Github链接：<a href=\"https://github.com/Terark/terarkdb\" target=\"_blank\">TerarkDB</a>（<a href=\"https://github.com/Terark/terarkdb\" target=\"_blank\">https://github.com/Terark/terarkdb</a>），TerarkDB包括两部分：</p>\n<ul>\n<li>terark-zip-rocksdb（<a href=\"https://github.com/terark/terark-zip-rocksdb\" target=\"_blank\">https://github.com/terark/terark-zip-rocksdb</a>），（Terark SSTable forrocksdb）</li>\n<li>Terark fork rocksdb（<a href=\"https://github.com/Terark/rocksdb\" target=\"_blank\">https://github.com/Terark/rocksdb</a>），（必须使用这个修改版的rocksdb）</li>\n</ul>\n<p>为了更好的兼容性，TerarkDB对RocksDB的API没有做任何修改，为了进一步方便用户使用TerarkDB，我们甚至提供了一种方式：程序无需重新编译，只需要替换 librocksdb.so并设置几个环境变量，就能体验TerarkDB。</p>\n<p>如果用户需要更精细的控制，可以使用C++ API详细配置TerarkDB的各种选项。</p>\n<p>目前大家可以免费试用，可以做性能评测，但是不能用于production，因为试用版会随机删掉0.1%的数据。</p>\n<p><strong>Terark命令行工具集</strong></p>\n<p>我们提供了一组命令行工具，这些工具可以将输入数据压缩成不同的形式，压缩后的文件可以使用Terark API或（该工具集中的）其他命令行工具解压或定点访问。</p>\n<p>详情参见<a href=\"https://github.com/Terark/terark-wiki-zh_cn\" target=\"_blank\">Terark wiki中文版</a>（<a href=\"https://github.com/Terark/terark-wiki-zh_cn\" target=\"_blank\">https://github.com/Terark/terark-wiki-zh_cn</a>）。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111930\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111930votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111930\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "9ce14fbc71c2b3562272365d741946ba", "com_num": 0, "title": "数据库压缩技术探索", "url": "http://blog.jobbole.com/111930/", "praise_num": "1", "front_image_path": "full/ff17de8672c48c6a8dd39a73a0753c9ad77c1693.jpg", "create_date": "2017/07/19", "tags": "IT技术,数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/6e6cabd45d6fb2d059e608a9ff5b97e4.jpg"]},{"fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q4000052677\">听风</a> 翻译，<a href=\"http://www.jobbole.com/members/scbzyhx\">yhx</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://aphyr.com/posts/340-acing-the-technical-interview\">Kyle Kingsbury</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><span style=\"color: #339966\">假想面试的时候用 Clojure 做题，狠狠地鄙视了一下不懂 Clojure、且高傲无知的面试官，然后潇洒地离去。</span></p>\n<hr>\n<p>如果你打算找一份程序员的工作，那么你必须要通过白板面试。 作为工程师，模拟白板面试也经常是我们早上例行公事的一部分，同时还需要在星光层（astral plane）上打开一个漂亮的网格状的 xterms 窗口，并且在每个邻近的目录中不由自主地运行 ls 命令，以防事情在昨晚有什么变化。</p>\n<p>这不亚于在厨房后面的那个抽屉里，搞一次天翻地覆地搜查。而那个抽屉里存放着各种各样的法兰盘、螺丝刀和从各种家用电器上掉下来多年的各种配饰或零件。现在谁也不知道这些东西原来是做什么用的，或许从来就没知道过，尽管如此，我们还必须小心翼翼的对待它们。</p>\n<p>下面我将通过一个常见的面试题，向你演示一下白板面试：反转链表。</p>\n<p>首先，我们需要一个链表。清除 xterms 中不需要的工作区，然后在两个括号的作用域中写上必要的元素和通配符。这样我们就从无到有创建出了一个链表。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971a249a2fc8813769952\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn cons [h t] #(if % h t))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fc8813769952-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971a249a2fc8813769952-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">#</span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>“那不是一个链表，那只是一条 if 语句。”面试官说。</p>\n<p>“ 这不就是一个另类点的链表吗？”你回答到，同时翻了一个白眼。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fhqlozoo7jg208c08adx1.gif\" width=\"300\" height=\"298\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971a249a2fd1911273471\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; (def x (cons 1 (cons 2 nil)))\r\n#'user/x\r\nuser=&gt; (x true)\r\n1\r\nuser=&gt; ((x false) true)\r\n2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fd1911273471-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fd1911273471-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fd1911273471-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fd1911273471-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fd1911273471-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fd1911273471-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971a249a2fd1911273471-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fd1911273471-2\"><span class=\"crayon-o\">#</span>'<span class=\"crayon-i\">user</span><span class=\"crayon-st\">/</span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fd1911273471-3\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fd1911273471-4\"><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fd1911273471-5\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fd1911273471-6\"><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>“x 到底是什么？”面试官尽量让自己看些来友善些。答案就在 REPL，但不要被它一时误导了，它们可不是你的朋友。你在前台的“誓言”，不允许你使用它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971a249a2fd5433909842\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; x\r\n#object[user$cons$cell__4431 0x3b89cc1c \"user$cons$cell__4431@3b89cc1c\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fd5433909842-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fd5433909842-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971a249a2fd5433909842-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fd5433909842-2\"><span class=\"crayon-o\">#</span><span class=\"crayon-i\">object</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">user</span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">cons</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">cell</span><span class=\"crayon-sy\">_</span><span class=\"crayon-sy\">_</span>4431<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x3b89cc1c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"user$cons$cell__4431@3b89cc1c\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>“了解一个事物最好的方式，就是对它命名。”你回答到。恰当的名字具备魔力。由 Ursula K. Le Guin 发明的 K 语言是最古老和最精练的形式语言之一。一旦你使用某个字符对程序进行自定义命名，意味着你将不能再使用这个字符元素。 你自定义的缩写名称会记录在程序的内存中。</p>\n<p>“呃，好吧，你怎么从这个链表里面取出一个元素呢？” 面试官又问。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fhqls12mmhj20dw07hn4u.jpg\" width=\"500\" height=\"269\"></p>\n<p>那些巧妙的表达式在你脑海中逐一呈现，仿佛红地毯在你光着的双脚下慢慢展开； 犹如昨晚观看奥斯卡颁奖典礼时，你憧憬着不同的明星来亲吻你；又好像你住在瑟略岛（Sørøya ）山脉之上，月亮就是你的爱人。 除了边界检查，你在第一时间写出了正确的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971a249a2fda333304294\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn nth [l n]\r\n  (when l (if (= 0 n)\r\n            (l true)\r\n            (recur (l false) (dec n)))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fda333304294-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fda333304294-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fda333304294-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fda333304294-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971a249a2fda333304294-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">nth</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fda333304294-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fda333304294-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fda333304294-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>“你能不能给我写一个正常的链表吗？就像 Python 中的那样？”</p>\n<p>你咬紧牙关，气愤地在地板上直跺脚，但还是写了一个排版良好的打印函数。 此刻，你的手掌仿佛充满了老茧，你的眼皮仿佛沾满了冰霜、以及烟灰黑色的雪花。 每个函数都是要付出代价的，当然，除非它是无副作用的纯函数。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/large/63918611gy1fhqlxfkc84j20b408cq2z.jpg\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971a249a2fdd733116163\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn prn-list [l]\r\n  (print \"(\")\r\n  (loop [l l]\r\n    (if (nil? l)\r\n      (print \")n\")\r\n      (do (print (l true))\r\n          (when (l false)\r\n            (print \" \"))\r\n          (recur (l false))))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fdd733116163-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fdd733116163-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fdd733116163-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fdd733116163-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fdd733116163-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fdd733116163-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fdd733116163-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fdd733116163-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fdd733116163-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971a249a2fdd733116163-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fdd733116163-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"(\"</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fdd733116163-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fdd733116163-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">nil</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fdd733116163-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\")n\"</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fdd733116163-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fdd733116163-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fdd733116163-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fdd733116163-9\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>白板面试时根本没有多余的时间去描述变量、写示例或文档注释。在白板面试中，时间就是一切。你就假装你是一名 Haskell 程序员，正当着你奶奶的面继续完成下面的代码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971a249a2fe1027896514\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; (prn-list (cons 1 (cons 2 (cons 3 nil))))\r\n(1 2 3)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fe1027896514-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fe1027896514-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971a249a2fe1027896514-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fe1027896514-2\"><span class=\"crayon-o\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>面试官笑了，安心了。 至少此时，代码输出的链表仍是正序的。“那么，要反转这个链表，你需要……”</p>\n<p>你抓住了他的手，然后在白板上写代码，那感觉就像在用古老的语言吟诵诗句。而此时此刻，他的大脑却一片混乱，好像松了发条的疯狂乱撞的钟，又仿佛心脏上爬过绦虫，砰砰直跳的心脏恨不得逃出胸腔。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971a249a2fe5631390925\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn reverse [l]\r\n  (loop [r nil, l l]\r\n    (if l\r\n      (recur (cons (l true) r) (l false))\r\n      r)))\r\n\r\nuser=&gt; (prn-list (reverse (cons 1 (cons 2 (cons 3 nil)))))\r\n(3 2 1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fe5631390925-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fe5631390925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fe5631390925-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fe5631390925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fe5631390925-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fe5631390925-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971a249a2fe5631390925-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971a249a2fe5631390925-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971a249a2fe5631390925-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">reverse</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fe5631390925-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fe5631390925-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fe5631390925-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971a249a2fe5631390925-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-i\">r</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fe5631390925-6\"> </div><div class=\"crayon-line\" id=\"crayon-5971a249a2fe5631390925-7\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">reverse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971a249a2fe5631390925-8\"><span class=\"crayon-o\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>当你松开他的手时，他结结巴巴地说了些有礼貌的话，然后把连帽衫的拉链拉上假装以抵御寒冷。这里将会有其它的面试会议，但你已经不需要参加了。他用锐利的眼光朝你所在的地方看了一眼。</p>\n<p>当然，他们会拒绝你，并且总是装着极其难为情地说，你不符合他们的公司文化。乘风归去吧。此地不属于你。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111889\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111889votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111889\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">听风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/9538B04AD8C6883F49C38BC8ECDDAF3C/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q4000052677\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q4000052677/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 21</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "25cdb73013451e3d2f61f6cc3d6759e7", "com_num": 0, "title": "反转技术面试！还有这样的操作？", "url": "http://blog.jobbole.com/111889/", "praise_num": "2", "front_image_path": "full/6e4397ded9dd50c3d6f3c52e128dcffa90427369.jpg", "create_date": "2017/07/20", "tags": "职场,技术面试,职场", "front_image_url": ["http://wx4.sinaimg.cn/mw690/63918611gy1fhqls12mmhj20dw07hn4u.jpg"]},{"fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>作为第三方应用，为了提升用户体验，往往会提供第三方社交账号登录或者绑定的功能，这背后使用到的关键技术是OAuth认证。想要在自己的应用里集成OAuth不是难事儿，各大社交网站都提供了详尽的文档指南。</p>\n<div>\n<p>OAuth的复杂度比较高，有不少安全方面的坑，开发者在使用过程中一不注意可能就会掉进去，比如说不正确的使用OAuth2可能会遭遇到CSRF攻击。本文将对这个安全风险做一个通俗易懂的解释。 老司机发车前的特别提醒：阅读本文需要你对OAuth2有一些了解，可以参考文末的链接。</p>\n<h3>1. OAuth2 授权模式回顾</h3>\n<p>在开始之前，让我们先来回顾一下OAuth2中最典型的Authorization Code 授权模式，其大致流程如下：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png\" alt=\"\" width=\"768\" height=\"734\"></a></p>\n<p>图1：OAuth2 Authorization Code Flow</p>\n<p>我们把OAuth2的整个认证过程大致分为三个阶段。第一阶段主要是向用户取得授权许可，对应图中的第1、2、3步；第二阶段主要是申请访问令牌（access_token），对应图中的第4、5步；第三阶段就是使用access_token获取用户数据。</p>\n<p>这一过程中涉及了不少敏感参数和数据，例如client_secret相当于是第三方应用自己的密码，access_token某种程度上来讲就是用户的session id。由于这些参数以及数据极其特殊，我们当然得确保它们的安全性，HTTPS加密传输以及安全存储是必不可少的防护手段。不过仅仅做到这些是远远不够的，在这个流程里存在一个弱点，容易被攻击者利用进行CSRF攻击。</p>\n<h3>2. 针对OAuth2的CSRF攻击</h3>\n<h4>2.1 攻击流程</h4>\n<p>让我们来看一个针对OAuth2的CSRF攻击的例子。假设有用户张三，和攻击者李四，还有一个第三方Web应用Tonr，它集成了第三方社交账号登录，并且允许用户将社交账号和Tonr中的账号进行绑定。此外还有一个OAuth2服务提供者Sparklr。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-CSRF-attack.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-CSRF-attack.png\" alt=\"\" width=\"768\" height=\"250\"></a></p>\n<p>图2：模拟攻击案例中涉及的角色</p>\n<p>Step 1. 攻击者李四登录Tonr网站，并且选择绑定自己的Sparklr账号。</p>\n<p>Step 2. Tonr网站将李四重定向到Sparklr，由于他之前已经登录过Sparklr，所以Sparklr直接向他显示“是否授权Tonr访问”的页面。</p>\n<p>Step 3. 李四在点击”同意授权“之后，截获Sparklr服务器返回的含有Authorization Code参数的HTTP响应。</p>\n<p>Step 4. 李四精心构造一个Web页面，它会触发Tonr网站向Sparklr发起令牌申请的请求，而这个请求中的Authorization Code参数正是上一步截获到的code。</p>\n<p>Step 5. 李四将这个Web页面放到互联网上，等待或者诱骗受害者张三来访问。</p>\n<p>Step 6. 张三之前登录了Tonr网站，只是没有把自己的账号和其他社交账号绑定起来。在张三访问了李四准备的这个Web页面后，令牌申请流程在张三的浏览器里被顺利触发，Tonr网站从Sparklr那里获取到access_token，但是这个token以及通过它进一步获取到的用户信息却都是攻击者李四的。</p>\n<p>Step 7. Tonr网站将李四的Sparklr账号同张三的Tonr账号关联绑定起来，从此以后，李四就可以用自己的Sparklr账号通过OAuth登录到张三在Tonr网站中的账号，堂而皇之的冒充张三的身份执行各种操作。</p>\n<p>等等，这一切发生得太快，还没看清楚李四怎么就登录到张三的账号里去了。没关系，让我们从几个不同的角度来看看这当中发生了什么。</p>\n<h4>2.2 受害者张三(Resource Owner)视角</h4>\n<p>受害者张三访问了一个Web页面，然后，就没有然后了，他在Tonr网站上的账号就和攻击者李四在Sparklr上的账号绑定到了一起。伪造的请求是经过精心构造的，令牌申请这一过程在张三的浏览器里是非常隐蔽的被触发的，换句话讲就是，他根本不知道这背后发生了什么。</p>\n<h4>2.3 Tonr网站(Client)视角</h4>\n<p>从Tonr网站来看，它收到的所有请求看上去都是正常的。首先它收到了一个HTTP请求，其代表着当前用户张三在Sparklr网站上已经做了“同意授权”操作。其内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597189a6f1dd7747196608\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET /bindingCallback?code=AUTHORIZATION_CODE\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597189a6f1dd7747196608-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597189a6f1dd7747196608-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597189a6f1dd7747196608-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bindingCallback</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">AUTHORIZATION</span><span class=\"crayon-sy\">_</span>CODE</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597189a6f1dd7747196608-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>不过需要注意的是，URL里的code不是当前受害者张三的Authorization Code，而是攻击者李四的。</p>\n<p>当Tonr收到这样的请求时，它以为张三已经同意授权（但实际上这个请求是李四伪造的），于是就发起后续的令牌申请请求，用收到的Authorization Code向Sparklr换取access_token，只不过最后拿到的是攻击者李四的 access_token。</p>\n<p>最后，Tonr网站把攻击者李四的access_token和当前受害者张三在Tonr网站上的账号进行关联绑定。</p>\n<h4>2.4 Sparklr网站(OAuth2服务提供者)视角</h4>\n<p>Sparklr网站也是一脸茫然的样子，因为在它看来，自己收到的授权请求，以及后续的令牌申请请求都是正常的，或者说它无法得知接收到的这些请求之间的关联关系，而且也无法区别出这些请求到底是来自张三本人，还是由李四伪造出来的。因此只要自己收到的参数是正确有效的，那就提供正常的认证服务，仅此而已。</p>\n<h4>2.5 攻击者李四视角</h4>\n<p>李四伪造了一个用户授权成功的请求，并且将其中的Authorization Code参数替换成了自己提前获取到的code。这样，当受害者张三的浏览器被欺骗从而发起令牌申请请求时，实际上是在用张三在Tonr网站上的账号和李四在Sparklr网站上的账号做绑定。</p>\n<p>攻击完成后，李四在Tonr网站上可以通过自己在Sparklr网站的账号进行登录，而且登录进入的是张三在Tonr网站上的账号。而张三通过自己在Tonr网站上的账号登录进去之后，看到的是李四在Sparklr网站上的数据。</p>\n<h4>2.6 上帝视角</h4>\n<p>从整体上来看，这次攻击的时序图应该是下面这个样子的：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-Sparklr.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-Sparklr.png\" alt=\"\" width=\"768\" height=\"734\"></a></p>\n<p>图3：攻击时序图示</p>\n<h3>3. 漏洞的本质</h3>\n<p>这个问题的关键点在于，OAuth2的认证流程是分为好几步来完成的，在图1中的第4步，第三方应用在收到一个GET请求时，除了能知道当前用户的cookie，以及URL中的Authorization Code之外，难以分辨出这个请求到底是用户本人的意愿，还是攻击者利用用户的身份伪造出来的请求。 于是乎，攻击者就能使用移花接木的手段，提前准备一个含有自己的Authorization Code的请求，并让受害者的浏览器来接着完成后续的令牌申请流程。</p>\n<h3>4. 前提条件</h3>\n<p>尽管这个攻击既巧妙又隐蔽，但是要成功进行这样的CSRF攻击也是需要满足一定前提条件的。</p>\n<p>首先，在攻击过程中，受害者张三在Tonr网站上的用户会话(User Session)必须是有效的，也就是说，张三在受到攻击前已经登录了Tonr网站。</p>\n<p>其次，整个攻击必须在短时间内完成，因为OAuth2提供者颁发的Authorization Code有效期很短，OAuth2官方推荐的时间是不大于10分钟，而一旦Authorization Code过期那么后续的攻击也就不能进行下去了。</p>\n<p>最后，一个Authorization Code只能被使用一次，如果OAuth2提供者收到重复的Authorization Code，它会拒绝当前的令牌申请请求。不止如此，根据OAuth2官方推荐，它还可以把和这个已经使用过的Authorization Code相关联的access_token全部撤销掉，进一步降低安全风险。</p>\n<h3>5. 防御办法</h3>\n<p>要防止这样的攻击其实很容易，作为第三方应用的开发者，只需在OAuth认证过程中加入state参数，并验证它的参数值即可。具体细节如下：</p>\n<ul>\n<li>在将用户重定向到OAuth2的Authorization Endpoint去的时候，为用户生成一个随机的字符串，并作为state参数加入到URL中。</li>\n<li>在收到OAuth2服务提供者返回的Authorization Code请求的时候，验证接收到的state参数值。如果是正确合法的请求，那么此时接受到的参数值应该和上一步提到的为该用户生成的state参数值完全一致，否则就是异常请求。</li>\n<li>state参数值需要具备下面几个特性：\n<ul>\n<li>不可预测性：足够的随机，使得攻击者难以猜到正确的参数值</li>\n<li>关联性：state参数值和当前用户会话（user session）是相互关联的</li>\n<li>唯一性：每个用户，甚至每次请求生成的state参数值都是唯一的</li>\n<li>时效性：state参数一旦被使用则立即失效</li>\n</ul>\n</li>\n</ul>\n<h3>6. 总结</h3>\n<p>要避免遭受本文提到的CSRF攻击问题，需要第三方应用正确的使用state参数，然而纵观各大OAuth服务提供者，在其开发文档里都没有明确把state参数和CSRF攻击联系起来，仅仅只是像下面这样一句话带过：</p>\n<p><em>“参数：state</em></p>\n<p><em>是否必须：否</em></p>\n<p><em>说明：重定向后会带上state参数，开发者可以填写a-zA-Z0-9的参数值，最多128字节”</em></p>\n<p>让事情变得更糟糕的是，state是可选参数，因此更容易被开发者忽略，造成安全风险。此外，本文中的攻击非常巧妙，可以悄无声息的攻陷受害者的账号，难以被察觉到。</p>\n<p>作为第三方应用的开发者，我们除了参考OAuth2服务提供者的开发文档之外，还应当加深自己对OAuth2的理解，尽可能的避开这些安全的坑。 而作为OAuth2服务提供者，也应当承担起提醒开发者注意防范安全风险的责任。</p>\n<p>参考资料</p>\n<ul>\n<li><a href=\"https://aaronparecki.com/oauth-2-simplified/\">OAuth2 Simplified</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6749\">OAuth2 Authorization Framework RFC6749</a></li>\n</ul>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111926\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111926votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111926\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 60</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "366f225c06e5d219f2213ca1330cfce3", "com_num": 0, "title": "移花接木：针对OAuth2的攻击", "url": "http://blog.jobbole.com/111926/", "praise_num": "1", "front_image_path": "full/a9d57da89cab263e2f865e47192960cec716c90d.jpg", "create_date": "2017/07/20", "tags": "IT技术,OAuth2", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png"]},{"fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"\">CatchShot</a>   </div><p>【伯乐在线转载注】：这篇图文内容，应该改编自一位台湾博主的文章《<a href=\"http://blog.jobbole.com/81292/\" target=\"_blank\">软件工程师的鄙视链</a>》。</p>\n<hr>\n<p>有人的地方就有江湖。程序员，是一个知识、智商、都异于常规行业的群体。自傲，清高，闷骚，也属于这个群体鲜明标签。</p>\n<p>程序员有时候很自我，这样就给自己一个盲目的优越感。特别在与其他程序员对比的时候，他总能找到在一两个地方优于你的地方，所以，程序员之间的鄙视网络，在程序员这个职位诞生之日起，就慢慢的形成了。</p>\n<p>时至今日，这张鄙视网络已经相当的庞大。互联网的江湖中，有好事者开始归纳这张网，现在我们就来看看这张日益巨大的鄙视网。</p>\n<p><img title=\"图0：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5042be614d564104e6abff9d60b74424.jpg\" alt=\"图0：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"336\"></p>\n<p><img title=\"图1：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9be03e45f9c9394775c39ea3dcb081f5.jpg\" alt=\"图1：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"337\"></p>\n<p><img title=\"图2：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/480754675738b67ad7ae3e2949393d5d.jpg\" alt=\"图2：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"338\"></p>\n<p><img title=\"图3：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f39623c25fb96e5c33838562ca979955.jpg\" alt=\"图3：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"337\"></p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fhrbemwgsij20go07mmxn.jpg\" width=\"600\" height=\"274\"></p>\n<p><img title=\"图5：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f71f261ee07d4ae68811ba8984c5bbca.jpg\" alt=\"图5：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"353\"></p>\n<p><img title=\"图6：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4b6d9bfeaa47d08e5a6c831b61f5126d.jpg\" alt=\"图6：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"665\"></p>\n<p><img title=\"图7：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/557f1fc15a91cb3b642e8a0067d68802.jpg\" alt=\"图7：程序员之间的十八层鄙视网络\" data-width=\"546\" data-height=\"692\"></p>\n<p><img title=\"图8：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e47d0b440956c2e60401fe7cf04c1a8a.jpg\" alt=\"图8：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"626\" data-original=\"http://www.techug.com/wordpress/wp-content/uploads/2017/07/2ed600033e4da5d8f8a2.gif\"></p>\n<p><img title=\"图9：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bbb4da59f1ef5e2df8fac5c9dcb91038.jpg\" alt=\"图9：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"682\"></p>\n<p><img title=\"图10：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d2533f84335c10e36bf8e52e7ae434ad.jpg\" alt=\"图10：程序员之间的十八层鄙视网络\" data-width=\"562\" data-height=\"418\"></p>\n<p><img title=\"图11：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6f24fa523abd09103d082d8dff7077f1.jpg\" alt=\"图11：程序员之间的十八层鄙视网络\" data-width=\"570\" data-height=\"414\"></p>\n<p><img title=\"图12：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1c58fb20f86d4337ea5f0489abcc18e7.jpg\" alt=\"图12：程序员之间的十八层鄙视网络\" data-width=\"560\" data-height=\"413\"></p>\n<p><img title=\"图13：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/88db446e732da4c31c3cae98f6979b6e.jpg\" alt=\"图13：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"676\"></p>\n<p><img title=\"图14：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f17aa010b0dd6196521546234e547b02.jpg\" alt=\"图14：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"531\"></p>\n<p><img title=\"图15：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29c576dcbe282cd302f17dec6c25b098.jpg\" alt=\"图15：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"528\"></p>\n<p><img title=\"图16：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5c1f66baed364a4b698298630753b458.jpg\" alt=\"图16：程序员之间的十八层鄙视网络\" data-width=\"600\" data-height=\"199\"></p>\n<p>时代在发展，技术也在发展，唯一不变的，是人与人之间的江湖，程序员们，将这种江湖诙谐的发展了下去，期待以后更多层的程序员鄙视网。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111968\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111968votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111968\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "9707cd355560fc32276fe92a578ac3ad", "com_num": 0, "title": "程序员之间的 18 层鄙视网", "url": "http://blog.jobbole.com/111968/", "praise_num": "2", "front_image_path": "full/841236254aff12faf2e592e888093b493ce6f310.jpg", "create_date": "2017/07/21", "tags": "趣文小说,程序员,趣文", "front_image_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fhrc09kvxmj20d4076mx9.jpg"]},{"fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/5/introduction-ext4-filesystem\">David Both</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8685-1.html\">Linux中国/chenxinlong</a>   </div><p>在之前关于 Linux 文件系统的文章里，我写过一篇 <a class=\"ext\" href=\"https://opensource.com/life/16/10/introduction-linux-filesystems\" target=\"_blank\" rel=\"external nofollow\">Linux 文件系统介绍</a> 和一些更高级的概念例如 <a class=\"ext\" href=\"https://opensource.com/life/15/9/everything-is-a-file\" target=\"_blank\" rel=\"external nofollow\">一切都是文件</a>。现在我想要更深入地了解 EXT 文件系统的特性的详细内容，但是首先让我们来回答一个问题，“什么样才算是一个文件系统 ？” 一个文件系统应该涵盖以下所有特点：</p>\n<ol>\n<li><strong>数据存储：</strong> 对于任何一个文件系统来说，一个最主要的功能就是能够被当作一个结构化的容器来存储和获取数据。</li>\n<li><strong>命名空间：</strong> 命名空间是一个提供了用于命名与组织数据的命名规则和数据结构的方法学。</li>\n<li><strong>安全模型：</strong> 一个用于定义访问权限的策略。</li>\n<li><strong>API：</strong> 操作这个系统的对象的系统功能调用，这些对象诸如目录和文件。</li>\n<li><strong>实现：</strong> 能够实现以上几点的软件。</li>\n</ol>\n<p>本文内容的讨论主要集中于上述几点中的第一项，并探索为一个 EXT 文件系统的数据存储提供逻辑框架的元数据结构。</p>\n<h3 id=\"toc_1\">EXT 文件系统历史</h3>\n<p>虽然 EXT 文件系统是为 Linux 编写的，但其真正起源于 Minix 操作系统和 Minix 文件系统，而 Minix 最早发布于 1987，早于 Linux 5 年。如果我们从 EXT 文件系统大家族的 Minix 起源来观察其历史与技术发展那么理解 EXT4 文件系统就会简单得多。</p>\n<h3 id=\"toc_2\">Minix</h3>\n<p>当 Linux Torvalds 在写最初的 Linux 内核的时候，他需要一个文件系统但是他又不想自己写一个。于是他简单地把 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/MINIX_file_system\" target=\"_blank\" rel=\"external nofollow\">Minix 文件系统</a> 加了进去，这个 Minix 文件系统是由 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Andrew_S._Tanenbaum\" target=\"_blank\" rel=\"external nofollow\">Andrew S. Tanenbaum</a> 写的，同时它也是 Tanenbaum 的 Minix 操作系统的一部分。<a class=\"ext\" href=\"https://en.wikipedia.org/wiki/MINIX\" target=\"_blank\" rel=\"external nofollow\">Minix</a> 是一个类 Unix 风格的操作系统，最初编写它的原因是用于教育用途。Minix 的代码是自由可用的并有适当的许可协议，所以 Torvalds 可以把它用 Linux 的最初版本里。</p>\n<p>Minix 有以下这些结构，其中的大部分位于生成文件系统的分区中：</p>\n<ul>\n<li><a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Boot_sector\" target=\"_blank\" rel=\"external nofollow\"><strong>引导扇区</strong></a> 是硬盘安装后的第一个扇区。这个引导块包含了一个非常小的引导记录和一个分区表。</li>\n<li>每一个分区的第一个块都是一个包含了元数据的超级块superblock ，这些元数据定义了其他的文件系统结构并将其定位于物理硬盘的具体分区上。</li>\n<li>一个 <strong>inode 位图块</strong> 决定了哪些 inode 是在使用中的，哪一些是未使用的。</li>\n<li><strong>inode</strong> 在硬盘上有它们自己的空间。每一个 inode 都包含了一个文件的信息，包括其所处的数据块的位置，也就是该文件所处的区域。</li>\n<li>一个 <strong>区位图</strong> 用于保持追踪数据区域的使用和未使用情况。</li>\n<li>一个 <strong>数据区</strong>, 这里是数据存储的地方。</li>\n</ul>\n<p>对上述了两种位图类型来说，一个位bit表示一个指定的数据区或者一个指定的 inode。 如果这个位是 0 则表示这个数据区或者这个 inode 是未使用的，如果是 1 则表示正在使用中。</p>\n<p>那么，<a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Inode\" target=\"_blank\" rel=\"external nofollow\">inode</a> 又是什么呢 ? 就是 index-node（索引节点）的简写。 inode 是位于磁盘上的一个 256 字节的块，用于存储和该 inode 对应的文件的相关数据。这些数据包含了文件的大小、文件的所有者和所属组的用户 ID、文件模式（即访问权限）以及三个时间戳用于指定：该文件最后的访问时间、该文件的最后修改时间和该 inode 中的数据的最后修改时间。</p>\n<p>同时，这个 inode 还包含了位置数据，指向了其所对应的文件数据在硬盘中的位置。在 Minix 和 EXT 1-3 文件系统中，这是一个数据区和块的列表。Minix 文件系统的 inode 支持 9 个数据块，包括 7 个直接数据块和 2 个间接数据块。如果你想要更深入的了解，这里有一个优秀的 PDF 详细地描述了 <a class=\"ext\" href=\"http://ohm.hgesser.de/sp-ss2012/Intro-MinixFS.pdf\" target=\"_blank\" rel=\"external nofollow\">Minix 文件系统结构</a> 。同时你也可以在维基百科上对 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Inode_pointer_structure\" target=\"_blank\" rel=\"external nofollow\">inode 指针结构</a> 做一个快速了解。</p>\n<h3 id=\"toc_3\">EXT</h3>\n<p>原生的 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Extended_file_system\" target=\"_blank\" rel=\"external nofollow\">EXT 文件系统</a> (意即扩展的extended) 是由 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/R%C3%A9my_Card\" target=\"_blank\" rel=\"external nofollow\">Rémy Card</a> 编写并于 1992 年与 Linux 一同发行。主要是为了克服 Minix 文件系统中的一些文件大小限制的问题。其中，最主要的结构变化就是文件系统中的元数据。它基于 Unix 文件系统 （UFS），其也被称为伯克利快速文件系统（FFS）。我发现只有很少一部分关于 EXT 文件系统的发行信息是可以被确证的，显然这是因为其存在着严重的问题，并且它很快地被 EXT2 文件系统取代了。</p>\n<h3 id=\"toc_4\">EXT2</h3>\n<p><a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Ext2\" target=\"_blank\" rel=\"external nofollow\">EXT2 文件系统</a> 就相当地成功，它在 Linux 发行版中存活了多年。它是我在 1997 年开始使用 Red Hat Linux 5.0 时接触的第一个文件系统。实际上，EXT2 文件系统有着和 EXT 文件系统基本相同的元数据结构。然而 EXT2 更高瞻远瞩，因为其元数据结构之间留有很多供将来使用的磁盘空间。</p>\n<p>和 Minix 类似，EXT2 也有一个<a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Boot_sector\" target=\"_blank\" rel=\"external nofollow\">引导扇区</a> ，它是硬盘安装后的第一个扇区。它包含了非常小的引导记录和一个分区表。接着引导扇区之后是一些保留的空间，它填充了引导记录和硬盘驱动器上的第一个分区（通常位于下一个柱面）之间的空间。<a class=\"ext\" href=\"https://opensource.com/article/17/2/linux-boot-and-startup\" target=\"_blank\" rel=\"external nofollow\">GRUB2</a> – 也可能是 GRUB1 – 将此空间用于其部分引导代码。</p>\n<p>每个 EXT2 分区中的空间被分为柱面组cylinder group，它允许更精细地管理数据空间。 根据我的经验，每一组大小通常约为 8MB。 下面的图 1 显示了一个柱面组的基本结构。 柱面中的数据分配单元是块，通常大小为 4K。</p>\n<p class=\"article_img\"><img class=\"aligncenter\" title=\"图 1： EXT 文件系统中的柱面组的结构\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201707/11/154011lxv9mpu50c5v0xa5.png\" alt=\"图 1： EXT 文件系统中的柱面组的结构\"></p>\n<p class=\"article_img_desc\" style=\"text-align: center\"><em>图 1： EXT 文件系统中的柱面组的结构</em></p>\n<p>柱面组中的第一个块是一个超级块superblock，它包含了元数据，定义了其它文件系统的结构并将其定位于物理硬盘的具体分区上。分区中有一些柱面组还会有备用超级块，但并不是所有的柱面组都有。我们可以使用例如 <code>dd</code> 等磁盘工具来拷贝备用超级块的内容到主超级块上，以达到修复损坏的超级块的目的。虽然这种情况不会经常发生，但是在几年前我的一个超级块损坏了，我就是用这种方法来修复的。幸好，我很有先见之明地使用了 <code>dumpe2fs</code> 命令来备份了我的系统上的分区描述符信息。</p>\n<p>以下是 <code>dumpe2fs</code> 命令的一部分输出。这部分输出主要是超级块上包含的一些元数据，同时也是文件系统上的前两个柱面组的数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59715d72153d4151656450\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# dumpe2fs /dev/sda1\r\nFilesystem volume name:   boot \r\nLast mounted on:          /boot \r\nFilesystem UUID:          79fc5ed8-5bbc-4dfe-8359-b7b36be6eed3 \r\nFilesystem magic number:  0xEF53 \r\nFilesystem revision #:    1 (dynamic) \r\nFilesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir nlink extra_isize \r\nFilesystem flags:         signed_directory_hash \r\nDefault mount options:    user_xattr acl \r\nFilesystem state:         clean \r\nErrors behavior:          Continue \r\nFilesystem OS type:       Linux \r\nInode count:              122160 \r\nBlock count:              488192 \r\nReserved block count:     24409 \r\nFree blocks:              376512 \r\nFree inodes:              121690 \r\nFirst block:              0 \r\nBlock size:               4096 \r\nFragment size:            4096 \r\nGroup descriptor size:    64 \r\nReserved GDT blocks:      238 \r\nBlocks per group:         32768 \r\nFragments per group:      32768 \r\nInodes per group:         8144 \r\nInode blocks per group:   509 \r\nFlex block group size:    16 \r\nFilesystem created:       Tue Feb  7 09:33:34 2017 \r\nLast mount time:          Sat Apr 29 21:42:01 2017 \r\nLast write time:          Sat Apr 29 21:42:01 2017 \r\nMount count:              25 \r\nMaximum mount count:      -1 \r\nLast checked:             Tue Feb  7 09:33:34 2017 \r\nCheck interval:           0 (&lt;none&gt;) \r\nLifetime writes:          594 MB \r\nReserved blocks uid:      0 (user root) \r\nReserved blocks gid:      0 (group root) \r\nFirst inode:              11 \r\nInode size:               256 \r\nRequired extra isize:     32 \r\nDesired extra isize:      32 \r\nJournal inode:            8 \r\nDefault directory hash:   half_md4 \r\nDirectory Hash Seed:      c780bac9-d4bf-4f35-b695-0fe35e8d2d60 \r\nJournal backup:           inode blocks \r\nJournal features:         journal_64bit \r\nJournal size:             32M \r\nJournal length:           8192 \r\nJournal sequence:         0x00000213 \r\nJournal start:            0 \r\nGroup 0: (Blocks 0-32767) \r\n Primary superblock at 0, Group descriptors at 1-1 \r\n Reserved GDT blocks at 2-239 \r\n Block bitmap at 240 (+240) \r\n Inode bitmap at 255 (+255) \r\n Inode table at 270-778 (+270) \r\n 24839 free blocks, 7676 free inodes, 16 directories \r\n Free blocks: 7929-32767 \r\n Free inodes: 440, 470-8144 \r\nGroup 1: (Blocks 32768-65535) \r\n Backup superblock at 32768, Group descriptors at 32769-32769 \r\n Reserved GDT blocks at 32770-33007 \r\n Block bitmap at 241 (bg #0 + 241) \r\n Inode bitmap at 256 (bg #0 + 256)\r\n Inode table at 779-1287 (bg #0 + 779) \r\n 8668 free blocks, 8142 free inodes, 2 directories \r\n Free blocks: 33008-33283, 33332-33791, 33974-33975, 34023-34092, 34094-34104, 34526-34687, 34706-34723, 34817-35374, 35421-35844, 35935-36355, 36357-36863, 38912-39935, 39940-40570, 42620-42623, 42655, 42674-42687, 42721-42751, 42798-42815, 42847, 42875-42879, 42918-42943, 42975, 43000-43007, 43519, 43559-44031, 44042-44543, 44545-45055, 45116-45567, 45601-45631, 45658-45663, 45689-45695, 45736-45759, 45802-45823, 45857-45887, 45919, 45950-45951, 45972-45983, 46014-46015, 46057-46079, 46112-46591, 46921-47103, 49152-49395, 50027-50355, 52237-52255, 52285-52287, 52323-52351, 52383, 52450-52479, 52518-52543, 52584-52607, 52652-52671, 52734-52735, 52743-53247 \r\n Free inodes: 8147-16288 \r\nGroup 2: (Blocks 65536-98303) \r\n Block bitmap at 242 (bg #0 + 242) \r\n Inode bitmap at 257 (bg #0 + 257) \r\n Inode table at 1288-1796 (bg #0 + 1288) \r\n 6326 free blocks, 8144 free inodes, 0 directories \r\n Free blocks: 67042-67583, 72201-72994, 80185-80349, 81191-81919, 90112-94207 \r\n Free inodes: 16289-24432 \r\nGroup 3: (Blocks 98304-131071)\r\n&lt;截断&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59715d72153d4151656450-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59715d72153d4151656450-77\">77</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-1\"><span class=\"crayon-p\"># dumpe2fs /dev/sda1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-2\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-e\">volume </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">boot </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-3\"><span class=\"crayon-e\">Last </span><span class=\"crayon-e\">mounted </span><span class=\"crayon-v\">on</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">boot </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-4\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">UUID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">79fc5ed8</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5bbc</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4dfe</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8359</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">b7b36be6eed3 </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-5\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-e\">magic </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0xEF53</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-6\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">revision</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#:    1 (dynamic) </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-7\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">features</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">has_journal </span><span class=\"crayon-e\">ext_attr </span><span class=\"crayon-e\">resize_inode </span><span class=\"crayon-e\">dir_index </span><span class=\"crayon-e\">filetype </span><span class=\"crayon-e\">needs_recovery </span><span class=\"crayon-i\">extent</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64bit</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flex_bg </span><span class=\"crayon-e\">sparse_super </span><span class=\"crayon-e\">large_file </span><span class=\"crayon-e\">huge_file </span><span class=\"crayon-e\">dir </span><span class=\"crayon-e\">nlink </span><span class=\"crayon-e\">extra_isize </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-8\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">flags</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-e\">signed_directory_hash </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-9\"><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mount </span><span class=\"crayon-v\">options</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">user_xattr </span><span class=\"crayon-e\">acl </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-10\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-e\">clean </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-11\"><span class=\"crayon-e\">Errors </span><span class=\"crayon-v\">behavior</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-st\">Continue</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-12\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-e\">OS </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">       </span><span class=\"crayon-e\">Linux </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-13\"><span class=\"crayon-e\">Inode </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">122160</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-14\"><span class=\"crayon-e\">Block </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">488192</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-15\"><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">block </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">24409</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-16\"><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">376512</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-17\"><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">121690</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-18\"><span class=\"crayon-e\">First </span><span class=\"crayon-v\">block</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-19\"><span class=\"crayon-e\">Block </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">4096</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-20\"><span class=\"crayon-e\">Fragment </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">4096</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-21\"><span class=\"crayon-e\">Group </span><span class=\"crayon-e\">descriptor </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-22\"><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">GDT </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">238</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-23\"><span class=\"crayon-e\">Blocks </span><span class=\"crayon-e\">per </span><span class=\"crayon-v\">group</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">32768</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-24\"><span class=\"crayon-e\">Fragments </span><span class=\"crayon-e\">per </span><span class=\"crayon-v\">group</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">32768</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-25\"><span class=\"crayon-e\">Inodes </span><span class=\"crayon-e\">per </span><span class=\"crayon-v\">group</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8144</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-26\"><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-e\">per </span><span class=\"crayon-v\">group</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">509</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-27\"><span class=\"crayon-e\">Flex </span><span class=\"crayon-e\">block </span><span class=\"crayon-e\">group </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-28\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">created</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">       </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">33</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-29\"><span class=\"crayon-e\">Last </span><span class=\"crayon-e\">mount </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-e\">Sat </span><span class=\"crayon-i\">Apr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">29</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-30\"><span class=\"crayon-e\">Last </span><span class=\"crayon-e\">write </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-e\">Sat </span><span class=\"crayon-i\">Apr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">29</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-31\"><span class=\"crayon-e\">Mount </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-32\"><span class=\"crayon-e\">Maximum </span><span class=\"crayon-e\">mount </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-33\"><span class=\"crayon-e\">Last </span><span class=\"crayon-v\">checked</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">             </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">33</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-34\"><span class=\"crayon-e\">Check </span><span class=\"crayon-v\">interval</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">none</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-35\"><span class=\"crayon-e\">Lifetime </span><span class=\"crayon-v\">writes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">594</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MB </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-36\"><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-v\">uid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-37\"><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-v\">gid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">group </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-38\"><span class=\"crayon-e\">First </span><span class=\"crayon-v\">inode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-39\"><span class=\"crayon-e\">Inode </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-40\"><span class=\"crayon-e\">Required </span><span class=\"crayon-e\">extra </span><span class=\"crayon-v\">isize</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-41\"><span class=\"crayon-e\">Desired </span><span class=\"crayon-e\">extra </span><span class=\"crayon-v\">isize</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-42\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">inode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-43\"><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directory </span><span class=\"crayon-v\">hash</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">half_md4 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-44\"><span class=\"crayon-e\">Directory </span><span class=\"crayon-e\">Hash </span><span class=\"crayon-v\">Seed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">c780bac9</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">d4bf</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4f35</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b695</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0fe35e8d2d60</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-45\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">           </span><span class=\"crayon-e\">inode </span><span class=\"crayon-e\">blocks </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-46\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">features</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-e\">journal_64bit </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-47\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">32M</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-48\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">8192</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-49\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">sequence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0x00000213</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-50\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">start</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-51\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">32767</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-52\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Primary </span><span class=\"crayon-e\">superblock </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Group </span><span class=\"crayon-e\">descriptors </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-53\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">GDT </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">239</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-54\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">240</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">240</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-55\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">255</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-56\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">270</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">778</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">270</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-57\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24839</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7676</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directories </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-58\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7929</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">32767</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-59\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">440</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">470</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8144</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-60\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32768</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">65535</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-61\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Backup </span><span class=\"crayon-e\">superblock </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32768</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Group </span><span class=\"crayon-e\">descriptors </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32769</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">32769</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-62\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">GDT </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32770</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">33007</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-63\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">241</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 241) </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-64\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 256)</span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-65\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">779</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1287</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 779) </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-66\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8668</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8142</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directories </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-67\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33008</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">33283</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33332</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">33791</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33974</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">33975</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34023</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">34092</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34094</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">34104</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34526</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">34687</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34706</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">34723</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34817</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">35374</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">35421</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">35844</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">35935</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">36355</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">36357</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">36863</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">38912</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">39935</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">39940</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">40570</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42620</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42623</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42655</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42674</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42687</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42721</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42751</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42798</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42815</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42847</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42875</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42879</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42918</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42943</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42975</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">43000</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">43007</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">43519</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">43559</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">44031</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44042</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">44543</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44545</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45055</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45116</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45567</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45601</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45631</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45658</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45663</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45689</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45695</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45736</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45759</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45802</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45823</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45857</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45887</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45919</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45950</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45951</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45972</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45983</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">46015</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46057</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">46079</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46112</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">46591</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46921</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">47103</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">49152</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">49395</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50027</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">50355</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52237</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52255</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52285</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52287</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52323</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52351</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52383</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52450</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52479</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52518</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52543</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52584</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52607</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52652</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52671</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52734</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52735</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52743</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">53247</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-68\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8147</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16288</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-69\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">98303</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-70\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">242</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 242) </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-71\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">257</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 257) </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-72\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1288</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1796</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 1288) </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-73\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6326</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8144</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directories </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-74\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">67042</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">67583</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">72201</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">72994</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80185</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">80349</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">81191</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">81919</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90112</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">94207</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-75\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16289</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">24432</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59715d72153d4151656450-76\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">98304</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">131071</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59715d72153d4151656450-77\"><span class=\"crayon-o\">&lt;</span>截断<span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0191 seconds] -->\r\n<p>每一个柱面组都有自己的 inode 位图，用于判定该柱面组中的哪些 inode 是使用中的而哪些又是未被使用的。每一个柱面组的 inode 都有它们自己的空间。每一个 inode 都包含了一个文件的相关信息，包括属于该文件的数据块的位置。而块位图纪录了文件系统中的使用中和非使用中的数据块。请注意，在上面的输出中有大量关于文件系统的数据。在非常大的文件系统上，柱面组的数据可以多达数百页的长度。柱面组的元数据包括组中所有空闲数据块的列表。</p>\n<p>EXT 文件系统实现了数据分配策略以确保产生最少的文件碎片。减少文件碎片可以提高文件系统的性能。这些策略会在下面的 EXT4 中描述到。</p>\n<p>我所遇见的关于 EXT2 文件系统最大的问题是 <code>fsck</code> (文件系统检查) 程序这一环节占用了很长一段时间来定位和校准文件系统中的所有的不一致性，从而导致在系统崩溃crash后其会花费了数个小时来修复。有一次我的其中一台电脑在崩溃后重新启动时共花费了 28 个小时恢复磁盘，而且并且是在磁盘被检测量只有几百兆字节大小的情况下。</p>\n<h3 id=\"toc_5\">EXT3</h3>\n<p><a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Ext3\" target=\"_blank\" rel=\"external nofollow\">EXT3 文件系统</a>是应一个目标而生的，就是克服 <code>fsck</code> 程序需要完全恢复在文件更新操作期间发生的不正确关机而损坏的磁盘结构所需的大量时间。它对 EXT 文件系统的唯一新增功能就是 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Journaling_file_system\" target=\"_blank\" rel=\"external nofollow\">日志</a>，它将提前记录将对文件系统执行的更改。 EXT3 的磁盘结构的其余部分与 EXT2 中的相同。</p>\n<p>除了同先前的版本一样直接写入数据到磁盘的数据区域外，EXT3 上的日志会将文件数据随同元数据写入到磁盘上的一个指定数据区域。一旦这些（日志）数据安全地到达硬盘，它就可以几乎零丢失率地被合并或被追加到目标文件上。当这些数据被提交到磁盘上的数据区域上，这些日志就会随即更新，这样在日志中的所有数据提交之前，系统发生故障时文件系统将保持一致状态。在下次启动时，将检查文件系统的不一致性，然后将仍保留在日志中的数据提交到磁盘的数据区，以完成对目标文件的更新。</p>\n<p>日志功能确实降低了数据写入性能，但是有三个可用于日志的选项，允许用户在性能和数据完整性、安全性之间进行选择。 我的个人更偏向于选择安全性，因为我的环境不需要大量的磁盘写入活动。</p>\n<p>日志功能将失败后检查硬盘驱动器所需的时间从几小时（甚至几天）减少到了几分钟。 多年来，我遇到了很多导致我的系统崩溃的问题。要详细说的话恐怕还得再写一篇文章，但这里需要说明的是大多数是我自己造成的，就比如不小心踢掉电源插头。 幸运的是，EXT 日志文件系统将启动恢复时间缩短到两三分钟。此外，自从我开始使用带日志记录的 EXT3，我从来没有遇到丢失数据的问题。</p>\n<p>EXT3 的日志功能可以关闭，然后其功能就等同于 EXT2 文件系统了。 该日志本身仍然是存在的，只是状态为空且未使用。 只需在 <code>mount</code> 命令中使用文件系统类型参数来重新挂载即可指定为 EXT2。 你可以从命令行执行此操作，但是具体还是取决于你正在使用的文件系统，不过你也可以更改 <code>/etc/fstab</code> 文件中的类型说明符，然后重新启动。 我强烈建议不要将 EXT3 文件系统挂载为 EXT2 ，因为这会有丢失数据和增加恢复时间的潜在可能性。</p>\n<p>EXT2 文件系统可以使用如下命令来通过日志升级到 EXT3 。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59715d72153e3959478558\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntune2fs -j /dev/sda1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59715d72153e3959478558-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59715d72153e3959478558-1\"><span class=\"crayon-v\">tune2fs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sda1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><code>/dev/sda1</code> 表示驱动器和分区的标识符。同时要注意修改 <code>/etc/fstab</code> 中的文件系统类型标识符并重新挂载分区，或者重启系统以确保修改生效。</p>\n<h3 id=\"toc_6\">EXT4</h3>\n<p><a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Ext4\" target=\"_blank\" rel=\"external nofollow\">EXT4 文件系统</a>主要提高了性能、可靠性和容量。为了提高可靠性，它新增了元数据和日志校验和。同时为了满足各种关键任务要求，文件系统新增了纳秒级别的时间戳，并在时间戳字段中添加了两个高位来延缓时间戳的 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Year_2038_problem\" target=\"_blank\" rel=\"external nofollow\">2038 年问题</a> ，这样 EXT4 文件系统至少可用到 2446 年。</p>\n<p>在 EXT4 中，数据分配从固定块改为扩展盘区extent方式，扩展盘区由硬盘驱动器上的开始和结束位置来描述。这使得可以在单个 inode 指针条目中描述非常长的物理上连续的文件，这可以显著减少描述大文件中所有数据的位置所需的指针数。其它在 EXT4 中已经实施的分配策略可以进一步减少碎片化。</p>\n<p>EXT4 通过将新创建的文件散布在磁盘上，使其不会像早期的 PC 文件系统一样全部聚集在磁盘起始位置，从而减少了碎片。文件分配算法尝试在柱面组中尽可能均匀地散布文件，并且当文件（由于太大）需要分段存储时，使不连续的文件扩展盘区尽可能靠近同一文件中的其他部分，以尽可能减少磁头寻道和电机旋转等待时间。当创建新文件或扩展现有文件时，使用其它策略来预先分配额外的磁盘空间。这有助于确保扩展文件时不会自动导致其分段。新文件不会紧挨这现有文件立即分配空间，这也可以防止现有文件的碎片化。</p>\n<p>除了磁盘上数据的实际位置外，EXT4 使用诸如延迟分配的功能策略，以允许文件系统在分配空间之前收集到所有正在写入磁盘的数据，这可以提高数据空间连续的可能性。</p>\n<p>较旧的 EXT 文件系统（如 EXT2 和 EXT3）可以作为 EXT4 进行 <code>mount</code> ，以使其性能获得较小的提升。但不幸的是，这需要关闭 EXT4 的一些重要的新功能，所以我建议不要这样做。</p>\n<p>自 Fedora 14 以来，EXT4 一直是 Fedora 的默认文件系统。我们可以使用 Fedora 文档中描述的 <a class=\"ext\" href=\"https://docs.fedoraproject.org/en-US/Fedora/14/html/Storage_Administration_Guide/ext4converting.html\" target=\"_blank\" rel=\"external nofollow\">流程</a> 将 EXT3 文件系统升级到 EXT4，但是由于仍然存留的之前的 EXT3 元数据结构，它的性能仍将受到影响。从 EXT3 升级到 EXT4 的最佳方法是备份目标文件系统分区上的所有数据，使用 <code>mkfs</code> 命令将空 EXT4 文件系统写入分区，然后从备份中恢复所有数据。</p>\n<h3 id=\"toc_7\">Inode</h3>\n<p>之前介绍过的 inode 是 EXT 文件系统中的元数据的关键组件。 图 2 显示了 inode 和存储在硬盘驱动器上的数据之间的关系。 该图是单个文件的目录和 inode，在这种情况下，可能会产生高度碎片化。 EXT 文件系统可以主动地减少碎片，所以不太可能会看到有这么多间接数据块或扩展盘区的文件。 实际上，你在下面将会看到，EXT 文件系统中的碎片非常低，所以大多数 inode 只使用一个或两个直接数据指针，而不使用间接指针。</p>\n<p class=\"article_img\"><img class=\"aligncenter\" title=\"图 2 ：inode 存储有关每个文件的信息，并使 EXT 文件系统能够查找属于它的所有数据。\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201707/11/154012v1jru7qjxs47fc71.png\" alt=\"图 2 ：inode 存储有关每个文件的信息，并使 EXT 文件系统能够查找属于它的所有数据。\"></p>\n<p class=\"article_img_desc\" style=\"text-align: center\"><em>图 2 ：inode 存储有关每个文件的信息，并使 EXT 文件系统能够查找属于它的所有数据。</em></p>\n<p>inode 不包含文件的名称。通过目录项访问文件，目录项本身就是文件的名称，并包含指向 inode 的指针。该指针的值是 inode 号。文件系统中的每个 inode 都具有唯一的 ID 号，但同一台计算机上的其它文件系统（甚至是相同的硬盘驱动器）中的 inode 可以具有相同的 inode 号。这对 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Hard_link\" target=\"_blank\" rel=\"external nofollow\">硬链接</a> 存在影响，但是这个讨论超出了本文的范围。</p>\n<p>inode 包含有关该文件的元数据，包括其类型和权限以及其大小。 inode 还包含 15 个指针的空位，用于描述柱面组数据部分中数据块或扩展盘区的位置和长度。12 个指针提供对数据扩展盘区的直接访问，应该足以满足大多数文件的需求。然而，对于具有明显分段的文件，需要以间接节点node的形式提供一些额外的容量——从技术上讲，这些不是真正的“inode”，所以为了方便起见我在这里使用这个术语“节点node”。</p>\n<p>间接节点是文件系统中的正常数据块，它仅用于描述数据而不用于存储元数据，因此可以支持超过 15 个条目。例如，4K 的块大小可以支持 512 个 4 字节的间接节点，允许单个文件有 <strong>12（直接）+ 512（间接）= 524</strong> 个扩展盘区。还支持双重和三重间接节点，但我们大多数人不太可能遇到需要那么多扩展盘区的文件。</p>\n<h3 id=\"toc_8\">数据碎片</h3>\n<p>对于许多较旧的 PC 文件系统，如 FAT（及其所有变体）和 NTFS，碎片一直是导致磁盘性能下降的重大问题。 碎片整理本身就成为一个行业，有各种品牌的整理软件，其效果范围从非常有效到仅仅是微乎其微。</p>\n<p>Linux 的扩展文件系统使用数据分配策略，有助于最小化硬盘驱动器上的文件碎片，并在发生碎片时减少碎片的影响。 你可以使用 EXT 文件系统上的 <code>fsck</code> 命令检查整个文件系统的碎片。 以下示例检查我的主工作站的家目录，只有 1.5％ 的碎片。 确保使用 <code>-n</code> 参数，因为它会防止 <code>fsck</code> 对扫描的文件系统采取任何操作。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59715d72153eb858196657\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfsck -fn /dev/mapper/vg_01-home</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59715d72153eb858196657-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59715d72153eb858196657-1\"><span class=\"crayon-v\">fsck</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mapper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vg_01</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">home</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我曾经进行过一些理论计算，以确定磁盘碎片整理是否会产生任何明显的性能提升。 我做了一些假设条件，我使用的磁盘性能数据来自一个新的 300GB 的西部数字硬盘驱动器，具有 2.0ms 的轨到轨寻道时间。 此示例中的文件数是我在计算的当天的文件系统中存在的实际数。 我假设每天有相当大量的碎片化文件（约 20％）会被用到。</p>\n<table border=\"1\" cellpadding=\"4\">\n<thead>\n<tr>\n<th><strong>全部文件</strong></th>\n<th><strong>271,794</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>碎片率 %</td>\n<td>5.00%</td>\n</tr>\n<tr>\n<td>不连续数</td>\n<td>13,590</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>% 每天用到的碎片化文件</td>\n<td>20% （假设）</td>\n</tr>\n<tr>\n<td>额外寻道次数</td>\n<td>2,718</td>\n</tr>\n<tr>\n<td>平均寻道时间</td>\n<td>10.90 ms</td>\n</tr>\n<tr>\n<td>每天全部的额外寻道时间</td>\n<td>29.63 sec</td>\n</tr>\n<tr>\n<td></td>\n<td>0.49 min</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>轨到轨寻道时间</td>\n<td>2.00 ms</td>\n</tr>\n<tr>\n<td>每天全部的额外寻道时间</td>\n<td>5.44 sec</td>\n</tr>\n<tr>\n<td></td>\n<td>0.091 min</td>\n</tr>\n</tbody>\n</table>\n<p style=\"text-align: center\"><em>表 1: 碎片对磁盘性能的理论影响</em></p>\n<p>我对每天的全部的额外寻道时间进行了两次计算，一次是轨到轨寻道时间，这是由于 EXT 文件分配策略而导致大多数文件最可能的情况，一个是平均寻道时间，我假设这是一个合理的最坏情况。</p>\n<p>从表 1 可以看出，对绝大多数应用程序而言，碎片化甚至对性能适中的硬盘驱动器上的现代 EXT 文件系统的影响是微乎其微的。您可以将您的环境中的数字插入到您自己的类似电子表格中，以了解你对性能影响的期望。这种类型的计算不一定能够代表实际的性能，但它可以提供一些对碎片化及其对系统的理论影响的洞察。</p>\n<p>我的大部分分区的碎片率都在 1.5％ 左右或 1.6％，我有一个分区有 3.3％ 的碎片，但是这是一个大约 128GB 文件系统，具有不到 100 个非常大的 ISO 映像文件；多年来，我扩展过该分区几次，因为它已经太满了。</p>\n<p>这并不是说一些应用的环境并不需要更少的碎片的环境。 EXT 文件系统可以由有经验和知识的管理员小心调整，管理员可以针对特定的工作负载类型调整参数。这个工作可以在文件系统创建的时候或稍后使用 <code>tune2fs</code> 命令时完成。每一次调整变化的结果应进行测试，精心的记录和分析，以确保目标环境的最佳性能。在最坏的情况下，如果性能不能提高到期望的水平，则其他文件系统类型可能更适合特定的工作负载。并记住，在单个主机系统上混用文件系统类型以匹配每个文件系统上的不同负载是常见的。</p>\n<p>由于大多数 EXT 文件系统的碎片数量较少，因此无需进行碎片整理。目前，EXT 文件系统没有安全的碎片整理工具。有几个工具允许你检查单个文件的碎片程度或文件系统中剩余可用空间的碎片程度。有一个工具，<code>e4defrag</code>，它可以对允许使用的剩余可用空间、目录或文件系统进行碎片整理。顾名思义，它只适用于 EXT4 文件系统中的文件，并且它还有一其它的些限制。</p>\n<p>如果有必要在 EXT 文件系统上执行完整的碎片整理，则只有一种方法能够可靠地工作。你必须将文件系统中的所有要进行碎片整理的文件移动从而进行碎片整理，并在确保安全复制到其他位置后将其删除。如果可能，你可以增加文件系统的大小，以帮助减少将来的碎片。然后将文件复制回目标文件系统。但是其实即使这样也不能保证所有文件都被完全去碎片化。</p>\n<h3 id=\"toc_9\">总结</h3>\n<p>EXT 文件系统在一些 Linux 发行版本上作为默认文件系统已经超过二十多年了。它们用最少的维护代价提供了稳定性、高可用性、可靠性和性能。我尝试过一些其它的文件系统但最终都还是回归到 EXT。每一个我在工作中使用到 Linux 的地方都使用到了 EXT 文件系统，同时我发现了它们适用于任何主流负载。毫无疑问，EXT4 文件系统应该被用于大部分的 Linux 文件系统上，除非我们有明显需要使用其它文件系统的理由。</p>\n<hr>\n<p>作者简介：</p>\n<p>David Both – David Both 是一名 Linux 于开源的贡献者，目前居住在北卡罗莱纳州的罗利。他从事 IT 行业有 40 余年并在 IBM 中从事 OS/2 培训约 20 余年。在 IBM 就职期间，他在 1981 年为最早的 IBM PC 写了一个培训课程。他已经为红帽教授了 RHCE 课程，曾在 MCI Worldcom，思科和北卡罗来纳州工作。 他使用 Linux 和开源软件工作了近 20 年。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111885\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111885votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111885\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "c266f9bd7c12201bf651fad9a9794aaf", "com_num": 0, "title": "Linux 的 EXT4 文件系统的历史、特性以及最佳实践", "url": "http://blog.jobbole.com/111885/", "praise_num": "1", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg", "create_date": "2017/07/17", "tags": "IT技术,Linux,文件系统", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"]},{"fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7970268\">Laurence的技术博客，首发《程序员》杂志</a>   </div><p>作为一种数据存储层面上的水平伸缩解决方案，数据库Sharding技术由来已久，很多海量数据系统在其发展演进的历程中都曾经历过分库分表的Sharding改造阶段。简单地说，Sharding就是将原来单一数据库按照一定的规则进行切分，把数据分散到多台物理机（我们称之为Shard)上存储，从而突破单机限制，使系统能以Scale-Out的方式应对不断上涨的海量数据，但是这种切分对上层应用来说是透明的，多个物理上分布的数据库在逻辑上依然是一个库。实现Sharding需要解决一系列关键的技术问题，这些问题主要包括：切分策略、节点路由、全局主键生成、跨节点排序/分组/表关联、多数据源事务处理和数据库扩容等。本文将重点围绕“数据库扩容”进行深入讨论，并提出一种允许自由规划并能避免数据迁移和修改路由代码的Sharding扩容方案。</p>\n<h3><strong>Sharding扩容——系统维护不能承受之重</strong></h3>\n<p>任何Sharding系统，在上线运行一段时间后，数据就会积累到当前节点规模所能承载的上限，此时就需要对数据库进行扩容了，也就是增加新的物理结点来分摊数据。如果系统使用的是基于ID进行散列的路由方式，那么团队需要根据新的节点规模重新计算所有数据应处的目标Shard，并将其迁移过去，这对团队来说无疑是一个巨大的维护负担；而如果系统是按增量区间进行路由(如每1千万条数据或是每一个月的数据存放在一个节点上 )，虽然可以避免数据的迁移，却有可能带来“热点”问题，也就是近期系统的读写都集中在最新创建的节点上(很多系统都有此类特点：新生数据的读写频率明显高于旧有数据)，从而影响了系统性能。面对这种两难的处境，Sharding扩容显得异常困难。</p>\n<p>一般来说，“理想”的扩容方案应该努力满足以下几个要求：</p>\n<ol>\n<li> 最好不迁移数据 （无论如何，数据迁移都是一个让团队压力山大的问题）</li>\n<li>允许根据硬件资源自由规划扩容规模和节点存储负载</li>\n<li>能均匀的分布数据读写，避免“热点”问题</li>\n<li>保证对已经达到存储上限的节点不再写入数据</li>\n</ol>\n<p>目前，能够避免数据迁移的优秀方案并不多，相对可行的有两种，一种是维护一张记录数据ID和目标Shard对应关系的映射表，写入时，数据都写入新扩容的Shard，同时将ID和目标节点写入映射表，读取时，先查映射表，找到目标Shard后再执行查询。该方案简单有效，但是读写数据都需要访问两次数据库，且映射表本身也极易成为性能瓶颈。为此系统不得不引入分布式缓存来缓存映射表数据，但是这样也无法避免在写入时访问两次数据库，同时大量映射数据对缓存资源的消耗以及专门为此而引入分布式缓存的代价都是需要权衡的问题。另一种方案来自淘宝综合业务平台团队，它利用对2的倍数取余具有向前兼容的特性（如对4取余得1的数对2取余也是1）来分配数据，避免了行级别的数据迁移，但是依然需要进行表级别的迁移，同时对扩容规模和分表数量都有限制。总得来说，这些方案都不是十分的理想，多多少少都存在一些缺点，这也从一个侧面反映出了Sharding扩容的难度。</p>\n<h3><strong>取长补短，兼容并包——一种理想的Sharding扩容方案</strong></h3>\n<p>如前文所述，Sharding扩容与系统采用的路由规则密切相关：基于散列的路由能均匀地分布数据，但却需要数据迁移，同时也无法避免对达到上限的节点不再写入新数据；基于增量区间的路由天然不存在数据迁移和向某一节点无上限写入数据的问题，但却存在“热点”困扰。我们设计方案的初衷就是希望能结合两种路由规则的优势，摒弃各自的劣势，创造出一种接近“理想”状态的扩容方式，而这种方式简单概括起来就是：全局按增量区间分布数据，使用增量扩容，无数据迁移，局部使用散列方式分散数据读写，解决“热点”问题，同时对Sharding拓扑结构进行建模，使用一致的路由算法，扩容时只需追加节点数据，不再修改散列逻辑代码。</p>\n<h3><strong>原理</strong></h3>\n<p>首先，作为方案的基石，为了能使系统感知到Shard并基于Shard的分布进行路由计算，我们需要建立一个可以描述Sharding拓扑结构的编程模型。按照一般的切分原则，一个单一的数据库会首先进行垂直切分，垂直切分只是将关系密切的表划分在一起，我们把这样分出的一组表称为一个Partition。 接下来，如果Partition里的表数据量很大且增速迅猛，就再进行水平切分，水平切分会将一张表的数据按增量区间或散列方式分散到多个Shard上存储。在我们的方案里，我们使用增量区间与散列相结合的方式，全局上，数据按增量区间分布，但是每个增量区间并不是按照某个Shard的存储规模划分的，而是根据一组Shard的存储总量来确定的，我们把这样的一组Shard称为一个ShardGroup，局部上，也就是一个ShardGroup内，记录会再按散列方式均匀分布到组内各Shard上。这样，一条数据的路由会先根据其ID所处的区间确定ShardGroup，然后再通过散列命中ShardGroup内的某个目标Shard。在每次扩容时，我们会引入一组新的Shard，组成一个新的ShardGroup，为其分配增量区间并标记为“可写入”，同时将原有ShardGroup标记为“不可写入”，于是新生数据就会写入新的ShardGroup，旧有数据不需要迁移。同时，在ShardGroup内部各Shard之间使用散列方式分布数据读写，进而又避免了“热点”问题。最后，在Shard内部，当单表数据达到一定上限时，表的读写性能就开始大幅下滑，但是整个数据库并没有达到存储和负载的上限，为了充分发挥服务器的性能，我们通常会新建多张结构一样的表，并在新表上继续写入数据，我们把这样的表称为“分段表”（Fragment Table）。不过，引入分段表后所有的SQL在执行前都需要根据ID将其中的表名替换成真正的分段表名，这无疑增加了实现Sharding的难度，如果系统再使用了某种ORM框架，那么替换起来可能会更加困难。目前很多数据库提供一种与分段表类似的“分区”机制，但没有分段表的副作用，团队可以根据系统的实现情况在分段表和分区机制中灵活选择。总之，基于上述切分原理，我们将得到如下Sharding拓扑结构的领域模型：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b6a6923203f3865db3481b3ac4c3103a.jpg\" alt=\"\" width=\"591\" height=\"483\"></p>\n<p style=\"text-align: center\">图1. Sharding拓扑结构领域模型</p>\n<p>在这个模型中，有几个细节需要注意：ShardGroup的writable属性用于标识该ShardGroup是否可以写入数据，一个Partition在任何时候只能有一个ShardGroup是可写的，这个ShardGroup往往是最近一次扩容引入的；startId和endId属性用于标识该ShardGroup的ID增量区间；Shard的hashValue属性用于标识该Shard节点接受哪些散列值的数据；FragmentTable的startId和endId是用于标识该分段表储存数据的ID区间。</p>\n<p>确立上述模型后，我们需要通过配置文件或是在数据库中建立与之对应的表来存储节点元数据，这样，整个存储系统的拓扑结构就可以被持久化起来，系统启动时就能从配置文件或数据库中加载出当前的Sharding拓扑结构进行路由计算了（如果结点规模并不大可以使用配置文件，如果节点规模非常大，需要建立相关表结构存储这些结点元数据。从最新的Oracle发布的《面向大规模可伸缩网站基础设施的MySQL参考架构》白皮书一文的“超大型系统架构参考”章节给出的架构图中我们可以看到一种名为：Shard Catalog的专用服务器，这个其实是保存结点配置信息的数据库），扩容时只需要向对应的文件或表中加入相关的节点信息重启系统即可，不需要修改任何路由逻辑代码。</p>\n<h3><strong>示例</strong></h3>\n<p>让我们通过示例来了解这套方案是如何工作的。</p>\n<p><strong>阶段一：初始上线</strong></p>\n<p>假设某系统初始上线，规划为某表提供4000W条记录的存储能力，若单表存储上限为1000W条，单库存储上限为2000W条，共需2个Shard，每个Shard包含两个分段表，ShardGroup增量区间为0-4000W，按2取余分散到2个Shard上，具体规划方案如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a4da76f81d438d240c54afe5124d2ab.jpg\" alt=\"\" width=\"591\" height=\"310\"></p>\n<p style=\"text-align: center\">图2. 初始4000W存储规模的规划方案</p>\n<p>与之相适应，Sharding拓扑结构的元数据如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/09fcb6013304ed5a0bd37962856c02c7.jpg\" alt=\"\" width=\"467\" height=\"388\"></p>\n<p style=\"text-align: center\">图3. 对应Sharding元数据</p>\n<p><strong>阶段二：系统扩容</strong></p>\n<p>经过一段时间的运行，当原表总数据逼近4000W条上限时，系统就需要扩容了。为了演示方案的灵活性，我们假设现在有三台服务器Shard2、Shard3、Shard4，其性能和存储能力表现依次为Shard2&lt;Shard3&lt;Shard4，我们安排Shard2储存1000W条记录，Shard3储存2000W条记录，Shard4储存3000W条记录，这样，该表的总存储能力将由扩容前的4000W条提升到10000W条，以下是详细的规划方案：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2375c89746d023b9ddcbb20f653c3b3b.jpg\" alt=\"\" width=\"802\" height=\"278\"></p>\n<p style=\"text-align: center\">图4. 二次扩容6000W存储规模的规划方案</p>\n<p>相应拓扑结构表数据下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dfae7a7e6e53f086c125982d8bbc8132.jpg\" alt=\"\" width=\"474\" height=\"471\"></p>\n<p style=\"text-align: center\">图5. 对应Sharding元数据</p>\n<p>从这个扩容案例中我们可以看出该方案允许根据硬件情况进行灵活规划，对扩容规模和节点数量没有硬性规定，是一种非常自由的扩容方案。</p>\n<h3><strong>增强</strong></h3>\n<p>接下来让我们讨论一个高级话题：对“再生”存储空间的利用。对于大多数系统来说，历史数据较为稳定，被更新或是删除的概率并不高，反映到数据库上就是历史Shard的数据量基本保持恒定，但也不排除某些系统其数据有同等的删除概率，甚至是越老的数据被删除的可能性越大，这样反映到数据库上就是历史Shard随着时间的推移，数据量会持续下降，在经历了一段时间后，节点就会腾出很大一部分存储空间，我们把这样的存储空间叫“再生”存储空间，如何有效利用再生存储空间是这些系统在设计扩容方案时需要特别考虑的。回到我们的方案，实际上我们只需要在现有基础上进行一个简单的升级就可以实现对再生存储空间的利用，升级的关键就是将过去ShardGroup和FragmentTable的单一的ID区间提升为多重ID区间。为此我们把ShardGroup和FragmentTable的ID区间属性抽离出来，分别用ShardGroupInterval和FragmentTableIdInterval表示，并和它们保持一对多关系。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb93f0a9d14f8dd2f21535aaa611eb66.jpg\" alt=\"\" width=\"550\" height=\"629\"></p>\n<p style=\"text-align: center\">图6. 增强后的Sharding拓扑结构领域模型</p>\n<p>让我们还是通过一个示例来了解升级后的方案是如何工作的。</p>\n<p><strong>阶段三：不扩容，重复利用再生存储空间</strong></p>\n<p>假设系统又经过一段时间的运行之后，二次扩容的6000W条存储空间即将耗尽，但是由于系统自身的特点，早期的很多数据被删除，Shard0和Shard1又各自腾出了一半的存储空间，于是ShardGroup0总计有2000W条的存储空间可以重新利用。为此，我们重新将ShardGroup0标记为writable=true，并给它追加一段ID区间：10000W-12000W，进而得到如下规划方案：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9aefceaacb575a4a218b4444b710525c.jpg\" alt=\"\" width=\"518\" height=\"312\"></p>\n<p style=\"text-align: center\">图7. 重复利用2000W再生存储空间的规划方案</p>\n<p>相应拓扑结构的元数据如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7174be65f86f3158fbeae47d88984408.jpg\" alt=\"\" width=\"713\" height=\"382\"></p>\n<p style=\"text-align: center\">图8. 对应Sharding元数据</p>\n<h3><strong>小结</strong></h3>\n<p>这套方案综合利用了增量区间和散列两种路由方式的优势，避免了数据迁移和“热点”问题，同时，它对Sharding拓扑结构建模，使用了一致的路由算法，从而避免了扩容时修改路由代码，是一种理想的Sharding扩容方案。</p>\n<p><a href=\"http://blog.csdn.net/bluishglc/article/details/6161475\" target=\"_blank\" name=\"6161475\"></a></p>\n<h1><a href=\"http://blog.csdn.net/bluishglc/article/details/6161475\" target=\"_blank\" name=\"6161475\"></a></h1>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111927\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111927votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111927\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "cca88c074547b53fcc59c01e5736f847", "com_num": 0, "title": "DB 分库分表（5）：一种支持自由规划无须数据迁移和修改路由代码的 Sharding 扩容方案", "url": "http://blog.jobbole.com/111927/", "praise_num": "1", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg", "create_date": "2017/07/19", "tags": "IT技术,分库分表,数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"]},{"fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7710738\">Laurence的技术博客</a>   </div><p>本文将主要介绍一些常见的全局主键生成策略，然后重点介绍flickr使用的一种非常优秀的全局主键生成方案。关于分库分表(sharding)的拆分策略和实施细则，请参考该系列的前一篇文章：<a href=\"http://blog.jobbole.com/111860/\" target=\"_blank\">DB 分库分表（1）：拆分实施策略和示例演示</a></p>\n<p><strong>第一部分：一些常见的主键生成策略</strong></p>\n<p>一旦<a class=\"replace_word\" title=\"MySQL知识库\" href=\"http://lib.csdn.net/base/14\" target=\"_blank\">数据库</a>被切分到多个物理结点上，我们将不能再依赖数据库自身的主键生成机制。一方面，某个分区数据库自生成的ID无法保证在全局上是唯一的；另一方面，应用程序在插入数据之前需要先获得ID,以便进行SQL路由。目前几种可行的主键生成策略有：<br>\n1. UUID：使用UUID作主键是最简单的方案，但是缺点也是非常明显的。由于UUID非常的长，除占用大量存储空间外，最主要的问题是在索引上，在建立索引和基于索引进行查询时都存在性能问题。<br>\n2. 结合数据库维护一个Sequence表：此方案的思路也很简单，在数据库中建立一个Sequence表，表的结构类似于：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719e94c77b7074791100\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE `SEQUENCE` (  \r\n    `tablename` varchar(30) NOT NULL,  \r\n    `nextid` bigint(20) NOT NULL,  \r\n    PRIMARY KEY (`tablename`)  \r\n) ENGINE=InnoDB</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719e94c77b7074791100-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719e94c77b7074791100-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719e94c77b7074791100-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719e94c77b7074791100-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719e94c77b7074791100-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719e94c77b7074791100-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">SEQUENCE</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719e94c77b7074791100-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">tablename</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59719e94c77b7074791100-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">nextid</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719e94c77b7074791100-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">tablename</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59719e94c77b7074791100-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">InnoDB</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>每当需要为某个表的新纪录生成ID时就从Sequence表中取出对应表的nextid,并将nextid的值加1后更新到数据库中以备下次使用。此方案也较简单，但缺点同样明显：由于所有插入任何都需要访问该表，该表很容易成为系统性能瓶颈，同时它也存在单点问题，一旦该表数据库失效，整个应用程序将无法工作。有人提出使用Master-Slave进行主从同步，但这也只能解决单点问题，并不能解决读写比为1:1的访问压力问题。</p>\n<p>除此之外，还有一些方案，像对每个数据库结点分区段划分ID,以及网上的一些ID生成算法，因为缺少可操作性和实践检验，本文并不推荐。实际上，接下来，我们要介绍的是Fickr使用的一种主键生成方案，这个方案是目前我所知道的最优秀的一个方案，并且经受了实践的检验，可以为大多数应用系统所借鉴。</p>\n<p><strong>第二部分：一种极为优秀的主键生成策略</strong></p>\n<p>flickr开发团队在2010年撰文介绍了flickr使用的一种主键生成测策略，同时表示该方案在flickr上的实际运行效果也非常令人满意，原文连接：<a href=\"http://code.flickr.com/blog/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/\" target=\"_blank\">Ticket Servers: Distributed Unique Primary Keys on the Cheap </a>这个方案是我目前知道的最好的方案，它与一般Sequence表方案有些类似，但却很好地解决了性能瓶颈和单点问题，是一种非常可靠而高效的全局主键生成方案。</p>\n<p align=\"center\"><img src=\"http://ww1.sinaimg.cn/large/67a6a651gw1dujgqcx9ncj.jpg\" alt=\"\"></p>\n<p align=\"center\"><strong>图1. flickr采用的sharding主键生成方案示意图</strong>(<a href=\"http://ww1.sinaimg.cn/large/67a6a651gw1dujgqcx9ncj.jpg\" target=\"_blank\">点击查看大图</a>)</p>\n<p>flickr这一方案的整体思想是：建立两台以上的数据库ID生成服务器，每个服务器都有一张记录各表当前ID的Sequence表，但是Sequence中ID增长的步长是服务器的数量，起始值依次错开，这样相当于把ID的生成散列到了每个服务器节点上。例如：如果我们设置两台数据库ID生成服务器，那么就让一台的Sequence表的ID起始值为1,每次增长步长为2,另一台的Sequence表的ID起始值为2,每次增长步长也为2，那么结果就是奇数的ID都将从第一台服务器上生成，偶数的ID都从第二台服务器上生成，这样就将生成ID的压力均匀分散到两台服务器上，同时配合应用程序的控制，当一个服务器失效后，系统能自动切换到另一个服务器上获取ID，从而保证了系统的容错。</p>\n<p>关于这个方案，有几点细节这里再说明一下：</p>\n<p>1. flickr的数据库ID生成服务器是专用服务器，服务器上只有一个数据库，数据库中表都是用于生成Sequence的，这也是因为auto-increment-offset和auto-increment-increment这两个数据库变量是数据库实例级别的变量。<br>\n2. flickr的方案中表格中的stub字段只是一<code>个char(1) NOT NULL存根字段，并非表名，因此，一般来说，一个Sequence表只有一条纪录，可以同时为多张表生成ID，如果需要表的ID是有连续的，需要为该表单独建立<code>Sequence表</code>。</code></p>\n<p>3. 方案使用了<a class=\"replace_word\" title=\"MySQL知识库\" href=\"http://lib.csdn.net/base/14\" target=\"_blank\">MySQL</a>的LAST_INSERT_ID()函数，这也决定了Sequence表只能有一条记录。<br>\n4. 使用REPLACE INTO插入数据，这是很讨巧的作法，主要是希望利用mysql自身的机制生成ID,不仅是因为这样简单，更是因为我们需要ID按照我们设定的方式(初值和步长)来生成。</p>\n<p>5. SELECT LAST_INSERT_ID()必须要于REPLACE INTO语句在同一个数据库连接下才能得到刚刚插入的新ID，否则返回的值总是0<br>\n6. 该方案中Sequence表使用的是<strong>MyISAM</strong>引擎，以获取更高的性能，注意：MyISAM引擎使用的是表级别的锁，<strong>MyISAM对表的读写是串行的</strong>，因此不必担心在并发时两次读取会得到同一个ID(另外，应该程序也不需要同步，每个请求的线程都会得到一个新的connection,不存在需要同步的共享资源)。经过实际对比测试，使用一样的Sequence表进行ID生成，MyISAM引擎要比InnoDB表现高出很多！</p>\n<p>7. 可使用纯JDBC实现对Sequence表的操作，以便获得更高的效率，实验表明，即使只使用<a class=\"replace_word\" title=\"Java EE知识库\" href=\"http://lib.csdn.net/base/17\" target=\"_blank\">spring</a> JDBC性能也不及纯JDBC来得快！</p>\n<p>实现该方案，应用程序同样需要做一些处理，主要是两方面的工作：<br>\n1. 自动均衡数据库ID生成服务器的访问<br>\n2. 确保在某个数据库ID生成服务器失效的情况下，能将请求转发到其他服务器上执行。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111866\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111866votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111866\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "d374f2fc6bd013a58513687fe2fe4e97", "com_num": 0, "title": "DB 分库分表（2）：全局主键生成策略", "url": "http://blog.jobbole.com/111866/", "praise_num": "1", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg", "create_date": "2017/07/16", "tags": "IT技术,分库分表,数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"]},{"fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hector\">hoohack</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>最近开发中遇到的一个 MySQL 主从延迟的坑，记录并总结，避免再次犯同样的错误。</p>\n<h3>情景</h3>\n<p>一个活动信息需要审批，审批之后才能生效。因为之后活动要编辑，编辑后也可能触发审批，审批中展示的是编辑前的活动内容，考虑到字段比较多，也要保存审批活动的内容，因此设计采用了一张临时表，审批中的活动写进审批表(activity_tmp)，审批通过之后才把真正的活动内容写进活动表(activity)。表的简要设计如下，这里将活动内容字段合并为content展示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971219601f55569378755\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nactivity_tmp（）\r\nid\r\nstatus // 审批状态    \r\ncontent //  审批阶段提交的活动内容\r\n\r\nactivity\r\nid\r\ncontent // 审批通过后真正展示的活动内容</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971219601f55569378755-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971219601f55569378755-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971219601f55569378755-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971219601f55569378755-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971219601f55569378755-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971219601f55569378755-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971219601f55569378755-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971219601f55569378755-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971219601f55569378755-1\"><span class=\"crayon-v\">activity</span><span class=\"crayon-sy\">_</span>tmp（）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971219601f55569378755-2\"><span class=\"crayon-e\">id</span></div><div class=\"crayon-line\" id=\"crayon-5971219601f55569378755-3\"><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 审批状态    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971219601f55569378755-4\"><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//  审批阶段提交的活动内容</span></div><div class=\"crayon-line\" id=\"crayon-5971219601f55569378755-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971219601f55569378755-6\"><span class=\"crayon-e\">activity</span></div><div class=\"crayon-line\" id=\"crayon-5971219601f55569378755-7\"><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971219601f55569378755-8\"><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 审批通过后真正展示的活动内容</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3>遇到的问题</h3>\n<p>当时是有编辑触发审批的情况，发现审批通过之后活动内容是空的，于是开始追查问题的原因。这里说一句，当程序出问题的时候，95%都是代码的问题，先不要去怀疑环境出问题。好好的查日志，然后看看你的代码吧。</p>\n<h3>追查问题回溯</h3>\n<p>1、查activity_tmp表，发现当时提交审批的活动内容是正常的，而且状态也更新为审批通过了，怀疑是写入activity表失败 2、查activity表，发现审批后的内容确实没有写入，怀疑是代码问题 3、查看代码，代码逻辑没看出问题，怀疑数据库操作失败，查看日志 4、日志显示，有一句insert语句的活动内容为空，活动内容来自上一个mysql执行的是select语句，把该select语句拿出来放到线上的备库查询，发现活动内容是存在的。运行时查询为空，执行完毕后查询时内容存在，初步怀疑是主从延迟问题。 5、报错只是部分失败，确定是主从延迟的问题。</p>\n<h3>当时的问题代码</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971219601f64717485039\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$intStatus = $arrInput[‘status’];\r\n$this-&gt;objActTmp-&gt;updateInfoByAId($intActId, $intStatus);\r\n// 更新后，马上查\r\n$arrActContent = $this-&gt;objActTmp-&gt;getActByStatus($intStatus);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971219601f64717485039-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971219601f64717485039-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971219601f64717485039-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971219601f64717485039-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971219601f64717485039-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">intStatus</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">arrInput</span><span class=\"crayon-sy\">[</span>‘<span class=\"crayon-i\">status</span>’<span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971219601f64717485039-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">objActTmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">updateInfoByAId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">intActId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">intStatus</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971219601f64717485039-3\"><span class=\"crayon-c\">// 更新后，马上查</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971219601f64717485039-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">arrActContent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">objActTmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getActByStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">intStatus</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这就是主从延迟出现的地方，update后，马上get，这是主从复制架构上开发的一个大忌。</p>\n<h3>解决方案</h3>\n<p>这类问题的解决方案有两种：</p>\n<ul>\n<li>修改代码逻辑</li>\n<li>修改系统架构</li>\n</ul>\n<p>对于修改代码逻辑，鄙人有两点见解：</p>\n<ul>\n<li>如果第二步获取的数据不需要第一步更新的status字段，那就先读，然后再更新</li>\n<li>如果第二步获取的数据需要依赖第一步的status字段，那就在读出来的时候先判断是否为空，如果是空的，报错，下一次重试。</li>\n</ul>\n<h3>总结</h3>\n<p>其实之前也听到过这样的例子，但是由于没有亲身经历，所以只保留了一种理论上的记忆，实际上印象不深，经历了这么一次踩坑后，印象特别深刻，现在看到别人写这样的代码也能马上发现并指出。还是自己亲身去踩坑印象最深。</p>\n<p>日志很重要，详细的日志更重要。日志要记录有用的信息，方便追查问题的时候去追溯问题的本质原因。我觉得日志就应该尽量做成飞机中的黑匣子，帮助我们保存“事故“发生时的所有相关信息。</p>\n<article><!-- JiaThis Button END --></article>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/7aa70eaa311d5a5dec82ca0d49624741.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/1a4b335ec981d013f4002205a23fedd0.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111853\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111853votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111853\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hector\">hoohack</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hector\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/df22a501f19a5bba1b3331e2001f8ec2.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个正在努力的菜鸟        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hector\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hector/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hector/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 27</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.hoohack.me\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/2388493434?is_all=1\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：914099943\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：hhq8307231\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/hoohack\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "df601b45a5e7f03fd66ac73fba2d5733", "com_num": 0, "title": "记一次 MySQL 主从复制延迟的踩坑", "url": "http://blog.jobbole.com/111853/", "praise_num": "1", "front_image_path": "full/ed02bd36286ef5ec9f067bc8d381a46ca5124f1e.jpg", "create_date": "2017/07/16", "tags": "IT技术,MySQL,数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/6813e861d7765d2cf8c1f7f313083944.jpg"]},{"fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7696085\">Laurence的技术博客</a>   </div><p><strong>第一部分：实施策略</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4d96fb1fcbf89962346119fdae9e9584.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><strong>图1.数据库分库分表(sharding)实施策略图解(<a href=\"http://ww1.sinaimg.cn/large/67a6a651gw1ducq4lmzyzj.jpg\">点击查看大图</a>)</strong></p>\n<p><strong>1.准备阶段</strong></p>\n<p>对数据库进行分库分表(Sharding化)前，需要开发人员充分了解系统业务逻辑和数据库schema.一个好的建议是绘制一张数据库ER图或领域模型图，以这类图为基础划分shard,直观易行，可以确保开发人员始终保持清醒思路。对于是选择数据库ER图还是领域模型图要根据项目自身情况进行选择。如果项目使用数据驱动的开发方式，团队以数据库ER图作为业务交流的基础，则自然会选择数据库ER图，如果项目使用的是领域驱动的开发方式，并通过OR-Mapping构建了一个良好的领域模型，那么领域模型图无疑是最好的选择。就我个人来说，更加倾向使用领域模型图，因为进行切分时更多的是以业务为依据进行分析判断，领域模型无疑更加清晰和直观。</p>\n<p><strong>2.分析阶段</strong></p>\n<p>1. 垂直切分<br>\n垂直切分的依据原则是：将业务紧密，表间关联密切的表划分在一起，例如同一模块的表。结合已经准备好的数据库ER图或领域模型图，仿照活动图中的泳道概念，一个泳道代表一个shard，把所有表格划分到不同的泳道中。下面的分析示例会展示这种做法。当然，你也可以在打印出的ER图或模型图上直接用铅笔圈，一切取决于你自己的喜好。</p>\n<p><strong>2. 水平切分</strong><br>\n垂直切分后，需要对shard内表格的数据量和增速进一步分析，以确定是否需要进行水平切分。</p>\n<p><strong>2.1</strong>若划分到一起的表格数据增长缓慢，在产品上线后可遇见的足够长的时期内均可以由单一数据库承载，则不需要进行水平切分，所有表格驻留同一shard,所有表间关联关系会得到最大限度的保留，同时保证了书写SQL的自由度，不易受join、group by、order by等子句限制。</p>\n<p><strong>2.2</strong> 若划分到一起的表格数据量巨大，增速迅猛，需要进一步进行水平分割。进一步的水平分割就这样进行：</p>\n<p><strong>2.2.1</strong>.结合业务逻辑和表间关系，将当前shard划分成多个更小的shard,通常情况下，这些更小的shard每一个都只包含一个主表（将以该表ID进行散列的表）和多个与其关联或间接关联的次表。这种一个shard一张主表多张次表的状况是水平切分的必然结果。这样切分下来，shard数量就会迅速增多。如果每一个shard代表一个独立的数据库，那么管理和维护数据库将会非常麻烦，而且这些小shard往往只有两三张表，为此而建立一个新库，利用率并不高，因此，在水平切分完成后可再进行一次“反向的Merge”,即：将业务上相近，并且具有相近数据增长速率（主表数据量在同一数量级上）的两个或多个shard放到同一个数据库上，在逻辑上它们依然是独立的shard，有各自的主表，并依据各自主表的ID进行散列，不同的只是它们的散列取模（即节点数量）必需是一致的。这样，每个数据库结点上的表格数量就相对平均了。</p>\n<p><strong>2.2.2. </strong>所有表格均划分到合适的shard之后，所有跨越shard的表间关联都必须打断，在书写sql时，跨shard的join、group by、order by都将被禁止，需要在应用程序层面协调解决这些问题。</p>\n<p>特别想提一点：经水平切分后，shard的粒度往往要比只做垂直切割的粒度要小，原单一垂直shard会被细分为一到多个以一个主表为中心关联或间接关联多个次表的shard，此时的shard粒度与领域驱动设计中的“聚合”概念不谋而合，甚至可以说是完全一致，每个shard的主表正是一个聚合中的聚合根！</p>\n<p><strong>3.实施阶段</strong><br>\n如果项目在开发伊始就决定进行分库分表，则严格按照分析设计方案推进即可。如果是在中期架构演进中实施，除搭建实现sharding逻辑的基础设施外(关于该话题会在下篇文章中进行阐述)，还需要对原有SQL逐一过滤分析，修改那些因为sharding而受到影响的sql.</p>\n<p><strong>第二部分：示例演示</strong></p>\n<p>本文选择一个人尽皆知的应用：jpetstore来演示如何进行分库分表(sharding)在分析阶段的工作。由于一些个人原因，演示使用的jpetstore来自原ibatis官方的一个Demo版本，SVN地址为：http://mybatis.googlecode.com/svn/tags/java_release_2.3.4-726/jpetstore-5。关于jpetstore的业务逻辑这里不再介绍，这是一个非常简单的电商系统原型，其领域模型如下图：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bc2711a69bd224bbf973fa03cbf4e5a9.jpg\" alt=\"\" width=\"888\" height=\"371\"></p>\n<p style=\"text-align: center\"><strong>图2. jpetstore领域模型</strong></p>\n<p>由于系统较简单，我们很容易从模型上看出，其主要由三个模块组成：用户，产品和订单。那么垂直切分的方案也就出来了。接下来看水平切分，如果我们从一个实际的宠物店出发考虑，可能出现数据激增的单表应该是Account和Order,因此这两张表需要进行水平切分。对于Product模块来说，如果是一个实际的系统，Product和Item的数量都不会很大，因此只做垂直切分就足够了，也就是（Product，Category，Item，Iventory，Supplier）五张表在一个数据库结点上（没有水平切分，不会存在两个以上的数据库结点）。<strong>但是作为一个演示，我们假设产品模块也有大量的数据需要我们做水平切分</strong>，那么分析来看，这个模块要拆分出两个shard:一个是（Product（主），Category），另一个是（Item（主），Iventory，Supplier），<strong>同时，我们认为：这两个shard在数据增速上应该是相近的，且在业务上也很紧密</strong>，那么我们可以<strong>把这两个shard放在同一个数据库节点上，Item和Product数据在散列时取一样的模</strong>。根据前文介绍的图纸绘制方法，我们得到下面这张sharding示意图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/883e27937895e73700b2f78bb4106a31.jpg\" alt=\"\" width=\"867\" height=\"365\"></p>\n<p style=\"text-align: center\"><strong>图3. jpetstore sharding示意图</strong></p>\n<p>对于这张图再说明几点：<br>\n<strong>1.使用泳道表示物理shard（一个数据库结点）</strong></p>\n<p><strong>2.若<strong>垂直切分出的shard进行了进一步的水平切分，但公用一个物理shard的话，则用虚线框住，表示其在逻辑上是一个独立的shard。</strong><br>\n</strong></p>\n<p><strong>3.深色实体表示主表</strong></p>\n<p><strong>4.X表示需要打断的表间关联</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111860\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111860votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111860\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "b299e9cd2dda0c69c7c1c010f60074f4", "com_num": 0, "title": "DB 分库分表（1）：拆分实施策略和示例演示", "url": "http://blog.jobbole.com/111860/", "praise_num": "1", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg", "create_date": "2017/07/15", "tags": "IT技术,分库分表,数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"]},{"fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/bash-prompt-tips-and-tricks\">Dave Neary</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8711-1.html\">Linux中国/toyijiu</a>   </div><p>当你在 Linux 环境下打开一个 Shell 终端时，会看到命令行中出现了类似下面的一个 Bash 提示符：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ec0395e2065167803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[user@$host ~]$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ec0395e2065167803-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ec0395e2065167803-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>你知道命令行提示符其实是可以自己设置添加许多非常有用的信息的吗？在这篇文章中我就会教你如何自定义自己的 Bash 命令行提示符，想看的话就接着看吧~</p>\n<h3 id=\"toc_1\">如何设置 Bash 提示符</h3>\n<p>Bash 提示符是通过环境变量 <code>PS1</code> （提示符字符串 1Prompt String 1） 来设置的，它用于交互式 shell 提示符。当然如果你需要更多的输入才能完成一个 Bash 命令时，<code>PS2</code> 环境变量就是用来设置多行提示符的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ec0395ec603751741\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[dneary@dhcp-41-137 ~]$ export PS1=\"[Linux Rulez]$ \"\r\n[Linux Rulez] export PS2=\"... \"\r\n[Linux Rulez] if true; then\r\n... echo \"Success!\"\r\n... fi\r\nSuccess!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ec0395ec603751741-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ec0395ec603751741-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ec0395ec603751741-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ec0395ec603751741-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ec0395ec603751741-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ec0395ec603751741-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ec0395ec603751741-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dneary</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dhcp</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">41</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">137</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">export </span><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"[Linux Rulez]$ \"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ec0395ec603751741-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Linux </span><span class=\"crayon-v\">Rulez</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">export </span><span class=\"crayon-v\">PS2</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"... \"</span></div><div class=\"crayon-line\" id=\"crayon-59719ec0395ec603751741-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Linux </span><span class=\"crayon-v\">Rulez</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ec0395ec603751741-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Success!\"</span></div><div class=\"crayon-line\" id=\"crayon-59719ec0395ec603751741-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ec0395ec603751741-6\"><span class=\"crayon-v\">Success</span><span class=\"crayon-o\">!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">在哪里设置 PS1 的值？</h3>\n<p><code>PS1</code> 就是一个普通的环境变量，系统默认值设置在 <code>/etc/bashrc</code> 中，在我的系统中，默认提示符通过以下命令来设置的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ec0395f1563723963\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[ \"$PS1\" = \"\\\\s-\\\\v\\\\\\$ \" ] &amp;&amp; PS1=\"[\\u@\\h \\W]\\\\$ \"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ec0395f1563723963-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ec0395f1563723963-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$PS1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\\\s-\\\\v\\\\\\$ \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"[\\u@\\h \\W]\\\\$ \"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>它判断 <code>PS1</code> 是否是系统的默认值 <code>\\s-\\v$</code> ，如果是的话则将值设置为 <code>[\\u@\\h \\W]\\$</code>。（LCTT 译注：注意命令中用 <code>\\</code> 做了转义。）</p>\n<p>但如果你想要自定义提示符，不应该修改 <code>/etc/bashrc</code> ，而是应该在你的主目录下将自定义命令加到 <code>.bashrc</code> 文件中。</p>\n<h3 id=\"toc_3\">上面提到的 <code>\\u</code>、<code>\\h</code>、<code>\\W</code>、<code>\\s</code> 和 <code>\\v</code> 是什么意思？</h3>\n<p>在 <code>man bash</code> 中的 PROMPTING 章节中，你能够找到所有 <code>PS1</code> 和 <code>PS2</code> 相关的特殊字符的描述，以下是一些比较常用的：</p>\n<ul>\n<li><code>\\u</code>：用户名</li>\n<li><code>\\h</code>：短主机名</li>\n<li><code>\\W</code>：当前你所在的目录的名称（basename），<code>~</code> 表示你的主目录</li>\n<li><code>\\s</code>：Shell 名字（bash 或者 sh，取决于你的 Shell 的名字是什么）</li>\n<li><code>\\v</code>：Shell 的版本号</li>\n</ul>\n<h3 id=\"toc_4\">还有哪些特殊的字符串可以用在提示符当中</h3>\n<p>除了上面这些，还有很多有用的字符串可以用在提示符当中：</p>\n<ul>\n<li><code>\\d</code>：将日期扩展成 “Tue Jun 27” 这种格式</li>\n<li><code>\\D{fmt}</code>：允许自定义日期格式——可通过 <code>man strftime</code> 来获得更多信息</li>\n<li><code>\\D{%c}</code>：获得本地化的日期和时间</li>\n<li><code>\\n</code>：换行（参考下面的多行提示符）</li>\n<li><code>\\w</code>：显示当前工作目录的完整路径</li>\n<li><code>\\H</code>：当前工作机器的完整主机名</li>\n</ul>\n<p>除了以上这些，你还可以在 Bash 的 man 页面的 PROMPTING 部分找到更多的特殊字符和它的用处。</p>\n<h3 id=\"toc_5\">多行提示符</h3>\n<p>如果你的提示符过长（比如说你想包括 <code>\\H</code> 、<code>\\w</code> 或完整的日期时间时 ），想将提示符切成两行，可以使用 <code>\\n</code> 将提示符切断成两行显示，比如下面的多行的例子会在第一行显示日期、时间和当前工作目录，第二行显示用户名和主机名：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ec0395f6742104410\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPS1=\"\\D{%c} \\w\\n[\\u@\\H]$ \"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ec0395f6742104410-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ec0395f6742104410-1\"><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\D{%c} \\w\\n[\\u@\\H]$ \"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">还能再好玩点吗？</h3>\n<p>人们偶尔也想将提示符变成彩色的。虽然我觉得彩色提示符让人分心、易怒，但是也许你很喜欢。如果我们想将日期变成红色的，目录变成青蓝色，用户名搞一个黄色背景，你可以这样做：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/e93d223f94256801e7b835a1d8a8fd6a.png\"><img class=\"alignnone size-full wp-image-111975\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e93d223f94256801e7b835a1d8a8fd6a.png\" alt=\"QQ截图20170721114211\"></a></p>\n<ul>\n<li><code><p style=\"text-align:center;\"><span class=\"MathJax_Preview\"><img src=\"http://blog.jobbole.com/wp-content/plugins/latex/cache/tex_58b9e70b65a77700ba66e9c64d6b9f89.gif\" style=\"vertical-align: middle; border: none;\" class=\"tex\" alt=\"..\"></span><script type=\"math/tex;  mode=display\">..</script></p></code> ：表示一些非打印字符</li>\n<li><code>\\e[..</code> ：转义字符，后面的跟着的特定的转义字符串在终端中表示颜色或者其他意思</li>\n<li><code>31m</code> ：表示红色字体（<code>41m</code> 表示是红色背景）</li>\n<li><code>36m</code> ：表示是青蓝色字体</li>\n<li><code>1;43m</code> ：表示黄色字体（<code>1;33m</code> 表示黄色字体）</li>\n<li><code>[\\e[0m]]</code> ：它在最后将颜色恢复成系统终端默认颜色</li>\n</ul>\n<p>你可以在 <a class=\"ext\" href=\"http://tldp.org/HOWTO/Bash-Prompt-HOWTO/x329.html\" target=\"_blank\" rel=\"external nofollow\">Bash prompt HOWTO</a> 这里找到更多的颜色代码，甚至可以让字符反相和闪烁！我不知道为什么地球人会有这种想法，但是你可以这么干！</p>\n<p>所以你最喜欢的自定义提示符是什么样子的呢？有没有让你抓狂的自定义提示符呢？请在评论里告诉我吧~</p>\n<p>作者简介：</p>\n<p>Dave Neary – Dave Neary 是红帽开源和标准化团队成员，帮助开源项目对红帽的成功至关重要。自从在 1999 年为 GIMP 提交了第一个补丁以来，他一直带着各种不同的帽子，在开源的世界徜徉。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111971\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111971votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111971\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "8d8f78aafcb5a019513c49f2cd214efb", "com_num": 0, "title": "Linux Bash 提示符的一些骚操作", "url": "http://blog.jobbole.com/111971/", "praise_num": "1", "front_image_path": "full/a6e095311cee5dbfc6a3b7e5127f63181f1ad769.jpg", "create_date": "2017/07/21", "tags": "IT技术,Linux", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/23426c26d6b88a782a1d894de8e89bca.jpg"]},{"fav_num": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/justin_ygg\">Justin_YGG</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://github.com/kamranahmedse/design-patterns-for-humans/blob/master/README.md#structural-design-patterns\">kamranahmedse</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>用最简单的语言，解释设计模式。</p>\n<p>虽然示例代码是用 PHP7 实现的，但因为概念是一样的，所以语言并不会阻碍大家理解设计模式。</p>\n<p>《<a href=\"http://blog.jobbole.com/111799/\" target=\"_blank\">人人都能读懂的设计模式（1）：创建型模式</a>》</p>\n<h3>结构型设计模式</h3>\n<h4>概述</h4>\n<p>结构型设计模式主要关注对象组合，换句话说，关注实体之间如何互相使用。 或者还有另外一个解释，结构型设计模式有助于回答“如何构建软件组件？”</p>\n<h4>维基百科</h4>\n<p>在软件工程中，结构型设计模式是借由一以贯之的方式来了解元件间的关系，从而简化设计的一种设计模式。</p>\n<p><strong>分类</strong></p>\n<ul>\n<li>适配器模式</li>\n<li>桥接模式</li>\n<li>组合模式</li>\n<li>修饰模式</li>\n<li>外观模式</li>\n<li>享元模式</li>\n<li>代理模式</li>\n</ul>\n<h3>🔌 适配器模式</h3>\n<h4>现实生活示例</h4>\n<p>考虑这样一个场景，你的存储卡中有一些照片，你需要将其传输到计算机。为此，你需要某种与计算机端口兼容的适配器，以便将存储卡连接到计算机上。在这种情况下，读卡器就是适配器。另外一个例子就是大名鼎鼎的电源适配器：一个三脚插头不能连接到双插头插座，需要使用电源适配器使其与双插头插座兼容。另外一个例子是译者将一个人说的话翻译给另一个人。</p>\n<h4>概述</h4>\n<p>适配器模式可以将不兼容的对象包装成适配器来适配其它类。</p>\n<h4>维基百科</h4>\n<p>在软件工程中，适配器模式是允许将现有类的接口用作另一个类接口的软件设计模式。它通常用于现有类与其他类的协作，而无需修改现有类的代码。</p>\n<p><strong>程序示例</strong></p>\n<p>考虑一个游戏场景，有一个猎人，他狩猎狮子。</p>\n<p>首先给出 <code>Lion</code> 接口，所有种类的狮子都要实现这个接口。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea4122fb213126105\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Lion\r\n{\r\n    public function roar();\r\n}\r\n\r\nclass AfricanLion implements Lion\r\n{\r\n    public function roar()\r\n    {\r\n    }\r\n}\r\n\r\nclass AsianLion implements Lion\r\n{\r\n    public function roar()\r\n    {\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea4122fb213126105-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea4122fb213126105-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AfricanLion</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span></div><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-12\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-13\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AsianLion</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-14\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea4122fb213126105-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea4122fb213126105-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>猎人希望可以狩猎任何实现 <code>Lion</code> 接口的狮子</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412309031513789\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Hunter\r\n{\r\n    public function hunt(Lion $lion)\r\n    {\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412309031513789-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412309031513789-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412309031513789-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412309031513789-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412309031513789-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412309031513789-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412309031513789-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Hunter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412309031513789-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412309031513789-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hunt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412309031513789-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412309031513789-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412309031513789-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>现在我们假定猎人在游戏中也可以狩猎<code>野狗</code>。但是目前我们无法实现，因为狗是通过其他接口实现。为了让猎人可以狩猎野狗，我们需要创建一个适配器，来兼容这种情况。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412311232658689\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// This needs to be added to the game\r\nclass WildDog\r\n{\r\n    public function bark()\r\n    {\r\n    }\r\n}\r\n\r\n// Adapter around wild dog to make it compatible with our game\r\nclass WildDogAdapter implements Lion\r\n{\r\n    protected $dog;\r\n\r\n    public function __construct(WildDog $dog)\r\n    {\r\n        $this-&gt;dog = $dog;\r\n    }\r\n\r\n    public function roar()\r\n    {\r\n        $this-&gt;dog-&gt;bark();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412311232658689-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412311232658689-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-1\"><span class=\"crayon-c\">// This needs to be added to the game</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WildDog</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bark</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-8\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-9\"><span class=\"crayon-c\">// Adapter around wild dog to make it compatible with our game</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-10\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WildDogAdapter</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-11\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">WildDog</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">dog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-18\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">dog</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">bark</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412311232658689-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412311232658689-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>这样，在游戏中通过 <code>WildDogAdapter</code> 就可以使用 <code>WildDog</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412316600505060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">PHP</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$wildDog = new WildDog();\r\n$wildDogAdapter = new WildDogAdapter($wildDog);\r\n\r\n$hunter = new Hunter();\r\n$hunter-&gt;hunt($wildDogAdapter);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412316600505060-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412316600505060-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412316600505060-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412316600505060-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412316600505060-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412316600505060-1\"><span class=\"crayon-v\">$wildDog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WildDog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412316600505060-2\"><span class=\"crayon-v\">$wildDogAdapter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WildDogAdapter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$wildDog</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412316600505060-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412316600505060-4\"><span class=\"crayon-v\">$hunter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Hunter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412316600505060-5\"><span class=\"crayon-v\">$hunter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">hunt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$wildDogAdapter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h3>🚡 桥接模式</h3>\n<h4>现实生活示例</h4>\n<p>假如你有一个网站，上面有不同的网页，并且允许用户更改主题。你会如何实现呢？是为每个页面的各个主题创建多个副本，还是创建单独的主题，并根据用户的偏好来加载主题呢？桥接模式可以帮你实现后者。</p>\n<p>不使用桥接模式</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/04/4b4f6fd843a5bfc7ee4880c5c9a71146.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/4b4f6fd843a5bfc7ee4880c5c9a71146-300x221.png\" alt=\"2\"></a> <a href=\"http://jbcdn2.b0.upaiyun.com/2017/04/6b0ea9d009344ad2311de1dfcdadcec0.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/6b0ea9d009344ad2311de1dfcdadcec0-300x221.png\" alt=\"1\"></a></p>\n<p>使用桥接模式</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/04/4b4f6fd843a5bfc7ee4880c5c9a71146.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/4b4f6fd843a5bfc7ee4880c5c9a71146-300x221.png\" alt=\"2\"></a></p>\n<h4>概述</h4>\n<p>桥接模式主打的是组合优于继承。实现细节从对象的层次结构推送给具有单独层次结构的另一个对象。</p>\n<h4>维基百科</h4>\n<p>桥接模式是软件工程中使用的设计模式，旨在“将抽象与实现分离，使得两者可以独立变化”</p>\n<p><strong>程序示例</strong></p>\n<p>以上面提到的网页为例，下面是 <code>WebPage</code> 的结构</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea41231a484322619\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface WebPage\r\n{\r\n    public function __construct(Theme $theme);\r\n    public function getContent();\r\n}\r\n\r\nclass About implements WebPage\r\n{\r\n    protected $theme;\r\n\r\n    public function __construct(Theme $theme)\r\n    {\r\n        $this-&gt;theme = $theme;\r\n    }\r\n\r\n    public function getContent()\r\n    {\r\n        return \"About page in \" . $this-&gt;theme-&gt;getColor();\r\n    }\r\n}\r\n\r\nclass Careers implements WebPage\r\n{\r\n    protected $theme;\r\n\r\n    public function __construct(Theme $theme)\r\n    {\r\n        $this-&gt;theme = $theme;\r\n    }\r\n\r\n    public function getContent()\r\n    {\r\n        return \"Careers page in \" . $this-&gt;theme-&gt;getColor();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231a484322619-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231a484322619-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebPage</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-6\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">About</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebPage</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-10\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"About page in \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">theme</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-22\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Careers</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebPage</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-23\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-30\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Careers page in \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">theme</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231a484322619-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231a484322619-35\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>独立的 <code>主题</code> 结构</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea41231d180209329\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Theme\r\n{\r\n    public function getColor();\r\n}\r\n\r\nclass DarkTheme implements Theme\r\n{\r\n    public function getColor()\r\n    {\r\n        return 'Dark Black';\r\n    }\r\n}\r\nclass LightTheme implements Theme\r\n{\r\n    public function getColor()\r\n    {\r\n        return 'Off white';\r\n    }\r\n}\r\nclass AquaTheme implements Theme\r\n{\r\n    public function getColor()\r\n    {\r\n        return 'Light blue';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41231d180209329-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41231d180209329-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Theme</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DarkTheme</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Theme</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Dark Black'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-13\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LightTheme</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Theme</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-14\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Off white'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-19\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-20\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AquaTheme</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Theme</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-21\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Light blue'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41231d180209329-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41231d180209329-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>都是两层结构</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412321221970936\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$darkTheme = new DarkTheme();\r\n\r\n$about = new About($darkTheme);\r\n$careers = new Careers($darkTheme);\r\n\r\necho $about-&gt;getContent(); // \"About page in Dark Black\";\r\necho $careers-&gt;getContent(); // \"Careers page in Dark Black\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412321221970936-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412321221970936-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412321221970936-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412321221970936-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412321221970936-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412321221970936-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412321221970936-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412321221970936-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">darkTheme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DarkTheme</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412321221970936-2\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412321221970936-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">about</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">About</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">darkTheme</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412321221970936-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">careers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Careers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">darkTheme</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412321221970936-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412321221970936-6\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">about</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// \"About page in Dark Black\";</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412321221970936-7\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">careers</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// \"Careers page in Dark Black\";</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3>🌿 组合模式</h3>\n<h4>现实生活示例</h4>\n<p>每个公司都是由员工组成，每个员工都有一些共同特征比如薪资以及所承担的某些责任，会或者不会向其他人汇报工作，有或者没有下属等。</p>\n<h4>概述</h4>\n<p>组合模式让客户端以统一的方式对待各个对象。</p>\n<h4>维基百科</h4>\n<p>在软件工程中，组合模式是一种分治设计模式。组合模式对待一组对象的处理方式与对待对象的单个实例相同。组合的意图是将对象“组合”成树状结构以呈现<strong>部分-整体</strong>的层次结构。实现组合模式可以使客户端能够均匀地处理单个对象和组合。</p>\n<p><strong>程序示例</strong></p>\n<p>以上面提到的员工为例，下面是不同的员工类型</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412325998638314\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Employee\r\n{\r\n    public function __construct(string $name, float $salary);\r\n    public function getName(): string;\r\n    public function setSalary(float $salary);\r\n    public function getSalary(): float;\r\n    public function getRoles(): array;\r\n}\r\n\r\nclass Developer implements Employee\r\n{\r\n    protected $salary;\r\n    protected $name;\r\n\r\n    public function __construct(string $name, float $salary)\r\n    {\r\n        $this-&gt;name = $name;\r\n        $this-&gt;salary = $salary;\r\n    }\r\n\r\n    public function getName(): string\r\n    {\r\n        return $this-&gt;name;\r\n    }\r\n\r\n    public function setSalary(float $salary)\r\n    {\r\n        $this-&gt;salary = $salary;\r\n    }\r\n\r\n    public function getSalary(): float\r\n    {\r\n        return $this-&gt;salary;\r\n    }\r\n\r\n    public function getRoles(): array\r\n    {\r\n        return $this-&gt;roles;\r\n    }\r\n}\r\n\r\nclass Designer implements Employee\r\n{\r\n    protected $salary;\r\n    protected $name;\r\n\r\n    public function __construct(string $name, float $salary)\r\n    {\r\n        $this-&gt;name = $name;\r\n        $this-&gt;salary = $salary;\r\n    }\r\n\r\n    public function getName(): string\r\n    {\r\n        return $this-&gt;name;\r\n    }\r\n\r\n    public function setSalary(float $salary)\r\n    {\r\n        $this-&gt;salary = $salary;\r\n    }\r\n\r\n    public function getSalary(): float\r\n    {\r\n        return $this-&gt;salary;\r\n    }\r\n\r\n    public function getRoles(): array\r\n    {\r\n        return $this-&gt;roles;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412325998638314-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412325998638314-72\">72</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Employee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getRoles</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-10\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Developer</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Employee</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-11\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-14\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">salary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-20\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">salary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-30\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getRoles</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">roles</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-40\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-42\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Designer</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Employee</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-43\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-46\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">salary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-52\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-57\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">salary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-62\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getRoles</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">roles</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412325998638314-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412325998638314-72\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0076 seconds] -->\r\n<p><span style=\"font-weight: normal\">包含几种不同类型员工的公司</span></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412329330392261\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Organization\r\n{\r\n    protected $employees;\r\n\r\n    public function addEmployee(Employee $employee)\r\n    {\r\n        $this-&gt;employees[] = $employee;\r\n    }\r\n\r\n    public function getNetSalaries(): float\r\n    {\r\n        $netSalary = 0;\r\n\r\n        foreach ($this-&gt;employees as $employee) {\r\n            $netSalary += $employee-&gt;getSalary();\r\n        }\r\n\r\n        return $netSalary;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412329330392261-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412329330392261-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Organization</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">employees</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-4\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addEmployee</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Employee</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">employee</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">employees</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">employee</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getNetSalaries</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">netSalary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">employees </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">employee</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">netSalary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">employee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">netSalary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412329330392261-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412329330392261-20\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>然后可以这样调用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea41232c560800548\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Prepare the employees\r\n$john = new Developer('John Doe', 12000);\r\n$jane = new Designer('Jane Doe', 15000);\r\n\r\n// Add them to organization\r\n$organization = new Organization();\r\n$organization-&gt;addEmployee($john);\r\n$organization-&gt;addEmployee($jane);\r\n\r\necho \"Net salaries: \" . $organization-&gt;getNetSalaries(); // Net Salaries: 27000</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea41232c560800548-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41232c560800548-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41232c560800548-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41232c560800548-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41232c560800548-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41232c560800548-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41232c560800548-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41232c560800548-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41232c560800548-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41232c560800548-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea41232c560800548-1\"><span class=\"crayon-c\">// Prepare the employees</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41232c560800548-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">john</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Developer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'John Doe'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41232c560800548-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jane</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Designer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Jane Doe'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41232c560800548-4\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41232c560800548-5\"><span class=\"crayon-c\">// Add them to organization</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41232c560800548-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">organization</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Organization</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41232c560800548-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">organization</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addEmployee</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">john</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41232c560800548-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">organization</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addEmployee</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jane</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41232c560800548-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41232c560800548-10\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Net salaries: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">organization</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getNetSalaries</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Net Salaries: 27000</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h3>☕ 装饰器模式</h3>\n<h4>现实生活示例</h4>\n<p>想象一下，你在经营一家提供多种服务的汽车服务站。现在如何计算收费帐单呢？选择一项服务，并动态地向其添加价格，直到获得最终成本。这里每种类型的服务就是装饰器。</p>\n<h4>概述</h4>\n<p>通过将对象包装在装饰器类的对象中，装饰器模式可以在运行时动态地更改对象的行为。</p>\n<h4>维基百科</h4>\n<p>装饰器模式，是面向对象编程领域中，一种动态地或静态地往一个类中添加新行为而不影响相同类中其他对象的设计模式。装饰器模式对于遵守单一责任原则通常是有用的，因为它允许在具有独特领域的类之间划分功能。</p>\n<p><strong>程序示例</strong></p>\n<p>我们以咖啡为例，首先我们通过咖啡接口实现一个简单咖啡</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412330127852991\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Coffee\r\n{\r\n    public function getCost();\r\n    public function getDescription();\r\n}\r\n\r\nclass SimpleCoffee implements Coffee\r\n{\r\n    public function getCost()\r\n    {\r\n        return 10;\r\n    }\r\n\r\n    public function getDescription()\r\n    {\r\n        return 'Simple coffee';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412330127852991-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412330127852991-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Coffee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-6\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SimpleCoffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Coffee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Simple coffee'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412330127852991-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412330127852991-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>我们希望代码可扩展，以允许选项在需要时进行修改。 增加一些附加项（装饰器）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412333592065590\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass MilkCoffee implements Coffee\r\n{\r\n    protected $coffee;\r\n\r\n    public function __construct(Coffee $coffee)\r\n    {\r\n        $this-&gt;coffee = $coffee;\r\n    }\r\n\r\n    public function getCost()\r\n    {\r\n        return $this-&gt;coffee-&gt;getCost() + 2;\r\n    }\r\n\r\n    public function getDescription()\r\n    {\r\n        return $this-&gt;coffee-&gt;getDescription() . ', milk';\r\n    }\r\n}\r\n\r\nclass WhipCoffee implements Coffee\r\n{\r\n    protected $coffee;\r\n\r\n    public function __construct(Coffee $coffee)\r\n    {\r\n        $this-&gt;coffee = $coffee;\r\n    }\r\n\r\n    public function getCost()\r\n    {\r\n        return $this-&gt;coffee-&gt;getCost() + 5;\r\n    }\r\n\r\n    public function getDescription()\r\n    {\r\n        return $this-&gt;coffee-&gt;getDescription() . ', whip';\r\n    }\r\n}\r\n\r\nclass VanillaCoffee implements Coffee\r\n{\r\n    protected $coffee;\r\n\r\n    public function __construct(Coffee $coffee)\r\n    {\r\n        $this-&gt;coffee = $coffee;\r\n    }\r\n\r\n    public function getCost()\r\n    {\r\n        return $this-&gt;coffee-&gt;getCost() + 3;\r\n    }\r\n\r\n    public function getDescription()\r\n    {\r\n        return $this-&gt;coffee-&gt;getDescription() . ', vanilla';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412333592065590-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412333592065590-59\">59</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MilkCoffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Coffee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-4\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Coffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-14\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">', milk'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-19\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-20\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-21\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WhipCoffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Coffee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-22\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-24\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Coffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-34\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">', whip'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-39\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-40\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-41\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VanillaCoffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Coffee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-42\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-44\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Coffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-54\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">coffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">', vanilla'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412333592065590-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412333592065590-59\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p>下面我们来做杯咖啡吧</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412337324259634\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$someCoffee = new SimpleCoffee();\r\necho $someCoffee-&gt;getCost(); // 10\r\necho $someCoffee-&gt;getDescription(); // Simple Coffee\r\n\r\n$someCoffee = new MilkCoffee($someCoffee);\r\necho $someCoffee-&gt;getCost(); // 12\r\necho $someCoffee-&gt;getDescription(); // Simple Coffee, milk\r\n\r\n$someCoffee = new WhipCoffee($someCoffee);\r\necho $someCoffee-&gt;getCost(); // 17\r\necho $someCoffee-&gt;getDescription(); // Simple Coffee, milk, whip\r\n\r\n$someCoffee = new VanillaCoffee($someCoffee);\r\necho $someCoffee-&gt;getCost(); // 20\r\necho $someCoffee-&gt;getDescription(); // Simple Coffee, milk, whip, vanilla</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412337324259634-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412337324259634-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412337324259634-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412337324259634-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412337324259634-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412337324259634-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412337324259634-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412337324259634-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412337324259634-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412337324259634-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412337324259634-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412337324259634-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412337324259634-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412337324259634-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412337324259634-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412337324259634-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SimpleCoffee</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412337324259634-2\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 10</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412337324259634-3\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Simple Coffee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412337324259634-4\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412337324259634-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MilkCoffee</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412337324259634-6\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 12</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412337324259634-7\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Simple Coffee, milk</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412337324259634-8\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412337324259634-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WhipCoffee</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412337324259634-10\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 17</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412337324259634-11\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Simple Coffee, milk, whip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412337324259634-12\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412337324259634-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VanillaCoffee</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412337324259634-14\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getCost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 20</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412337324259634-15\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">someCoffee</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getDescription</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Simple Coffee, milk, whip, vanilla</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p></p>\n<h3>📦 外观模式</h3>\n<h4>现实生活示例</h4>\n<p>请问你会如何打开计算机呢？你会回答：“按电源键就行！”。你会这样想是因为你在使用计算机对外提供的简易接口，但是在内部，计算机完成了很多工作后才得以启动，这种复杂子系统的简单接口就是外观模式。</p>\n<h4>概述</h4>\n<p>外观模式提供了一个简化复杂系统的简单接口。</p>\n<h4>维基百科</h4>\n<p>外观模式是指针对像类库这种大体积代码提供简化接口的对象。</p>\n<p><strong>程序示例</strong></p>\n<p>以上面提到的计算机为例，给出计算机类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea41233b575825265\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Computer\r\n{\r\n    public function getElectricShock()\r\n    {\r\n        echo \"Ouch!\";\r\n    }\r\n\r\n    public function makeSound()\r\n    {\r\n        echo \"Beep beep!\";\r\n    }\r\n\r\n    public function showLoadingScreen()\r\n    {\r\n        echo \"Loading..\";\r\n    }\r\n\r\n    public function bam()\r\n    {\r\n        echo \"Ready to be used!\";\r\n    }\r\n\r\n    public function closeEverything()\r\n    {\r\n        echo \"Bup bup bup buzzzz!\";\r\n    }\r\n\r\n    public function sooth()\r\n    {\r\n        echo \"Zzzzz\";\r\n    }\r\n\r\n    public function pullCurrent()\r\n    {\r\n        echo \"Haaah!\";\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233b575825265-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233b575825265-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Computer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getElectricShock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Ouch!\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">makeSound</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Beep beep!\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-12\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">showLoadingScreen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Loading..\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bam</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Ready to be used!\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-22\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">closeEverything</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Bup bup bup buzzzz!\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sooth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Zzzzz\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-32\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pullCurrent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Haaah!\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233b575825265-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233b575825265-37\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>下面是计算机的外观</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea41233e665222712\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass ComputerFacade\r\n{\r\n    protected $computer;\r\n\r\n    public function __construct(Computer $computer)\r\n    {\r\n        $this-&gt;computer = $computer;\r\n    }\r\n\r\n    public function turnOn()\r\n    {\r\n        $this-&gt;computer-&gt;getElectricShock();\r\n        $this-&gt;computer-&gt;makeSound();\r\n        $this-&gt;computer-&gt;showLoadingScreen();\r\n        $this-&gt;computer-&gt;bam();\r\n    }\r\n\r\n    public function turnOff()\r\n    {\r\n        $this-&gt;computer-&gt;closeEverything();\r\n        $this-&gt;computer-&gt;pullCurrent();\r\n        $this-&gt;computer-&gt;sooth();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41233e665222712-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41233e665222712-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ComputerFacade</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">computer</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-4\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Computer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">computer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">computer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">computer</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getElectricShock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">makeSound</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">showLoadingScreen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">bam</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">closeEverything</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">pullCurrent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sooth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41233e665222712-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41233e665222712-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>可以这样使用外观模式</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412341884768984\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$computer = new ComputerFacade(new Computer());\r\n$computer-&gt;turnOn(); // Ouch! Beep beep! Loading.. Ready to be used!\r\n$computer-&gt;turnOff(); // Bup bup buzzz! Haah! Zzzzz</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412341884768984-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412341884768984-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412341884768984-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412341884768984-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">computer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ComputerFacade</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Computer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412341884768984-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Ouch! Beep beep! Loading.. Ready to be used!</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412341884768984-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">computer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Bup bup buzzz! Haah! Zzzzz</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h3>🍃 享元模式</h3>\n<h4>现实生活示例</h4>\n<p>你是否在某个摊位上喝过茶？店主总是会多做一些茶，以预留给其他顾客，以此来节省资源比如燃气。享元模式所讲的就是共享。</p>\n<h4>概述</h4>\n<p>享元模式通过相似对象之间尽可能的资源共享，来最小化内存使用或计算开销。</p>\n<h4>维基百科</h4>\n<p>在计算机编程中，享元模式是一种软件设计模式。享元模式是通过与其他类似对象共享尽可能多的数据来最小化内存使用的对象; 当简单的重复对象过多占用内存时，可以通过享元模式来处理大量相似对象的情况。</p>\n<p><strong>程序示例</strong></p>\n<p>以茶为例，首先定义茶的种类及茶具</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412345667453581\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Anything that will be cached is flyweight.\r\n// Types of tea here will be flyweights.\r\nclass KarakTea\r\n{\r\n}\r\n\r\n// Acts as a factory and saves the tea\r\nclass TeaMaker\r\n{\r\n    protected $availableTea = [];\r\n\r\n    public function make($preference)\r\n    {\r\n        if (empty($this-&gt;availableTea[$preference])) {\r\n            $this-&gt;availableTea[$preference] = new KarakTea();\r\n        }\r\n\r\n        return $this-&gt;availableTea[$preference];\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412345667453581-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412345667453581-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-1\"><span class=\"crayon-c\">// Anything that will be cached is flyweight.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-2\"><span class=\"crayon-c\">// Types of tea here will be flyweights.</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">KarakTea</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-6\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-7\"><span class=\"crayon-c\">// Acts as a factory and saves the tea</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-8\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TeaMaker</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-9\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">availableTea</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">preference</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">availableTea</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">preference</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">availableTea</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">preference</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">KarakTea</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">availableTea</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">preference</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412345667453581-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412345667453581-20\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>然后定义茶店来接单及提供服务</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea41234a845264673\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass TeaShop\r\n{\r\n    protected $orders;\r\n    protected $teaMaker;\r\n\r\n    public function __construct(TeaMaker $teaMaker)\r\n    {\r\n        $this-&gt;teaMaker = $teaMaker;\r\n    }\r\n\r\n    public function takeOrder(string $teaType, int $table)\r\n    {\r\n        $this-&gt;orders[$table] = $this-&gt;teaMaker-&gt;make($teaType);\r\n    }\r\n\r\n    public function serve()\r\n    {\r\n        foreach ($this-&gt;orders as $table =&gt; $tea) {\r\n            echo \"Serving tea to table# \" . $table;\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234a845264673-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234a845264673-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TeaShop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">orders</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">teaMaker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">TeaMaker</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">teaMaker</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">teaMaker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">teaMaker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-10\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">takeOrder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">teaType</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">orders</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">teaMaker</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">teaType</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">serve</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">orders </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tea</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Serving tea to table# \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234a845264673-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234a845264673-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>下面可以这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea41234d209520533\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$teaMaker = new TeaMaker();\r\n$shop = new TeaShop($teaMaker);\r\n\r\n$shop-&gt;takeOrder('less sugar', 1);\r\n$shop-&gt;takeOrder('more milk', 2);\r\n$shop-&gt;takeOrder('without sugar', 5);\r\n\r\n$shop-&gt;serve();\r\n// Serving tea to table# 1\r\n// Serving tea to table# 2\r\n// Serving tea to table# 5</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea41234d209520533-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234d209520533-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234d209520533-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234d209520533-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234d209520533-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234d209520533-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234d209520533-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234d209520533-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234d209520533-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea41234d209520533-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea41234d209520533-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea41234d209520533-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">teaMaker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TeaMaker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234d209520533-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TeaShop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">teaMaker</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234d209520533-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234d209520533-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">takeOrder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'less sugar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234d209520533-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">takeOrder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'more milk'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234d209520533-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">takeOrder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'without sugar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234d209520533-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234d209520533-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">serve</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234d209520533-9\"><span class=\"crayon-c\">// Serving tea to table# 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea41234d209520533-10\"><span class=\"crayon-c\">// Serving tea to table# 2</span></div><div class=\"crayon-line\" id=\"crayon-59719ea41234d209520533-11\"><span class=\"crayon-c\">// Serving tea to table# 5</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h3>🎱 代理模式</h3>\n<h4>现实生活示例</h4>\n<p>有没有过使用门禁卡进门的经历呢？打开门的方法有多种，既可以使用门禁卡，也可以按下门上的安全按钮。门的主要功能是打开，但在其上添加一个代理，便可以给门添加一些功能。下面的代码示例可以给出更好的解释。</p>\n<h4>概述</h4>\n<p>使用代理模式，一个类可以代理另外一个类的功能。</p>\n<h4>维基百科</h4>\n<p>一个代理，其最一般的形式，是一个作为其他类接口的类。代理是由客户端调用的包装器或代理对象，用来访问幕后的真实服务对象。使用代理可以简单地向真实对象做转发，或者可以提供额外的逻辑。在代理模式中，可以提供额外的功能，例如当在真实对象上的操作是资源密集型时进行缓存，或者在调用真实对象的操作之前进行预处理。</p>\n<p><strong>程序示例</strong></p>\n<p>以安全门为例，首先给出安全门接口及实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412351340318808\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Door\r\n{\r\n    public function open();\r\n    public function close();\r\n}\r\n\r\nclass LabDoor implements Door\r\n{\r\n    public function open()\r\n    {\r\n        echo \"Opening lab door\";\r\n    }\r\n\r\n    public function close()\r\n    {\r\n        echo \"Closing the lab door\";\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412351340318808-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412351340318808-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Door</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-6\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LabDoor</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Door</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Opening lab door\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Closing the lab door\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412351340318808-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412351340318808-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>然后使用代理来确保门的安全</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412354386992300\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Security\r\n{\r\n    protected $door;\r\n\r\n    public function __construct(Door $door)\r\n    {\r\n        $this-&gt;door = $door;\r\n    }\r\n\r\n    public function open($password)\r\n    {\r\n        if ($this-&gt;authenticate($password)) {\r\n            $this-&gt;door-&gt;open();\r\n        } else {\r\n            echo \"Big no! It ain't possible.\";\r\n        }\r\n    }\r\n\r\n    public function authenticate($password)\r\n    {\r\n        return $password === '$ecr@t';\r\n    }\r\n\r\n    public function close()\r\n    {\r\n        $this-&gt;door-&gt;close();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412354386992300-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412354386992300-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Security</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">door</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-4\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Door</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">door</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">door</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">door</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">authenticate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">door</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Big no! It ain't possible.\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-18\"> </div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">authenticate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'$ecr@t'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">door</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412354386992300-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412354386992300-28\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>可以这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719ea412358438948521\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$door = new Security(new LabDoor());\r\n$door-&gt;open('invalid'); // Big no! It ain't possible.\r\n\r\n$door-&gt;open('$ecr@t'); // Opening lab door\r\n$door-&gt;close(); // Closing lab door</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719ea412358438948521-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412358438948521-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412358438948521-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719ea412358438948521-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59719ea412358438948521-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719ea412358438948521-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">door</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Security</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LabDoor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412358438948521-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">door</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Big no! It ain't possible.</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412358438948521-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719ea412358438948521-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">door</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'$ecr@t'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Opening lab door</span></div><div class=\"crayon-line\" id=\"crayon-59719ea412358438948521-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">door</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Closing lab door</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>另一个例子是实现某种数据映射器。例如，我最近使用这种模式为 MongoDB 做了一个 ODM（对象数据映射器），其中我使用魔术方法<code>__call（）</code> 在 mongo 类上编写代理。所有的方法调用被代理到原始的 mongo 类，并且检索的结果原样返回，但如果调用 <code>find</code> 或 <code>findOne</code> ，数据会被映射到所需的类对象，并且返回了对象而不是<code>Cursor</code>。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/a9e67955472c1afcad111aa202984192.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111798\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111798votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111798\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg\">Justin_YGG</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/4302cabf679254e36d325f1d9185b6c72.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Python工程师一枚，对go、docker感兴趣，还在成长ing~~        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/justin_ygg\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/justin_ygg/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "52be25117b0479b1012ef04dcc262667", "com_num": 0, "title": "人人都能读懂的设计模式（2）：结构型模式", "url": "http://blog.jobbole.com/111798/", "praise_num": "1", "front_image_path": "full/36430ccefda2f0d333a3bbac206945b3528bf1aa.jpg", "create_date": "2017/07/16", "tags": "IT技术,设计模式", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/1503a298ec77047d9314ddceef5e4ff7.jpg"]},{"fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/justin_ygg\">Justin_YGG</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://github.com/kamranahmedse/design-patterns-for-humans/blob/master/README.md#behavioral-design-patterns\">kamranahmedse</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>用最简单的语言，解释设计模式。</p>\n<p>虽然示例代码是用 PHP7 实现的，但因为概念是一样的，所以语言并不会阻碍大家理解设计模式。</p>\n<ul>\n<li>《<a href=\"http://blog.jobbole.com/111799/\" target=\"_blank\">人人都能读懂的设计模式（1）：创建型模式</a>》</li>\n<li>《<a href=\"http://blog.jobbole.com/111798/\" target=\"_blank\">人人都能读懂的设计模式（2）：结构型模式</a>》</li>\n</ul>\n<h3>概述</h3>\n<p>行为型设计模式关心对象之间的责任分配。与结构型设计模式不同的是，行为型设计模式不仅仅指定结构，而且还概述了它们之间的消息传递/通信的模式。或者换句话说，行为型模式帮助回答了“软件组件是如何运行的？”</p>\n<h3>维基百科</h3>\n<p>在软件工程中，行为型设计模式为设计模式的一种类型，用来识别对象之间的常用交流模式并加以实现。如此，可以在交流时增强灵活性。</p>\n<p><strong>分类</strong></p>\n<ul>\n<li>责任链模式</li>\n<li>命令模式</li>\n<li>迭代器模式</li>\n<li>中介者模式</li>\n<li>备忘录模式</li>\n<li>观察者模式</li>\n<li>访问者模式</li>\n<li>策略模式</li>\n<li>状态模式</li>\n<li>模板方法模式</li>\n</ul>\n<h3>🔗 责任链模式</h3>\n<h4>现实生活示例</h4>\n<p>例如，你的帐户中有三种付款方式（A，B 和 C）; 每种方式付款额不同。 A 可支付 100 美元，B 可支付 300 美元，C 可支付 1000 美元，支付的优先级为 A-&gt;B-&gt;C。现在想要购买价值 210 美元的东西。使用责任链模式，首先将检查帐户 A 是否可以进行购买，如果可以购买，链条将被破坏。如果不能购买，将继续检查账号 B 是否可以购买，如果可以购买，链条将被破坏，否则请求将继续转发，直到找到合适的处理程序。这里的 A、B 和 C 就是责任链的链条，整个现象就是责任链模式。</p>\n<h4>概述</h4>\n<p>责任链模式有助于建立一个对象链。请求从一端进入，在对象之间转发，直到找到合适的处理程序。</p>\n<h4>维基百科</h4>\n<p>责任链模式是面向对象程序设计的一种软件设计模式，它包含了一些命令对象和一系列的处理对象。每一个处理对象决定它能处理哪些命令对象，不能处理的命令对象传递给该链中的下一个处理对象。</p>\n<p><strong>程序示例</strong></p>\n<p>以上面的支付账号为例，首先给出账户基类，包含链接账号的逻辑以及一些不同类型的账户</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a27368770059\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nabstract class Account\r\n{\r\n    protected $successor;\r\n    protected $balance;\r\n\r\n    public function setNext(Account $account)\r\n    {\r\n        $this-&gt;successor = $account;\r\n    }\r\n\r\n    public function pay(float $amountToPay)\r\n    {\r\n        if ($this-&gt;canPay($amountToPay)) {\r\n            echo sprintf('Paid %s using %s' . PHP_EOL, $amountToPay, get_called_class());\r\n        } elseif ($this-&gt;successor) {\r\n            echo sprintf('Cannot pay using %s. Proceeding ..' . PHP_EOL, get_called_class());\r\n            $this-&gt;successor-&gt;pay($amountToPay);\r\n        } else {\r\n            throw new Exception('None of the accounts have enough balance');\r\n        }\r\n    }\r\n\r\n    public function canPay($amount): bool\r\n    {\r\n        return $this-&gt;balance &gt;= $amount;\r\n    }\r\n}\r\n\r\nclass Bank extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}\r\n\r\nclass Paypal extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}\r\n\r\nclass Bitcoin extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a27368770059-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a27368770059-57\">57</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-1\"><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">successor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Account</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">account</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">account</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-10\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">canPay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Paid %s using %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_called_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Cannot pay using %s. Proceeding ..'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_called_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'None of the accounts have enough balance'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-22\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">canPay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">bool</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-28\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-29\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bank</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-30\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-32\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-37\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-38\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-39\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Paypal</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-40\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-42\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-47\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-48\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-49\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bitcoin</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-50\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-52\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a27368770059-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a27368770059-57\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0066 seconds] -->\r\n<p>然后通过上面定义的链接（即 Bank, Paypal, Bitcoin）形成责任链</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a35692465889\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Let's prepare a chain like below\r\n//      $bank-&gt;$paypal-&gt;$bitcoin\r\n//\r\n// First priority bank\r\n//      If bank can't pay then paypal\r\n//      If paypal can't pay then bit coin\r\n\r\n$bank = new Bank(100);          // Bank with balance 100\r\n$paypal = new Paypal(200);      // Paypal with balance 200\r\n$bitcoin = new Bitcoin(300);    // Bitcoin with balance 300\r\n\r\n$bank-&gt;setNext($paypal);\r\n$paypal-&gt;setNext($bitcoin);\r\n\r\n// Let's try to pay using the first priority i.e. bank\r\n$bank-&gt;pay(259);\r\n\r\n// Output will be\r\n// ==============\r\n// Cannot pay using bank. Proceeding ..\r\n// Cannot pay using paypal. Proceeding ..:\r\n// Paid 259 using Bitcoin!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a35692465889-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a35692465889-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-1\"><span class=\"crayon-c\">// Let's prepare a chain like below</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-2\"><span class=\"crayon-c\">//      $bank-&gt;$paypal-&gt;$bitcoin</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-3\"><span class=\"crayon-c\">//</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-4\"><span class=\"crayon-c\">// First priority bank</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-5\"><span class=\"crayon-c\">//      If bank can't pay then paypal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-6\"><span class=\"crayon-c\">//      If paypal can't pay then bit coin</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">          </span><span class=\"crayon-c\">// Bank with balance 100</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Paypal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Paypal with balance 200</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bitcoin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bitcoin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Bitcoin with balance 300</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bitcoin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-14\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-15\"><span class=\"crayon-c\">// Let's try to pay using the first priority i.e. bank</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-16\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">259</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-18\"><span class=\"crayon-c\">// Output will be</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-19\"><span class=\"crayon-c\">// ==============</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-20\"><span class=\"crayon-c\">// Cannot pay using bank. Proceeding ..</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a35692465889-21\"><span class=\"crayon-c\">// Cannot pay using paypal. Proceeding ..:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a35692465889-22\"><span class=\"crayon-c\">// Paid 259 using Bitcoin!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h3>👮 命令模式</h3>\n<h4>现实生活示例</h4>\n<p>一个典型的例子是你在餐厅点菜，你（即客户）向服务员（即 Invoker）点餐（即命令），服务员只需将需求转达给会烹饪的厨师。 另外一个例子是你（即客户端）使用遥控器（Invoker）打开（即命令）电视机（即接收器）。</p>\n<h4>概述</h4>\n<p>命令模式允许将操作封装在对象中，其背后的关键思想是提供客户端与接收器分离的方法。</p>\n<h4>维基百科</h4>\n<p>在面向对象程序设计的范畴中，命令模式是一种行为型设计模式。将所有需要的信息封装到对象中，用于之后的动作（action）或者事件触发。被封装的信息包括方法名以及拥有方法及参数的对象。</p>\n<p><strong>程序示例</strong></p>\n<p>首先给出一个接收器，实现了可能会执行的动作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a3d112319457\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Receiver\r\nclass Bulb\r\n{\r\n    public function turnOn()\r\n    {\r\n        echo \"Bulb has been lit\";\r\n    }\r\n\r\n    public function turnOff()\r\n    {\r\n        echo \"Darkness!\";\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a3d112319457-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a3d112319457-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a3d112319457-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a3d112319457-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a3d112319457-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a3d112319457-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a3d112319457-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a3d112319457-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a3d112319457-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a3d112319457-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a3d112319457-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a3d112319457-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a3d112319457-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a3d112319457-1\"><span class=\"crayon-c\">// Receiver</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a3d112319457-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bulb</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a3d112319457-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a3d112319457-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a3d112319457-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a3d112319457-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Bulb has been lit\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a3d112319457-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a3d112319457-8\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a3d112319457-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a3d112319457-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a3d112319457-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Darkness!\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a3d112319457-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a3d112319457-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>然后给出一个接口，（Bulb）中的每个命令都要实现这个接口，得到一组命令集：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a43522896931\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Command\r\n{\r\n    public function execute();\r\n    public function undo();\r\n    public function redo();\r\n}\r\n\r\n// Command\r\nclass TurnOn implements Command\r\n{\r\n    protected $bulb;\r\n\r\n    public function __construct(Bulb $bulb)\r\n    {\r\n        $this-&gt;bulb = $bulb;\r\n    }\r\n\r\n    public function execute()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOn();\r\n    }\r\n\r\n    public function undo()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOff();\r\n    }\r\n\r\n    public function redo()\r\n    {\r\n        $this-&gt;execute();\r\n    }\r\n}\r\n\r\nclass TurnOff implements Command\r\n{\r\n    protected $bulb;\r\n\r\n    public function __construct(Bulb $bulb)\r\n    {\r\n        $this-&gt;bulb = $bulb;\r\n    }\r\n\r\n    public function execute()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOff();\r\n    }\r\n\r\n    public function undo()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOn();\r\n    }\r\n\r\n    public function redo()\r\n    {\r\n        $this-&gt;execute();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a43522896931-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a43522896931-57\">57</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-8\"><span class=\"crayon-c\">// Command</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOn</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-22\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-32\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-34\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-35\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-42\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-52\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a43522896931-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a43522896931-57\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0051 seconds] -->\r\n<p>然后是Invoker，客户端将与之交互以处理各种命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a49840364937\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Invoker\r\nclass RemoteControl\r\n{\r\n    public function submit(Command $command)\r\n    {\r\n        $command-&gt;execute();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a49840364937-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a49840364937-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a49840364937-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a49840364937-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a49840364937-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a49840364937-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a49840364937-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a49840364937-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a49840364937-1\"><span class=\"crayon-c\">// Invoker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a49840364937-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RemoteControl</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a49840364937-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a49840364937-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a49840364937-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a49840364937-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a49840364937-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a49840364937-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>最后来看一下如何在客户端中使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a4e648600578\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$bulb = new Bulb();\r\n\r\n$turnOn = new TurnOn($bulb);\r\n$turnOff = new TurnOff($bulb);\r\n\r\n$remote = new RemoteControl();\r\n$remote-&gt;submit($turnOn); // Bulb has been lit!\r\n$remote-&gt;submit($turnOff); // Darkness!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a4e648600578-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a4e648600578-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a4e648600578-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a4e648600578-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a4e648600578-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a4e648600578-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a4e648600578-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a4e648600578-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a4e648600578-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bulb</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a4e648600578-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a4e648600578-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a4e648600578-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a4e648600578-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a4e648600578-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RemoteControl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a4e648600578-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Bulb has been lit!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a4e648600578-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOff</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Darkness!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>命令模式也可用于实现基于事务的系统。在执行命令时，需要持续保存命令的历史，如果最后一条命令成功执行，皆大欢喜，否则遍历历史记录，并对所有执行过的命执行<code>撤销</code>。</p>\n<h3>➿ 迭代器模式</h3>\n<h4>现实生活示例</h4>\n<p>老式的无线电设备将是一个很好的迭代器示例，用户可以在某个频道上启动，然后使用下一个或上一个按钮来切换频道。或者以 MP3 播放器或电视机为例，你可以按下一个按钮和上一个按钮进行连续的频道切换。换句话说，它们都提供了一个界面来遍历相应的频道，歌曲或广播电台。</p>\n<h4>概述</h4>\n<p>迭代器模式提供了一种方法，可以访问对象的元素而不暴露底层实现。</p>\n<h4>维基百科</h4>\n<p>在面向对象程序设计中，迭代器模式是一种设计模式，其中迭代器用于遍历容器并访问容器的元素。迭代器模式将算法与容器解耦; 在某些情况下，算法是特定容器必需的，因此不能解耦。</p>\n<p><strong>程序示例</strong></p>\n<p>通过PHP，使用 SPL（PHP标准库）可以轻松实现迭代器模式，以上述收音机为例，首先给出 <code>RadioStation</code> 类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a54304762021\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RadioStation\r\n{\r\n    protected $frequency;\r\n\r\n    public function __construct(float $frequency)\r\n    {\r\n        $this-&gt;frequency = $frequency;\r\n    }\r\n\r\n    public function getFrequency(): float\r\n    {\r\n        return $this-&gt;frequency;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a54304762021-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a54304762021-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a54304762021-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a54304762021-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a54304762021-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a54304762021-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a54304762021-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a54304762021-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a54304762021-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a54304762021-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a54304762021-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a54304762021-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a54304762021-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a54304762021-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a54304762021-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a54304762021-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a54304762021-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a54304762021-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a54304762021-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a54304762021-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a54304762021-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a54304762021-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a54304762021-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a54304762021-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a54304762021-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a54304762021-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a54304762021-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a54304762021-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>然后是 迭代器</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a5a187398976\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuse Countable;\r\nuse Iterator;\r\n\r\nclass StationList implements Countable, Iterator\r\n{\r\n    /** [@var](http://www.jobbole.com/members/variable) RadioStation[] $stations */\r\n    protected $stations = [];\r\n\r\n    /** [@var](http://www.jobbole.com/members/variable) int $counter */\r\n    protected $counter;\r\n\r\n    public function addStation(RadioStation $station)\r\n    {\r\n        $this-&gt;stations[] = $station;\r\n    }\r\n\r\n    public function removeStation(RadioStation $toRemove)\r\n    {\r\n        $toRemoveFrequency = $toRemove-&gt;getFrequency();\r\n        $this-&gt;stations = array_filter($this-&gt;stations, function (RadioStation $station) use ($toRemoveFrequency) {\r\n            return $station-&gt;getFrequency() !== $toRemoveFrequency;\r\n        });\r\n    }\r\n\r\n    public function count(): int\r\n    {\r\n        return count($this-&gt;stations);\r\n    }\r\n\r\n    public function current(): RadioStation\r\n    {\r\n        return $this-&gt;stations[$this-&gt;counter];\r\n    }\r\n\r\n    public function key()\r\n    {\r\n        return $this-&gt;counter;\r\n    }\r\n\r\n    public function next()\r\n    {\r\n        $this-&gt;counter++;\r\n    }\r\n\r\n    public function rewind()\r\n    {\r\n        $this-&gt;counter = 0;\r\n    }\r\n\r\n    public function valid(): bool\r\n    {\r\n        return isset($this-&gt;stations[$this-&gt;counter]);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a5a187398976-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a5a187398976-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-1\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Countable</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-2\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Iterator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StationList </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Countable</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Iterator</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-5\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** [@var](http://www.jobbole.com/members/variable) RadioStation[] $stations */</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-8\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** [@var](http://www.jobbole.com/members/variable) int $counter */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-16\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemove</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemove</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-24\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">current</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-34\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-44\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rewind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">bool</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a5a187398976-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a5a187398976-54\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0062 seconds] -->\r\n<p>可以这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a61306974736\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$stationList = new StationList();\r\n\r\n$stationList-&gt;addStation(new RadioStation(89));\r\n$stationList-&gt;addStation(new RadioStation(101));\r\n$stationList-&gt;addStation(new RadioStation(102));\r\n$stationList-&gt;addStation(new RadioStation(103.2));\r\n\r\nforeach($stationList as $station) {\r\n    echo $station-&gt;getFrequency() . PHP_EOL;\r\n}\r\n\r\n$stationList-&gt;removeStation(new RadioStation(89)); // Will remove station 89</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a61306974736-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a61306974736-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a61306974736-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a61306974736-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a61306974736-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a61306974736-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a61306974736-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a61306974736-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a61306974736-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a61306974736-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a61306974736-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a61306974736-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a61306974736-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StationList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a61306974736-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a61306974736-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">89</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a61306974736-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">101</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a61306974736-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">102</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a61306974736-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">103.2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a61306974736-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a61306974736-8\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">stationList </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a61306974736-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a61306974736-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a61306974736-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a61306974736-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">removeStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">89</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Will remove station 89</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<h3>👽 中介者模式</h3>\n<h4>现实生活示例</h4>\n<p>典型的例子是你通过手机与他人通话，你与通话者之间有一个网络供应商，对话将通过供应商传递而非直接传递。这种情况下网络供应商就是中介者。</p>\n<h4>概述</h4>\n<p>中介者模式添加了第三方对象（称为中介者）来控制两个对象（称为 colleague）之间的交互。中介者模式有助于减少通信类之间的耦合，因为类之间无需知道对方的实现。</p>\n<h4>维基百科</h4>\n<p>在软件工程中，中介者模式包装了一系列对象相互作用的方式。这种模式被认为是一种行为模式，因为它可以改变程序的运行时行为。</p>\n<p><strong>程序示例</strong></p>\n<p>下面是一个最简单的用户（即 colleague）在聊天室（中介者）中互相发送消息的示例</p>\n<p>首先给出中介者及聊天室</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a67830404821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface ChatRoomMediator \r\n{\r\n    public function showMessage(User $user, string $message);\r\n}\r\n\r\n// Mediator\r\nclass ChatRoom implements ChatRoomMediator\r\n{\r\n    public function showMessage(User $user, string $message)\r\n    {\r\n        $time = date('M d, y H:i');\r\n        $sender = $user-&gt;getName();\r\n\r\n        echo $time . '[' . $sender . ']:' . $message;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a67830404821-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a67830404821-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a67830404821-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a67830404821-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a67830404821-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a67830404821-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a67830404821-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a67830404821-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a67830404821-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a67830404821-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a67830404821-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a67830404821-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a67830404821-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a67830404821-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a67830404821-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a67830404821-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a67830404821-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoomMediator</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a67830404821-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a67830404821-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a67830404821-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a67830404821-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a67830404821-6\"><span class=\"crayon-c\">// Mediator</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a67830404821-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoom</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoomMediator</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a67830404821-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a67830404821-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a67830404821-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a67830404821-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'M d, y H:i'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a67830404821-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sender</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a67830404821-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a67830404821-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'['</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">sender</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">']:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a67830404821-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a67830404821-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>然后是用户即 colleague</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a6d327227870\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass User {\r\n    protected $name;\r\n    protected $chatMediator;\r\n\r\n    public function __construct(string $name, ChatRoomMediator $chatMediator) {\r\n        $this-&gt;name = $name;\r\n        $this-&gt;chatMediator = $chatMediator;\r\n    }\r\n\r\n    public function getName() {\r\n        return $this-&gt;name;\r\n    }\r\n\r\n    public function send($message) {\r\n        $this-&gt;chatMediator-&gt;showMessage($this, $message);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a6d327227870-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a6d327227870-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a6d327227870-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a6d327227870-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a6d327227870-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a6d327227870-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a6d327227870-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a6d327227870-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a6d327227870-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a6d327227870-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a6d327227870-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ChatRoomMediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a6d327227870-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a6d327227870-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a6d327227870-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a6d327227870-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a6d327227870-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a6d327227870-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a6d327227870-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a73515991172\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$mediator = new ChatRoom();\r\n\r\n$john = new User('John Doe', $mediator);\r\n$jane = new User('Jane Doe', $mediator);\r\n\r\n$john-&gt;send('Hi there!');\r\n$jane-&gt;send('Hey!');\r\n\r\n// Output will be\r\n// Feb 14, 10:58 [John]: Hi there!\r\n// Feb 14, 10:58 [Jane]: Hey!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a73515991172-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a73515991172-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a73515991172-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a73515991172-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a73515991172-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a73515991172-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a73515991172-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a73515991172-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a73515991172-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a73515991172-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a73515991172-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a73515991172-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a73515991172-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a73515991172-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">john</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'John Doe'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a73515991172-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jane</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Jane Doe'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a73515991172-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a73515991172-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">john</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hi there!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a73515991172-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jane</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hey!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a73515991172-8\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a73515991172-9\"><span class=\"crayon-c\">// Output will be</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a73515991172-10\"><span class=\"crayon-c\">// Feb 14, 10:58 [John]: Hi there!</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a73515991172-11\"><span class=\"crayon-c\">// Feb 14, 10:58 [Jane]: Hey!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h3>💾 备忘录模式</h3>\n<h4>现实生活示例</h4>\n<p>以计算器（即发起者）为例，每当执行一些计算时，最后一次计算结果将保存在内存中（即备忘录），以便数据可以恢复，也可以使用某些操作按钮（即临时代理）来恢复数据。</p>\n<h4>概述</h4>\n<p>备忘录模式以一种稍后可平滑恢复的方式捕捉并存储对象的当前状态。</p>\n<h4>维基百科</h4>\n<p>备忘录模式是一种软件设计模式，可以将对象恢复到之前的状态（通过回滚来撤销）</p>\n<p>需要提供撤销操作时，备忘录模式通常很有用。</p>\n<p><strong>程序示例</strong></p>\n<p>首先给出可以存储编辑器状态的备忘录对象</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a79337512691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass EditorMemento\r\n{\r\n    protected $content;\r\n\r\n    public function __construct(string $content)\r\n    {\r\n        $this-&gt;content = $content;\r\n    }\r\n\r\n    public function getContent()\r\n    {\r\n        return $this-&gt;content;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a79337512691-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a79337512691-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a79337512691-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a79337512691-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a79337512691-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a79337512691-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a79337512691-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a79337512691-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a79337512691-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a79337512691-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a79337512691-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a79337512691-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a79337512691-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a79337512691-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a79337512691-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EditorMemento</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a79337512691-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a79337512691-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a79337512691-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a79337512691-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a79337512691-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a79337512691-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a79337512691-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a79337512691-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a79337512691-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a79337512691-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a79337512691-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a79337512691-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a79337512691-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>然后是使用备忘录对象的编辑器及发起者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a7e305095257\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Editor\r\n{\r\n    protected $content = '';\r\n\r\n    public function type(string $words)\r\n    {\r\n        $this-&gt;content = $this-&gt;content . ' ' . $words;\r\n    }\r\n\r\n    public function getContent()\r\n    {\r\n        return $this-&gt;content;\r\n    }\r\n\r\n    public function save()\r\n    {\r\n        return new EditorMemento($this-&gt;content);\r\n    }\r\n\r\n    public function restore(EditorMemento $memento)\r\n    {\r\n        $this-&gt;content = $memento-&gt;getContent();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a7e305095257-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a7e305095257-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Editor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-i\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' '</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-14\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EditorMemento</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">EditorMemento</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">memento</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">memento</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a7e305095257-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a7e305095257-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a84479889338\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$editor = new Editor();\r\n\r\n// Type some stuff\r\n$editor-&gt;type('This is the first sentence.');\r\n$editor-&gt;type('This is second.');\r\n\r\n// Save the state to restore to : This is the first sentence. This is second.\r\n$saved = $editor-&gt;save();\r\n\r\n// Type some more\r\n$editor-&gt;type('And this is third.');\r\n\r\n// Output: Content before Saving\r\necho $editor-&gt;getContent(); // This is the first sentence. This is second. And this is third.\r\n\r\n// Restoring to last saved state\r\n$editor-&gt;restore($saved);\r\n\r\n$editor-&gt;getContent(); // This is the first sentence. This is second.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a84479889338-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a84479889338-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Editor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-3\"><span class=\"crayon-c\">// Type some stuff</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'This is the first sentence.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'This is second.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-6\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-7\"><span class=\"crayon-c\">// Save the state to restore to : This is the first sentence. This is second.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">saved</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-10\"><span class=\"crayon-c\">// Type some more</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'And this is third.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-13\"><span class=\"crayon-c\">// Output: Content before Saving</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-14\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// This is the first sentence. This is second. And this is third.</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-16\"><span class=\"crayon-c\">// Restoring to last saved state</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-17\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">saved</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a84479889338-18\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a84479889338-19\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// This is the first sentence. This is second.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h3>😎 观察者模式</h3>\n<h4>现实生活示例</h4>\n<p>一个很好的例子是，求职者订阅了一些招聘网站，每当有匹配的工作机会时，求职者就会收到通知。</p>\n<h4>概述</h4>\n<p>定义了对象之间的依赖，一旦其中一个对象的状态发生改变，依赖它的对象都会收到通知。</p>\n<h4>维基百科</h4>\n<p>观察者模式是软件设计模式的一种。在此种模式中，一个目标对象管理所有相依于它的观察者对象，并且在它本身的状态改变时主动发出通知。通常通过调用目标对象所提供的方法来实现。</p>\n<p><strong>程序示例</strong></p>\n<p>以上述求职订阅为例，首先给出求职者，有职位发布时会收到通知</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a8a130965647\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass JobPost\r\n{\r\n    protected $title;\r\n\r\n    public function __construct(string $title)\r\n    {\r\n        $this-&gt;title = $title;\r\n    }\r\n\r\n    public function getTitle()\r\n    {\r\n        return $this-&gt;title;\r\n    }\r\n}\r\n\r\nclass JobSeeker implements Observer\r\n{\r\n    protected $name;\r\n\r\n    public function __construct(string $name)\r\n    {\r\n        $this-&gt;name = $name;\r\n    }\r\n\r\n    public function onJobPosted(JobPost $job)\r\n    {\r\n        // Do something with the job posting\r\n        echo 'Hi ' . $this-&gt;name . '! New job posted: '. $job-&gt;getTitle();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a8a130965647-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a8a130965647-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTitle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-16\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Observer</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-17\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-24\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">onJobPosted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">job</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do something with the job posting</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hi '</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'! New job posted: '</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">job</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getTitle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a8a130965647-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a8a130965647-30\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>然后是求职者订阅的职位发布类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a90752180656\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass JobPostings implements Observable\r\n{\r\n    protected $observers = [];\r\n\r\n    protected function notify(JobPost $jobPosting)\r\n    {\r\n        foreach ($this-&gt;observers as $observer) {\r\n            $observer-&gt;onJobPosted($jobPosting);\r\n        }\r\n    }\r\n\r\n    public function attach(Observer $observer)\r\n    {\r\n        $this-&gt;observers[] = $observer;\r\n    }\r\n\r\n    public function addJob(JobPost $jobPosting)\r\n    {\r\n        $this-&gt;notify($jobPosting);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a90752180656-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a90752180656-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPostings</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Observable</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">observers </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">onJobPosted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Observer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">observers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-16\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addJob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a90752180656-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a90752180656-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a95616350655\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Create subscribers\r\n$johnDoe = new JobSeeker('John Doe');\r\n$janeDoe = new JobSeeker('Jane Doe');\r\n\r\n// Create publisher and attach subscribers\r\n$jobPostings = new JobPostings();\r\n$jobPostings-&gt;attach($johnDoe);\r\n$jobPostings-&gt;attach($janeDoe);\r\n\r\n// Add a new job and see if subscribers get notified\r\n$jobPostings-&gt;addJob(new JobPost('Software Engineer'));\r\n\r\n// Output\r\n// Hi John Doe! New job posted: Software Engineer\r\n// Hi Jane Doe! New job posted: Software Engineer</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a95616350655-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a95616350655-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a95616350655-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a95616350655-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a95616350655-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a95616350655-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a95616350655-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a95616350655-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a95616350655-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a95616350655-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a95616350655-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a95616350655-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a95616350655-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a95616350655-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a95616350655-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a95616350655-1\"><span class=\"crayon-c\">// Create subscribers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a95616350655-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">johnDoe</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'John Doe'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a95616350655-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">janeDoe</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Jane Doe'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a95616350655-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a95616350655-5\"><span class=\"crayon-c\">// Create publisher and attach subscribers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a95616350655-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPostings</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a95616350655-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">johnDoe</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a95616350655-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">janeDoe</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a95616350655-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a95616350655-10\"><span class=\"crayon-c\">// Add a new job and see if subscribers get notified</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a95616350655-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addJob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Software Engineer'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a95616350655-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a95616350655-13\"><span class=\"crayon-c\">// Output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a95616350655-14\"><span class=\"crayon-c\">// Hi John Doe! New job posted: Software Engineer</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a95616350655-15\"><span class=\"crayon-c\">// Hi Jane Doe! New job posted: Software Engineer</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p>\n<h3>🏃 访问者模式</h3>\n<h4>现实生活示例</h4>\n<p>假如有人前往迪拜，他们需要有证件（比如签证）就可进入迪拜。到达后，无需获得许可或做一些跑腿工作，他们便可以自由前往迪拜的任何地方; 只要是知道的地方，就能游览。访问者模式可以做到这一点，它可以帮助你添加访问地点，以便在无需跑腿的情况下，可以尽可能多地访问。</p>\n<h4>概述</h4>\n<p>访问者模式可以在无需修改对象的情况下增加一些额外操作。</p>\n<h4>维基百科</h4>\n<p>在面向对象编程和软件工程中，访问者设计模式是一种从对象结构中分离算法的方式。这种分离的实际结果是能够向现有的对象结构添加新的操作，而无需修改这些结构。这是遵循开放/封闭原则的一种方式。</p>\n<p><strong>编程示例</strong></p>\n<p>以模拟动物园为例，动物园里有几种不同种类的动物，我们需要让它们发出叫声，下面使用访问者模式实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201a9c373990638\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Visitee\r\ninterface Animal\r\n{\r\n    public function accept(AnimalOperation $operation);\r\n}\r\n\r\n// Visitor\r\ninterface AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey);\r\n    public function visitLion(Lion $lion);\r\n    public function visitDolphin(Dolphin $dolphin);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201a9c373990638-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a9c373990638-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a9c373990638-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a9c373990638-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a9c373990638-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a9c373990638-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a9c373990638-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a9c373990638-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a9c373990638-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a9c373990638-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a9c373990638-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201a9c373990638-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201a9c373990638-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201a9c373990638-1\"><span class=\"crayon-c\">// Visitee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a9c373990638-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a9c373990638-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a9c373990638-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a9c373990638-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a9c373990638-6\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201a9c373990638-7\"><span class=\"crayon-c\">// Visitor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a9c373990638-8\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a9c373990638-9\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a9c373990638-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a9c373990638-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201a9c373990638-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201a9c373990638-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>然后实现各种动物</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201aa1979097623\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Monkey implements Animal\r\n{\r\n    public function shout()\r\n    {\r\n        echo 'Ooh oo aa aa!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitMonkey($this);\r\n    }\r\n}\r\n\r\nclass Lion implements Animal\r\n{\r\n    public function roar()\r\n    {\r\n        echo 'Roaaar!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitLion($this);\r\n    }\r\n}\r\n\r\nclass Dolphin implements Animal\r\n{\r\n    public function speak()\r\n    {\r\n        echo 'Tuut tuttu tuutt!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitDolphin($this);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa1979097623-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa1979097623-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Ooh oo aa aa!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-14\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-15\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Roaaar!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-20\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-25\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-26\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-27\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-28\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Tuut tuttu tuutt!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa1979097623-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa1979097623-38\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>接下来实现访问者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201aa7494582044\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Speak implements AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey)\r\n    {\r\n        $monkey-&gt;shout();\r\n    }\r\n\r\n    public function visitLion(Lion $lion)\r\n    {\r\n        $lion-&gt;roar();\r\n    }\r\n\r\n    public function visitDolphin(Dolphin $dolphin)\r\n    {\r\n        $dolphin-&gt;speak();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa7494582044-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa7494582044-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa7494582044-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa7494582044-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa7494582044-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa7494582044-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa7494582044-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aa7494582044-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aa7494582044-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Speak</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa7494582044-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa7494582044-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">shout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa7494582044-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa7494582044-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa7494582044-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa7494582044-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa7494582044-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aa7494582044-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aa7494582044-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>可以这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201aac882819167\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$monkey = new Monkey();\r\n$lion = new Lion();\r\n$dolphin = new Dolphin();\r\n\r\n$speak = new Speak();\r\n\r\n$monkey-&gt;accept($speak);    // Ooh oo aa aa!    \r\n$lion-&gt;accept($speak);      // Roaaar!\r\n$dolphin-&gt;accept($speak);   // Tuut tutt tuutt!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201aac882819167-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aac882819167-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aac882819167-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aac882819167-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aac882819167-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aac882819167-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aac882819167-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aac882819167-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aac882819167-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201aac882819167-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Monkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aac882819167-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aac882819167-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aac882819167-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201aac882819167-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aac882819167-6\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201aac882819167-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Ooh oo aa aa!    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aac882819167-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Roaaar!</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aac882819167-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Tuut tutt tuutt!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>当需要为动物添加新动作时，我们本可以通过动物支持继承来实现，但是需要修改动物类。但现在就不必修改动物类了。例如，假设需要向动物添加跳跃行为，我们可以通过创建一个新的访问者来简单地添加此行为，即：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ab2527566492\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Jump implements AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey)\r\n    {\r\n        echo 'Jumped 20 feet high! on to the tree!';\r\n    }\r\n\r\n    public function visitLion(Lion $lion)\r\n    {\r\n        echo 'Jumped 7 feet! Back on the ground!';\r\n    }\r\n\r\n    public function visitDolphin(Dolphin $dolphin)\r\n    {\r\n        echo 'Walked on water a little and disappeared';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab2527566492-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab2527566492-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab2527566492-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab2527566492-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab2527566492-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab2527566492-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab2527566492-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab2527566492-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab2527566492-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jump</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab2527566492-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab2527566492-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Jumped 20 feet high! on to the tree!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab2527566492-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab2527566492-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab2527566492-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Jumped 7 feet! Back on the ground!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab2527566492-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab2527566492-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Walked on water a little and disappeared'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab2527566492-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab2527566492-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ab7311607263\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$jump = new Jump();\r\n\r\n$monkey-&gt;accept($speak);   // Ooh oo aa aa!\r\n$monkey-&gt;accept($jump);    // Jumped 20 feet high! on to the tree!\r\n\r\n$lion-&gt;accept($speak);     // Roaaar!\r\n$lion-&gt;accept($jump);      // Jumped 7 feet! Back on the ground!\r\n\r\n$dolphin-&gt;accept($speak);  // Tuut tutt tuutt!\r\n$dolphin-&gt;accept($jump);   // Walked on water a little and disappeared</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ab7311607263-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab7311607263-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab7311607263-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab7311607263-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab7311607263-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab7311607263-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab7311607263-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab7311607263-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ab7311607263-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ab7311607263-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ab7311607263-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab7311607263-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ab7311607263-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Ooh oo aa aa!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab7311607263-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Jumped 20 feet high! on to the tree!</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab7311607263-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab7311607263-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// Roaaar!</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ab7311607263-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Jumped 7 feet! Back on the ground!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab7311607263-8\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ab7311607263-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// Tuut tutt tuutt!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ab7311607263-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Walked on water a little and disappeared</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h3>💡 策略模式</h3>\n<h4>现实生活示例</h4>\n<p>考虑排序的例子，我们实现了冒泡排序，但数据开始增长，冒泡排序开始变得非常慢。为了解决这个问题，我们实现了快速排序。尽管快速排序算法对于大型数据集来说效果很好，但对于较小的数据集却非常慢。为了解决这个问题，我们实施了一个策略，小数据集使用冒泡排序，大数据集使用快速排序。</p>\n<h4>概述</h4>\n<p>策略模式允许你基于场景转换算法或策略。</p>\n<h4>维基百科</h4>\n<p>在计算机编程中，策略模式是一种行为设计模式，可以在运行时选择算法的行为。</p>\n<p><strong>编程示例</strong></p>\n<p>以上述排序为例，首先给出策略接口及不同的策略实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201abd897436085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface SortStrategy\r\n{\r\n    public function sort(array $dataset): array;\r\n}\r\n\r\nclass BubbleSortStrategy implements SortStrategy\r\n{\r\n    public function sort(array $dataset): array\r\n    {\r\n        echo \"Sorting using bubble sort\";\r\n\r\n        // Do sorting\r\n        return $dataset;\r\n    }\r\n}\r\n\r\nclass QuickSortStrategy implements SortStrategy\r\n{\r\n    public function sort(array $dataset): array\r\n    {\r\n        echo \"Sorting using quick sort\";\r\n\r\n        // Do sorting\r\n        return $dataset;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971797201abd897436085-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201abd897436085-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BubbleSortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sorting using bubble sort\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do sorting</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-16\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sorting using quick sort\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-22\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do sorting</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201abd897436085-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201abd897436085-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>客户端可以使用任意策略</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ac3975455651\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Sorter\r\n{\r\n    protected $sorter;\r\n\r\n    public function __construct(SortStrategy $sorter)\r\n    {\r\n        $this-&gt;sorter = $sorter;\r\n    }\r\n\r\n    public function sort(array $dataset): array\r\n    {\r\n        return $this-&gt;sorter-&gt;sort($dataset);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ac3975455651-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac3975455651-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac3975455651-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac3975455651-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac3975455651-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac3975455651-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac3975455651-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac3975455651-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac3975455651-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac3975455651-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac3975455651-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac3975455651-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac3975455651-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac3975455651-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ac3975455651-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac3975455651-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ac3975455651-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac3975455651-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ac3975455651-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">SortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac3975455651-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ac3975455651-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac3975455651-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ac3975455651-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac3975455651-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ac3975455651-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac3975455651-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ac3975455651-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac3975455651-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ac8554445879\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$dataset = [1, 5, 4, 3, 2, 8];\r\n\r\n$sorter = new Sorter(new BubbleSortStrategy());\r\n$sorter-&gt;sort($dataset); // Output : Sorting using bubble sort\r\n\r\n$sorter = new Sorter(new QuickSortStrategy());\r\n$sorter-&gt;sort($dataset); // Output : Sorting using quick sort</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ac8554445879-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac8554445879-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac8554445879-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac8554445879-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac8554445879-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ac8554445879-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ac8554445879-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ac8554445879-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac8554445879-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ac8554445879-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BubbleSortStrategy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac8554445879-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Output : Sorting using bubble sort</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ac8554445879-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ac8554445879-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSortStrategy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ac8554445879-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Output : Sorting using quick sort</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h3>💢 状态模式</h3>\n<h4>现实生活示例</h4>\n<p>想象一下，你正在使用一些绘图应用程序，你可以选择笔刷来绘画，刷子根据所选颜色改变其行为，即如果选择红色，它将绘制为红色，如果选择蓝色，那么它将绘制蓝色等。</p>\n<h4>概述</h4>\n<p>当状态改变时，类的行为也发生改变。</p>\n<h4>维基百科</h4>\n<p>状态模式是以面向对象的方式实现状态机的行为设计模式。对于状态模式，通过将每个单独状态实现为派生类的状态模式接口, 来实现一个状态机，并通过调用模式超类的方法来实现状态转换。状态模式可以被解释为一种策略模式，它能够通过调用模式接口定义的方法来切换当前策略。</p>\n<p><strong>程序示例</strong></p>\n<p>以文本编辑器为例，编辑器可以改变文本的状态如选中粗体，就会以粗体输入文本，选中斜体便以斜体输入。</p>\n<p>首先是状态接口和一些状态实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ace404398252\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface WritingState\r\n{\r\n    public function write(string $words);\r\n}\r\n\r\nclass UpperCase implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo strtoupper($words);\r\n    }\r\n}\r\n\r\nclass LowerCase implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo strtolower($words);\r\n    }\r\n}\r\n\r\nclass Default implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo $words;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ace404398252-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ace404398252-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UpperCase</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">strtoupper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-14\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LowerCase</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-15\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">strtolower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-22\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-23\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ace404398252-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ace404398252-28\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>然后是文本编辑器</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ad4389627616\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass TextEditor\r\n{\r\n    protected $state;\r\n\r\n    public function __construct(WritingState $state)\r\n    {\r\n        $this-&gt;state = $state;\r\n    }\r\n\r\n    public function setState(WritingState $state)\r\n    {\r\n        $this-&gt;state = $state;\r\n    }\r\n\r\n    public function type(string $words)\r\n    {\r\n        $this-&gt;state-&gt;write($words);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad4389627616-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad4389627616-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TextEditor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">WritingState</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">WritingState</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-14\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad4389627616-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad4389627616-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ad9874194591\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$editor = new TextEditor(new Default());\r\n\r\n$editor-&gt;type('First line');\r\n\r\n$editor-&gt;setState(new UpperCase());\r\n\r\n$editor-&gt;type('Second line');\r\n$editor-&gt;type('Third line');\r\n\r\n$editor-&gt;setState(new LowerCase());\r\n\r\n$editor-&gt;type('Fourth line');\r\n$editor-&gt;type('Fifth line');\r\n\r\n// Output:\r\n// First line\r\n// SECOND LINE\r\n// THIRD LINE\r\n// fourth line\r\n// fifth line</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ad9874194591-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ad9874194591-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TextEditor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Default</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'First line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UpperCase</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-6\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Second line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Third line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LowerCase</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Fourth line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Fifth line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-14\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-15\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-16\"><span class=\"crayon-c\">// First line</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-17\"><span class=\"crayon-c\">// SECOND LINE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-18\"><span class=\"crayon-c\">// THIRD LINE</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ad9874194591-19\"><span class=\"crayon-c\">// fourth line</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ad9874194591-20\"><span class=\"crayon-c\">// fifth line</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h3>📒 模板方法模式</h3>\n<h4>现实生活示例</h4>\n<p>假设我们要造一座房子，建造的大体步骤如下：</p>\n<ul>\n<li>打地基</li>\n<li>垒墙</li>\n<li>封顶</li>\n<li>铺地板</li>\n</ul>\n<p>这些步骤的顺序不能被打乱，比如说，你不能在垒墙之前先封顶。但是其中的每一步可以定制，比如墙的材料可以使用木头、聚酯纤维或者石头。</p>\n<h4>概述</h4>\n<p>模板方法模式定义了如何执行某种算法的框架，但是将这些步骤的实现推迟到子类中。</p>\n<h4>维基百科</h4>\n<p>在软件工程中，模板方法模式是一种行为设计模式，用于定义操作中算法的程序框架，将一些步骤推迟到子类实现。它允许在不改变算法结构的情况下重新定义算法的某些步骤。</p>\n<p><strong>程序示例</strong></p>\n<p>假如我们有一个构建工具，可以帮助我们测试，构建并生成构建报告（即代码覆盖报告，linting报告等），并将应用程序部署到测试服务器上。</p>\n<p>首先是用于确定构建算法框架的基类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ae0320079551\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nabstract class Builder\r\n{\r\n\r\n    // Template method\r\n    final public function build()\r\n    {\r\n        $this-&gt;test();\r\n        $this-&gt;lint();\r\n        $this-&gt;assemble();\r\n        $this-&gt;deploy();\r\n    }\r\n\r\n    abstract public function test();\r\n    abstract public function lint();\r\n    abstract public function assemble();\r\n    abstract public function deploy();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae0320079551-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae0320079551-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae0320079551-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae0320079551-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae0320079551-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae0320079551-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae0320079551-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae0320079551-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae0320079551-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-1\"><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae0320079551-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae0320079551-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Template method</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae0320079551-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae0320079551-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae0320079551-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae0320079551-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae0320079551-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae0320079551-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae0320079551-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>然后提供一些基类的实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201ae5795490962\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass AndroidBuilder extends Builder\r\n{\r\n    public function test()\r\n    {\r\n        echo 'Running android tests';\r\n    }\r\n\r\n    public function lint()\r\n    {\r\n        echo 'Linting the android code';\r\n    }\r\n\r\n    public function assemble()\r\n    {\r\n        echo 'Assembling the android build';\r\n    }\r\n\r\n    public function deploy()\r\n    {\r\n        echo 'Deploying android build to server';\r\n    }\r\n}\r\n\r\nclass IosBuilder extends Builder\r\n{\r\n    public function test()\r\n    {\r\n        echo 'Running ios tests';\r\n    }\r\n\r\n    public function lint()\r\n    {\r\n        echo 'Linting the ios code';\r\n    }\r\n\r\n    public function assemble()\r\n    {\r\n        echo 'Assembling the ios build';\r\n    }\r\n\r\n    public function deploy()\r\n    {\r\n        echo 'Deploying ios build to server';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201ae5795490962-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5971797201ae5795490962-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AndroidBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Running android tests'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Linting the android code'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Assembling the android build'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Deploying android build to server'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-22\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-24\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IosBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-25\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Running ios tests'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-30\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Linting the ios code'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Assembling the ios build'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-40\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Deploying ios build to server'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201ae5795490962-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971797201ae5795490962-45\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971797201aeb366828748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$androidBuilder = new AndroidBuilder();\r\n$androidBuilder-&gt;build();\r\n\r\n// Output:\r\n// Running android tests\r\n// Linting the android code\r\n// Assembling the android build\r\n// Deploying android build to server\r\n\r\n$iosBuilder = new IosBuilder();\r\n$iosBuilder-&gt;build();\r\n\r\n// Output:\r\n// Running ios tests\r\n// Linting the ios code\r\n// Assembling the ios build\r\n// Deploying ios build to server</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aeb366828748-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aeb366828748-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aeb366828748-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aeb366828748-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aeb366828748-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aeb366828748-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aeb366828748-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971797201aeb366828748-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971797201aeb366828748-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">androidBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AndroidBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aeb366828748-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">androidBuilder</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aeb366828748-4\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-5\"><span class=\"crayon-c\">// Running android tests</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aeb366828748-6\"><span class=\"crayon-c\">// Linting the android code</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-7\"><span class=\"crayon-c\">// Assembling the android build</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aeb366828748-8\"><span class=\"crayon-c\">// Deploying android build to server</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aeb366828748-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iosBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IosBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iosBuilder</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aeb366828748-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-13\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aeb366828748-14\"><span class=\"crayon-c\">// Running ios tests</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-15\"><span class=\"crayon-c\">// Linting the ios code</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971797201aeb366828748-16\"><span class=\"crayon-c\">// Assembling the ios build</span></div><div class=\"crayon-line\" id=\"crayon-5971797201aeb366828748-17\"><span class=\"crayon-c\">// Deploying ios build to server</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/a9e67955472c1afcad111aa202984192.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111797\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111797votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111797\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg\">Justin_YGG</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/4302cabf679254e36d325f1d9185b6c72.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Python工程师一枚，对go、docker感兴趣，还在成长ing~~        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/justin_ygg\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/justin_ygg/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "cc276802ec74b5c8ad50fe746800ea7f", "com_num": 0, "title": "人人都能读懂的设计模式（3）：行为型模式", "url": "http://blog.jobbole.com/111797/", "praise_num": "1", "front_image_path": "full/ae5704bda1df1c07deb1efa5f979b89054301d53.jpg", "create_date": "2017/07/17", "tags": "IT技术,设计模式", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/ef9bd8829d4a02c071feb1af9522d6ab.png"]},{"fav_num": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hector\">hoohack</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p><a href=\"http://blog.jobbole.com/111853/\" target=\"_blank\">上一篇文章</a>里面，讲到了遇到mysql主从延迟的坑，对于这次的坑多说两句，以前也看过这样的例子，也知道不能够写完之后马上更新，但是真正开发的时候还是没有注意到这一点，道理大家都懂，但是还是会犯错，只有等到自己亲生体验到该错误之后，才真正的掌握到该道理。</p>\n<p>经历过一次mysql主从延迟之后，就开始思考，主从复制是什么东西？它是怎么实现的呢？它的原理是什么？于是乎就开始查阅资料、文章，现将自己理解到的内容总结在此，加深印象。</p>\n<h3>为什么要做主从复制？</h3>\n<p>1、在业务复杂的系统中，有这么一个情景，有一句sql语句需要锁表，导致暂时不能使用读的服务，那么就很影响运行中的业务，使用主从复制，让主库负责写，从库负责读，这样，即使主库出现了锁表的情景，通过读从库也可以保证业务的正常运作。</p>\n<p>2、做数据的热备</p>\n<p>3、架构的扩展。业务量越来越大，I/O访问频率过高，单机无法满足，此时做多库的存储，降低磁盘I/O访问的频率，提高单个机器的I/O性能。</p>\n<h3>mysql主从复制的原理是什么？</h3>\n<p>binlog: binary log，主库中保存所有更新事件日志的二进制文件。</p>\n<p>主从复制的基础是主库记录数据库的所有变更记录到binlog。binlog是数据库服务器启动的那一刻起，保存所有修改数据库结构或内容的一个文件。</p>\n<p>mysql主从复制是一个异步的复制过程，主库发送更新事件到从库，从库读取更新记录，并执行更新记录，使得从库的内容与主库保持一致。</p>\n<p>在主库里，只要有更新事件出现，就会被依次地写入到binlog里面，之后会推到从库中作为从库进行复制的数据源。</p>\n<p><strong>binlog输出线程。</strong>每当有从库连接到主库的时候，主库都会创建一个线程然后发送binlog内容到从库。 对于每一个即将发送给从库的sql事件，binlog输出线程会将其锁住。一旦该事件被线程读取完之后，该锁会被释放，即使在该事件完全发送到从库的时候，该锁也会被释放。</p>\n<p>在从库里，当复制开始的时候，从库就会创建两个线程进行处理：</p>\n<p><strong>从库I/O线程。</strong>当START SLAVE语句在从库开始执行之后，从库创建一个I/O线程，该线程连接到主库并请求主库发送binlog里面的更新记录到从库上。 从库I/O线程读取主库的binlog输出线程发送的更新并拷贝这些更新到本地文件，其中包括relay log文件。</p>\n<p><strong>从库的SQL线程。</strong>从库创建一个SQL线程，这个线程读取从库I/O线程写到relay log的更新事件并执行。</p>\n<p>可以知道，对于每一个主从复制的连接，都有三个线程。拥有多个从库的主库为每一个连接到主库的从库创建一个binlog输出线程，每一个从库都有它自己的I/O线程和SQL线程。</p>\n<p>从库通过创建两个独立的线程，使得在进行复制时，从库的读和写进行了分离。因此，即使负责执行的线程运行较慢，负责读取更新语句的线程并不会因此变得缓慢。比如说，如果从库有一段时间没运行了，当它在此启动的时候，尽管它的SQL线程执行比较慢，它的I/O线程可以快速地从主库里读取所有的binlog内容。这样一来，即使从库在SQL线程执行完所有读取到的语句前停止运行了，I/O线程也至少完全读取了所有的内容，并将其安全地备份在从库本地的relay log，随时准备在从库下一次启动的时候执行语句。</p>\n<h3>查看主从复制的状态</h3>\n<p>当主从复制正在进行中时，如果想查看从库两个线程运行状态，可以通过执行在从库里执行”show slave status\\G”语句，以下的字段可以给你想要的信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59719e94f3385718426107\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMaster_Log_File — 上一个从主库拷贝过来的binlog文件\r\nRead_Master_Log_Pos — 主库的binlog文件被拷贝到从库的relay log中的位置\r\nRelay_Master_Log_File — SQL线程当前处理中的relay log文件\r\nExec_Master_Log_Pos — 当前binlog文件正在被执行的语句的位置</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59719e94f3385718426107-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719e94f3385718426107-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59719e94f3385718426107-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59719e94f3385718426107-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59719e94f3385718426107-1\"><span class=\"crayon-v\">Master_Log</span><span class=\"crayon-sy\">_</span>File<span class=\"crayon-h\"> </span>—<span class=\"crayon-h\"> </span>上一个从主库拷贝过来的<span class=\"crayon-i\">binlog</span>文件</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719e94f3385718426107-2\"><span class=\"crayon-v\">Read_Master_Log</span><span class=\"crayon-sy\">_</span>Pos<span class=\"crayon-h\"> </span>—<span class=\"crayon-h\"> </span>主库的<span class=\"crayon-i\">binlog</span>文件被拷贝到从库的<span class=\"crayon-e\">relay </span><span class=\"crayon-i\">log</span>中的位置</div><div class=\"crayon-line\" id=\"crayon-59719e94f3385718426107-3\"><span class=\"crayon-v\">Relay_Master_Log</span><span class=\"crayon-sy\">_</span>File<span class=\"crayon-h\"> </span>—<span class=\"crayon-h\"> </span><span class=\"crayon-i\">SQL</span>线程当前处理中的<span class=\"crayon-e\">relay </span><span class=\"crayon-i\">log</span>文件</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59719e94f3385718426107-4\"><span class=\"crayon-v\">Exec_Master_Log</span><span class=\"crayon-sy\">_</span>Pos<span class=\"crayon-h\"> </span>—<span class=\"crayon-h\"> </span>当前<span class=\"crayon-i\">binlog</span>文件正在被执行的语句的位置</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>整个主从复制的流程可以通过以下图示理解：</p>\n<p><img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/DB%20replication.png\" alt=\"DB Replication\"></p>\n<ul>\n<li>步骤一：主库db的更新事件(update、insert、delete)被写到binlog</li>\n<li>步骤二：从库发起连接，连接到主库</li>\n<li>步骤三：此时主库创建一个binlog dump thread，把binlog的内容发送到从库</li>\n<li>步骤四：从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log</li>\n<li>步骤五：还会创建一个SQL线程，从relay log里面读取内容，从<strong>Exec_Master_Log_Pos</strong>位置开始执行读取到的更新事件，将更新内容写入到slave的db</li>\n</ul>\n<p class=\"lang:default decode:true brush: default; gutter: true\"><code>注：上面的解释是解释每一步做了什么，整个mysql主从复制是异步的，不是按照上面的步骤执行的。 </code></p>\n<h3>其他</h3>\n<p>关于主从复制架构的搭建，可以参考网上更多的文档，文笔有限，不做更多的介绍。</p>\n<p>作为一名开发，这些基础的mysql知识还是需要多多学习。</p>\n<h3>参考资料</h3>\n<ul>\n<li><a href=\"http://dbadiaries.com/what-is-mysql-replication-and-how-does-it-work\">What is MySQL Replication and How Does It Work?</a></li>\n<li><a href=\"https://dev.mysql.com/doc/refman/5.6/en/replication-implementation-details.html\">Replication Implementation Details</a></li>\n</ul>\n<p>原创文章，文笔有限，才疏学浅，文中若有不正之处，万望告知。</p>\n<p><!-- JiaThis Button END --></p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/7aa70eaa311d5a5dec82ca0d49624741.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/1a4b335ec981d013f4002205a23fedd0.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111865\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111865votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111865\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hector\">hoohack</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hector\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/df22a501f19a5bba1b3331e2001f8ec2.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个正在努力的菜鸟        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hector\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hector/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hector/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 27</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.hoohack.me\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/2388493434?is_all=1\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：914099943\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：hhq8307231\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/hoohack\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "3a27b353b7aca708e99d62dc9d86734b", "com_num": 1, "title": "MySQL 主从复制原理探索", "url": "http://blog.jobbole.com/111865/", "praise_num": "2", "front_image_path": "full/76dac52543eae84f3fd038af336bf45c1c4c1efe.jpg", "create_date": "2017/07/16", "tags": "IT技术,MySQL,主从复制,数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/582271a95a4505dff985ffc837868976.png"]}]